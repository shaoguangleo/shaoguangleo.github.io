<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"shaoguangleo.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ssh远程登录必备神器接着ssh的入门操作 继续ssh的大杂烩。 官方定义为：  ssh — OpenSSH remote login client  使用方法为： 1234$ ssh [-46AaCfGgKkMNnqsTtVvXxYy] [-B bind_interface] [-b bind_address] [-c cipher_spec] [-D [bind_address:]port]">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux ssh命令">
<meta property="og:url" content="http://shaoguangleo.github.io/2013/01/24/linux-ssh/index.html">
<meta property="og:site_name" content="浩瀚宇宙 灿烂星空">
<meta property="og:description" content="ssh远程登录必备神器接着ssh的入门操作 继续ssh的大杂烩。 官方定义为：  ssh — OpenSSH remote login client  使用方法为： 1234$ ssh [-46AaCfGgKkMNnqsTtVvXxYy] [-B bind_interface] [-b bind_address] [-c cipher_spec] [-D [bind_address:]port]">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2013-01-24T14:11:00.000Z">
<meta property="article:modified_time" content="2025-06-19T13:19:18.903Z">
<meta property="article:author" content="郭大侠">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="ssh">
<meta property="article:tag" content="scp">
<meta property="article:tag" content="known_hosts">
<meta property="article:tag" content="StrictHostKeyChecking">
<meta property="article:tag" content="fg">
<meta property="article:tag" content="hostkeys">
<meta property="article:tag" content="ssh-keygen">
<meta property="article:tag" content="sftp">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://shaoguangleo.github.io/2013/01/24/linux-ssh/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Linux ssh命令 | 浩瀚宇宙 灿烂星空</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=a8cfacb0a536bd846d2fd545cedb4d61"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'a8cfacb0a536bd846d2fd545cedb4d61');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a8cfacb0a536bd846d2fd545cedb4d61";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="浩瀚宇宙 灿烂星空" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">浩瀚宇宙 灿烂星空</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">工作和生活中的七七八八</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2013/01/24/linux-ssh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux ssh命令
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2013-01-24 22:11:00" itemprop="dateCreated datePublished" datetime="2013-01-24T22:11:00+08:00">2013-01-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E5%A4%A7%E6%9D%82%E7%83%A9/" itemprop="url" rel="index"><span itemprop="name">Linux大杂烩</span></a>
                </span>
            </span>

          
            <span id="/2013/01/24/linux-ssh/" class="post-meta-item leancloud_visitors" data-flag-title="Linux ssh命令" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2013/01/24/linux-ssh/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2013/01/24/linux-ssh/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2013/01/24/linux-ssh/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2013/01/24/linux-ssh/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="ssh远程登录必备神器"><a href="#ssh远程登录必备神器" class="headerlink" title="ssh远程登录必备神器"></a>ssh远程登录必备神器</h1><p>接着<code>ssh</code>的入门操作 继续<code>ssh</code>的大杂烩。</p>
<p>官方定义为：</p>
<blockquote>
<p><code>ssh</code> — OpenSSH remote login client</p>
</blockquote>
<p>使用方法为：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh [-46AaCfGgKkMNnqsTtVvXxYy] [-B bind_interface] [-b bind_address] [-c cipher_spec] [-D [bind_address:]port]</span><br><span class="line">         [-E log_file] [-e escape_char] [-F configfile] [-I pkcs11] [-i identity_file] [-J destination] [-L address]</span><br><span class="line">         [-l login_name] [-m mac_spec] [-O ctl_cmd] [-o option] [-p port] [-Q query_option] [-R address]</span><br><span class="line">         [-S ctl_path] [-W host:port] [-w local_tun[:remote_tun]] destination [<span class="built_in">command</span>]</span><br></pre></td></tr></tbody></table></figure>



<p>除了前面说的参数外，还有下面的一些参数：</p>
<h2 id="取消使用ssh时需要输入密码的方法"><a href="#取消使用ssh时需要输入密码的方法" class="headerlink" title="取消使用ssh时需要输入密码的方法"></a>取消使用ssh时需要输入密码的方法</h2><p>有些时候，我们在复制/移动文件到另一台机器时会用到<code>scp</code>，因为它比较安全，但对于远端服务器如果每次都要输入密码，就比较烦了，尤其是在脚本里面，3、5个文件还能接受，如果传输1000个文件就需要输入1000遍密码。</p>
<p>所以此时<code>ssh</code>就有了有另一种用密钥对来验证的方式，具体方式如下：</p>
<ol>
<li>第一步：生成密匙对，我用的是rsa密钥。使用命令 <code>ssh-keygen -t rsa</code>，直接回车就可以；</li>
<li>修改目录的权限<code>chmod 755 ~/.ssh</code>；</li>
<li>将公共密钥复制的远程机器<code>scp ~/.ssh/id_rsa.pub  remoteIP:/home/username/</code></li>
<li>将公共密钥添加到<code>cat ~/.ssh/id_rsa.pub &gt;&gt; /home/username/.ssh/authorized_keys</code></li>
</ol>
<p>看着蛮复杂的，其实就是把本机的公钥告诉远程服务器，就可以不用输入秘钥就可以登陆了。</p>
<p>还有一种简单的方法，如下：</p>
<ol>
<li>第一步：生成密匙对，我用的是<strong>rsa</strong>密钥。使用命令 <code>ssh-keygen -t rsa</code>，直接回车就可以；</li>
<li>然后使用<code>ssh-copy-id username@IP</code>既可完成。</li>
</ol>
<p>此时即可在使用<code>ssh</code>、<code>scp</code>、<code>sftp</code>的时候不用输入密码了。</p>
<h2 id="使用自定义名来取代用户名-IP的方法"><a href="#使用自定义名来取代用户名-IP的方法" class="headerlink" title="使用自定义名来取代用户名@IP的方法"></a>使用自定义名来取代用户名@IP的方法</h2><p>当前的情况是，远程登陆还需要输入诸如<code>ssh username@192.168.111.123</code>，每次都敲又臭又长的IP地址十分难以忍受，很难想象如果使用IPv6，会是多么崩溃的情况。</p>
<p>所以如果可以使用<code>ssh work</code>登陆工作机，<code>ssh school</code>登陆学校机，将是一件十分幸福的事情。</p>
<p>方法很简单，创建文件<u>~./ssh/config</u>，内容如下：</p>
<figure class="highlight crmsh"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Host work</span><br><span class="line">  <span class="keyword">User</span> <span class="title">username</span></span><br><span class="line">  HostName <span class="number">192.168</span>.<span class="number">0.120</span></span><br><span class="line">  </span><br><span class="line">Host school</span><br><span class="line">  <span class="keyword">User</span> <span class="title">username</span></span><br><span class="line">  HostName <span class="number">192.168</span>.<span class="number">0.110</span></span><br><span class="line">  </span><br></pre></td></tr></tbody></table></figure>



<p>在设定好上面的配置文件后，在搭配免密输入，那么此时的</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh work</span><br></pre></td></tr></tbody></table></figure>

<p>将等效于</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh username@192.168.0.120</span><br></pre></td></tr></tbody></table></figure>

<p>以下类似。</p>
<p>Enjoy~</p>
<p>#####待分享</p>
<h2 id="ssh中“Host-key-verification-failed-“的解决方案"><a href="#ssh中“Host-key-verification-failed-“的解决方案" class="headerlink" title="ssh中“Host key verification failed.“的解决方案"></a>ssh中“Host key verification failed.“的解决方案</h2><p>前面说过有个比较简单的方式是直接删除ssh的记录文件即可，即：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> ~/.ssh/known_hosts /tmp</span><br></pre></td></tr></tbody></table></figure>

<p>而对于比较永久的考虑，可以修改ssh的配置文件，即：</p>
<p>SSH对主机的public_key的检查等级是根据StrictHostKeyChecking变量来配置的。默认情况下，StrictHostKeyChecking=ask。简单所下它的三种配置值：</p>
<ul>
<li>StrictHostKeyChecking=no  #最不安全的级别，当然也没有那么多烦人的提示了，相对安全的内网测试时建议使用。如果连接server的key在本地不存在，那么就自动添加到文件中（默认是known_hosts），并且给出一个警告。</li>
<li>StrictHostKeyChecking=ask  #默认的级别，就是出现刚才的提示了。如果连接和key不匹配，给出提示，并拒绝登录。</li>
<li>StrictHostKeyChecking=yes  #最安全的级别，如果连接与key不匹配，就拒绝连接，不会提示详细信息。</li>
</ul>
<p>我们可以设置：StrictHostKeyChecking=no这样就不会出现这个问题了。</p>
<h2 id="用SSH退出符切换SSH会话"><a href="#用SSH退出符切换SSH会话" class="headerlink" title="用SSH退出符切换SSH会话"></a>用SSH退出符切换SSH会话</h2><p>这个技巧非常实用。尤其是远程登陆到一台主机A，然后从A登陆到B，如果希望在A上做一些操作，还得再开一个终端，很是麻烦。</p>
<p>当你已经登录到了远程主机时，你可能想要回到本地主机进行一些操作，然后又继续回到远程主机。在这种情况下，没有必要断开远程主机的会话，你可以用下面的办法来完成：</p>
<ol>
<li><pre><code>登入远程主机：
</code></pre>
</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh remote1@remotehost</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li><pre><code>已连接远程主机：
</code></pre>
</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">remotehost$</span><br></pre></td></tr></tbody></table></figure>
<ol start="3">
<li><pre><code>要临时回到本地主机，输入退出符号：“~”与“Control-Z”组合
</code></pre>
</li>
<li><pre><code>现在你已经退回到了本地主机，ssh远程客户端会话就在UNIX后台中运行，你可以向下面那样查看它：
</code></pre>
</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localhost$ <span class="built_in">jobs</span></span><br><span class="line">[1]+ Stopped ssh -l remote1 remotehost</span><br></pre></td></tr></tbody></table></figure>

<ol start="5">
<li><pre><code>你可以将后台运行的ssh会话进程切换到前台，重新回到远程主机，而无需输入密码
</code></pre>
</li>
</ol>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">localhost$ <span class="built_in">fg</span> %1</span><br><span class="line">ssh remote1@remotehost </span><br><span class="line">remotehost$</span><br></pre></td></tr></tbody></table></figure>

<h2 id="调试SSH客户端会话"><a href="#调试SSH客户端会话" class="headerlink" title="调试SSH客户端会话"></a>调试SSH客户端会话</h2><p>当ssh连接出现问题时，我们需要通过查看调试信息来定位这些错误。一般来讲使用v选项(注意：是小写的v)，即可查看调试信息。</p>
<p>不加调试的使用方法为：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ssh</span> -l  username remotehost.example.com</span><br></pre></td></tr></tbody></table></figure>

<p>增加调试的使用方法为：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ssh</span> –v -l  username remotehost.example.com</span><br></pre></td></tr></tbody></table></figure>

<p>如此这般，机会出现比较详细的debug信息了。</p>
<h2 id="用SSH登录到远程主机"><a href="#用SSH登录到远程主机" class="headerlink" title="用SSH登录到远程主机"></a>用SSH登录到远程主机</h2><p>当你第一次使用ssh登录远程主机时，会出现没有找到主机密钥的提示信息。输入“yes”后，系统会将远程主机的密钥加入到你的主目录下的 .ssh/hostkeys下，这样你就可以继续操作了。</p>
<p>使用方法为：</p>
<figure class="highlight gams"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"><span class="keyword">$ssh</span> -l  username remotehost.example.com</span></span><br></pre></td></tr></tbody></table></figure>

<p>因为远程主机的密钥已经加入到ssh客户端的已知主机列表中，当你第二次登陆远程主机时，只需要你输入远程主机的登录密码即可。</p>
<p>由于各种原因，可能在你第一次登陆远程主机后，该主机的密钥发生改变，你将会看到一些警告信息。出现这种情况，可能有两个原因：</p>
<ul>
<li>系统管理员在远程主机上升级或者重新安装了SSH服务器</li>
<li>有人在进行一些恶意行为，等等。</li>
</ul>
<p>此时你可以通过删除hostkeys来解决。</p>
<h2 id="解决SSH一段时间不操作就退出的问题"><a href="#解决SSH一段时间不操作就退出的问题" class="headerlink" title="解决SSH一段时间不操作就退出的问题"></a>解决SSH一段时间不操作就退出的问题</h2><p>在CentOS系统上，SSH登录后，一段时间如果不操作，SSH就会自动退出。</p>
<p>解决这个问题的办法，可以修改SSH服务器端的配置，也可以修改SSH客户端的配置。</p>
<h3 id="修改SSH服务端的配置"><a href="#修改SSH服务端的配置" class="headerlink" title="修改SSH服务端的配置"></a>修改SSH服务端的配置</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> vim /etc/ssd/sshd_config</span><br></pre></td></tr></tbody></table></figure>

<p>把下面这两行的注册打开，然后修改参数：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ClientAliveInterval 30 <span class="comment"># 表示每30秒服务器向客户端发起一次心跳，如果客户端响应就保持连接</span></span><br><span class="line">ClientAliveCountMax 5 <span class="comment"># 如果连续5服务器收不到心跳，就断开连接</span></span><br></pre></td></tr></tbody></table></figure>

<p>以上两个参数，可以根据自己的情况来设置。</p>
<p>最后，配置要生效，需要重启sshd服务：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ service sshd restart</span><br></pre></td></tr></tbody></table></figure>

<p>正常情况，客户端不会不响应服务器的心跳，因此SSH客户端就不会再自动退出了。</p>
<h3 id="修改SSH客户端的配置"><a href="#修改SSH客户端的配置" class="headerlink" title="修改SSH客户端的配置"></a>修改SSH客户端的配置</h3><p>修改客户端的配置的好处是，不需要重启服务端，如果你没有权限修改SSH服务器，也只能修改客户端的配置了。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> vim /etc/ssh/ssh_config</span><br></pre></td></tr></tbody></table></figure>

<p>增加如下内容：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">TCPKeepAlive <span class="built_in">yes</span> <span class="comment"># 据说这个配置项默认是开启的</span></span><br><span class="line">ServerAliveInterval 30  <span class="comment">#客户端主动向服务端请求响应的间隔</span></span><br><span class="line">ServerAliveCountMax 5 <span class="comment"># 连续5此客户端收不到服务器的响应，就是退出链接</span></span><br></pre></td></tr></tbody></table></figure>

<p>好像大家都不太喜欢修改客户端的配置，而更新换直接在ssh命令行上输入这些配置项：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -o TCPKeepAlive=<span class="built_in">yes</span> -o ServerAliveInterval=30 -o ServerAliveCountMax=5 username@serverip</span><br></pre></td></tr></tbody></table></figure>

<p>使用的是-o参数。</p>
<p>描述</p>
<p>ssh (ssh client)旨在促进在不安全的网络上提供两个不受信任的主机之间的安全加密通信。</p>
<p>支持多种协议。</p>
<p>如果指定了命令，它将在远程主机上执行，而不是在登录shell上执行。</p>
<pre><code> -4      强制ssh只使用IPv4地址
 -6      强制ssh仅使用IPv6地址
 -A      允许从认证代理(如ssh-agent)转发连接，慎用，有风险。最好使用下面的跳转主机方法(参见-J)
 -a      禁止转发认证代理连接
 -B bind_interface 在连接到目标主机之前，绑定到bind_interface地址，在系统有多个IP地址时有用。
 -b bind_address 在本地机器上使用bind_address作为连接的源地址，在系统有多个IP地址时有用。
 -E log_file  将调试日志追加到log_file文件而不是标准错误
</code></pre>
<p>​<br>​<br>​<br>​<br>​<br>​<br>​<br>     -e escape_char<br>             Sets the escape character for sessions with a pty (default: ‘~’).  The escape character is only recognized at the beginning of<br>             a line.  The escape character followed by a dot (‘.’) closes the connection; followed by control-Z suspends the connection; and<br>             followed by itself sends the escape character once.  Setting the character to “none” disables any escapes and makes the session   fully transparent.</p>
<pre><code> -F configfile
         Specifies an alternative per-user configuration file.  If a configuration file is given on the command line, the system-wide
         configuration file (/etc/ssh/ssh_config) will be ignored.  The default for the per-user configuration file is ~/.ssh/config.

 -f      Requests ssh to go to background just before command execution.  This is useful if ssh is going to ask for passwords or
         passphrases, but the user wants it in the background.  This implies -n.  The recommended way to start X11 programs at a remote  site is with something like ssh -f host xterm.

         If the ExitOnForwardFailure configuration option is set to “yes”, then a client started with -f will wait for all remote port  forwards to be successfully established before placing itself in the background.

 -G      Causes ssh to print its configuration after evaluating Host and Match blocks and exit.

 -g      Allows remote hosts to connect to local forwarded ports.  If used on a multiplexed connection, then this option must be specified on the master process.

 -I pkcs11
         Specify the PKCS#11 shared library ssh should use to communicate with a PKCS#11 token providing keys for user authentication.

 -i identity_file
         Selects a file from which the identity (private key) for public key authentication is read.  The default is ~/.ssh/id_dsa,
         ~/.ssh/id_ecdsa, ~/.ssh/id_ecdsa_sk, ~/.ssh/id_ed25519, ~/.ssh/id_ed25519_sk and ~/.ssh/id_rsa.  Identity files may also be
         specified on a per-host basis in the configuration file.  It is possible to have multiple -i options (and multiple identities
         specified in configuration files).  If no certificates have been explicitly specified by the CertificateFile directive, ssh
         will also try to load certificate information from the filename obtained by appending -cert.pub to identity filenames.

 -J destination
         Connect to the target host by first making a ssh connection to the jump host described by destination and then establishing a
         TCP forwarding to the ultimate destination from there.  Multiple jump hops may be specified separated by comma characters.
         This is a shortcut to specify a ProxyJump configuration directive.  Note that configuration directives supplied on the command-
         line generally apply to the destination host and not any specified jump hosts.  Use ~/.ssh/config to specify configuration for
         jump hosts.

 -K      Enables GSSAPI-based authentication and forwarding (delegation) of GSSAPI credentials to the server.

 -k      Disables forwarding (delegation) of GSSAPI credentials to the server.

 -L [bind_address:]port:host:hostport
 -L [bind_address:]port:remote_socket
 -L local_socket:host:hostport
 -L local_socket:remote_socket
         Specifies that connections to the given TCP port or Unix socket on the local (client) host are to be forwarded to the given   host and port, or Unix socket, on the remote side.  This works by allocating a socket to listen to either a TCP port on the local side, optionally bound to the specified bind_address, or to a Unix socket.  Whenever a connection is made to the local port or socket, the connection is forwarded over the secure channel, and a connection is made to either host port hostport, or the   Unix socket remote_socket, from the remote machine.

         Port forwardings can also be specified in the configuration file.  Only the superuser can forward privileged ports.  IPv6 addresses can be specified by enclosing the address in square brackets.

         By default, the local port is bound in accordance with the GatewayPorts setting.  However, an explicit bind_address may be used  to bind the connection to a specific address.  The bind_address of “localhost” indicates that the listening port be bound for
         local use only, while an empty address or ‘*’ indicates that the port should be available from all interfaces.


 -M      Places the ssh client into “master” mode for connection sharing.  Multiple -M options places ssh into “master” mode but with   confirmation required using ssh-askpass(1) before each operation that changes the multiplexing state (e.g. opening a new session).  Refer to the description of ControlMaster in ssh_config(5) for details.

 -m mac_spec
         A comma-separated list of MAC (message authentication code) algorithms, specified in order of preference.  See the MACs keyword
         for more information.

 -N      Do not execute a remote command.  This is useful for just forwarding ports.

 -n      Redirects stdin from /dev/null (actually, prevents reading from stdin).  This must be used when ssh is run in the background.
         A common trick is to use this to run X11 programs on a remote machine.  For example, ssh -n shadows.cs.hut.fi emacs &amp; will
         start an emacs on shadows.cs.hut.fi, and the X11 connection will be automatically forwarded over an encrypted channel.  The ssh
         program will be put in the background.  (This does not work if ssh needs to ask for a password or passphrase; see also the -f
         option.)

 -O ctl_cmd
         Control an active connection multiplexing master process.  When the -O option is specified, the ctl_cmd argument is interpreted
         and passed to the master process.  Valid commands are: “check” (check that the master process is running), “forward” (request
         forwardings without command execution), “cancel” (cancel forwardings), “exit” (request the master to exit), and “stop” (request
         the master to stop accepting further multiplexing requests).

 -o option
         Can be used to give options in the format used in the configuration file.  This is useful for specifying options for which
         there is no separate command-line flag.  For full details of the options listed below, and their possible values, see
         ssh_config(5).

               AddKeysToAgent
               AddressFamily
               BatchMode
               BindAddress
               CanonicalDomains
               CanonicalizeFallbackLocal
               CanonicalizeHostname
               CanonicalizeMaxDots
               CanonicalizePermittedCNAMEs
               CASignatureAlgorithms
               CertificateFile
               ChallengeResponseAuthentication
               CheckHostIP
               Ciphers
               ClearAllForwardings
               Compression
               ConnectionAttempts
               ConnectTimeout
               ControlMaster
               ControlPath
               ControlPersist
               DynamicForward
               EscapeChar
               ExitOnForwardFailure
               FingerprintHash
               ForwardAgent
               ForwardX11
               ForwardX11Timeout
               ForwardX11Trusted
               GatewayPorts
               GlobalKnownHostsFile
               GSSAPIAuthentication
               GSSAPIKeyExchange
               GSSAPIClientIdentity
               GSSAPIDelegateCredentials
               GSSAPIKexAlgorithms
               GSSAPIRenewalForcesRekey
               GSSAPIServerIdentity
               GSSAPITrustDns
               HashKnownHosts
               Host
               HostbasedAuthentication
               HostbasedKeyTypes
               HostKeyAlgorithms
               HostKeyAlias
               Hostname
               IdentitiesOnly
               IdentityAgent
               IdentityFile
               IPQoS
               KbdInteractiveAuthentication
               KbdInteractiveDevices
               KexAlgorithms
               LocalCommand
               LocalForward
               LogLevel
               MACs
               Match
               NoHostAuthenticationForLocalhost
               NumberOfPasswordPrompts
               PasswordAuthentication
               PermitLocalCommand
               PKCS11Provider
               Port
               PreferredAuthentications
               ProxyCommand
               ProxyJump
               ProxyUseFdpass
               PubkeyAcceptedKeyTypes
               PubkeyAuthentication
               RekeyLimit
               RemoteCommand
               RemoteForward
               RequestTTY
               SendEnv
               ServerAliveInterval
               ServerAliveCountMax
               SetEnv
               StreamLocalBindMask
               StreamLocalBindUnlink
               StrictHostKeyChecking
               TCPKeepAlive
               Tunnel
               TunnelDevice
               UpdateHostKeys
               User
               UserKnownHostsFile
               VerifyHostKeyDNS
               VisualHostKey
               XAuthLocation

 -Q query_option
         Queries ssh for the algorithms supported for the specified version 2.  The available features are: cipher (supported symmetric
         ciphers), cipher-auth (supported symmetric ciphers that support authenticated encryption), help (supported query terms for use
         with the -Q flag), mac (supported message integrity codes), kex (key exchange algorithms), kex-gss (GSSAPI key exchange algo‐
         rithms), key (key types), key-cert (certificate key types), key-plain (non-certificate key types), key-sig (all key types and
         signature algorithms), protocol-version (supported SSH protocol versions), and sig (supported signature algorithms).  Alterna‐
         tively, any keyword from ssh_config(5) or sshd_config(5) that takes an algorithm list may be used as an alias for the corre‐
         sponding query_option.

 -q      Quiet mode.  Causes most warning and diagnostic messages to be suppressed.

 -R [bind_address:]port:host:hostport
 -R [bind_address:]port:local_socket
 -R remote_socket:host:hostport
 -R remote_socket:local_socket
 -R [bind_address:]port
         Specifies that connections to the given TCP port or Unix socket on the remote (server) host are to be forwarded to the local
         side.

         This works by allocating a socket to listen to either a TCP port or to a Unix socket on the remote side.  Whenever a connection
         is made to this port or Unix socket, the connection is forwarded over the secure channel, and a connection is made from the lo‐
         cal machine to either an explicit destination specified by host port hostport, or local_socket, or, if no explicit destination
         was specified, ssh will act as a SOCKS 4/5 proxy and forward connections to the destinations requested by the remote SOCKS
         client.

         Port forwardings can also be specified in the configuration file.  Privileged ports can be forwarded only when logging in as
         root on the remote machine.  IPv6 addresses can be specified by enclosing the address in square brackets.

         By default, TCP listening sockets on the server will be bound to the loopback interface only.  This may be overridden by speci‐
         fying a bind_address.  An empty bind_address, or the address ‘*’, indicates that the remote socket should listen on all inter‐
         faces.  Specifying a remote bind_address will only succeed if the server's GatewayPorts option is enabled (see sshd_config(5)).

         If the port argument is ‘0’, the listen port will be dynamically allocated on the server and reported to the client at run
         time.  When used together with -O forward the allocated port will be printed to the standard output.

 -S ctl_path
         Specifies the location of a control socket for connection sharing, or the string “none” to disable connection sharing.  Refer
         to the description of ControlPath and ControlMaster in ssh_config(5) for details.

 -s      May be used to request invocation of a subsystem on the remote system.  Subsystems facilitate the use of SSH as a secure trans‐
         port for other applications (e.g. sftp(1)).  The subsystem is specified as the remote command.

 -T      Disable pseudo-terminal allocation.

 -t      Force pseudo-terminal allocation.  This can be used to execute arbitrary screen-based programs on a remote machine, which can
         be very useful, e.g. when implementing menu services.  Multiple -t options force tty allocation, even if ssh has no local tty.

 -V      Display the version number and exit.

 -v      Verbose mode.  Causes ssh to print debugging messages about its progress.  This is helpful in debugging connection, authentica‐
         tion, and configuration problems.  Multiple -v options increase the verbosity.  The maximum is 3.

 -W host:port
         Requests that standard input and output on the client be forwarded to host on port over the secure channel.  Implies -N, -T,
         ExitOnForwardFailure and ClearAllForwardings, though these can be overridden in the configuration file or using -o command line
         options.

 -w local_tun[:remote_tun]
         Requests tunnel device forwarding with the specified tun(4) devices between the client (local_tun) and the server (remote_tun).

         The devices may be specified by numerical ID or the keyword “any”, which uses the next available tunnel device.  If remote_tun
         is not specified, it defaults to “any”.  See also the Tunnel and TunnelDevice directives in ssh_config(5).

         If the Tunnel directive is unset, it will be set to the default tunnel mode, which is “point-to-point”.  If a different Tunnel
         forwarding mode it desired, then it should be specified before -w.

 -X      Enables X11 forwarding.  This can also be specified on a per-host basis in a configuration file.

         X11 forwarding should be enabled with caution.  Users with the ability to bypass file permissions on the remote host (for the
         user's X authorization database) can access the local X11 display through the forwarded connection.  An attacker may then be
         able to perform activities such as keystroke monitoring.

         For this reason, X11 forwarding is subjected to X11 SECURITY extension restrictions by default.  Please refer to the ssh -Y op‐
         tion and the ForwardX11Trusted directive in ssh_config(5) for more information.

         (Debian-specific: X11 forwarding is not subjected to X11 SECURITY extension restrictions by default, because too many programs
         currently crash in this mode.  Set the ForwardX11Trusted option to “no” to restore the upstream behaviour.  This may change in
         future depending on client-side improvements.)

 -x      Disables X11 forwarding.

 -Y      Enables trusted X11 forwarding.  Trusted X11 forwardings are not subjected to the X11 SECURITY extension controls.

         (Debian-specific: In the default configuration, this option is equivalent to -X, since ForwardX11Trusted defaults to “yes” as
         described above.  Set the ForwardX11Trusted option to “no” to restore the upstream behaviour.  This may change in future de‐
         pending on client-side improvements.)

 -y      Send log information using the syslog(3) system module.  By default this information is sent to stderr.

 ssh may additionally obtain configuration data from a per-user configuration file and a system-wide configuration file.  The file for‐
 mat and configuration options are described in ssh_config(5).
</code></pre>
<p>AUTHENTICATION<br>     The OpenSSH SSH client supports SSH protocol 2.</p>
<pre><code> The methods available for authentication are: GSSAPI-based authentication, host-based authentication, public key authentication, chal‐
 lenge-response authentication, and password authentication.  Authentication methods are tried in the order specified above, though
 PreferredAuthentications can be used to change the default order.

 Host-based authentication works as follows: If the machine the user logs in from is listed in /etc/hosts.equiv or /etc/ssh/shosts.equiv
 on the remote machine, and the user names are the same on both sides, or if the files ~/.rhosts or ~/.shosts exist in the user's home
 directory on the remote machine and contain a line containing the name of the client machine and the name of the user on that machine,
 the user is considered for login.  Additionally, the server must be able to verify the client's host key (see the description of
 /etc/ssh/ssh_known_hosts and ~/.ssh/known_hosts, below) for login to be permitted.  This authentication method closes security holes
 due to IP spoofing, DNS spoofing, and routing spoofing.  [Note to the administrator: /etc/hosts.equiv, ~/.rhosts, and the rlogin/rsh
 protocol in general, are inherently insecure and should be disabled if security is desired.]

 Public key authentication works as follows: The scheme is based on public-key cryptography, using cryptosystems where encryption and
 decryption are done using separate keys, and it is unfeasible to derive the decryption key from the encryption key.  The idea is that
 each user creates a public/private key pair for authentication purposes.  The server knows the public key, and only the user knows the
 private key.  ssh implements public key authentication protocol automatically, using one of the DSA, ECDSA, Ed25519 or RSA algorithms.
 The HISTORY section of ssl(8) (on non-OpenBSD systems, see http://www.openbsd.org/cgi-bin/man.cgi?query=ssl&amp;sektion=8#HISTORY) contains
 a brief discussion of the DSA and RSA algorithms.

 The file ~/.ssh/authorized_keys lists the public keys that are permitted for logging in.  When the user logs in, the ssh program tells
 the server which key pair it would like to use for authentication.  The client proves that it has access to the private key and the
 server checks that the corresponding public key is authorized to accept the account.

 The server may inform the client of errors that prevented public key authentication from succeeding after authentication completes us‐
 ing a different method.  These may be viewed by increasing the LogLevel to DEBUG or higher (e.g. by using the -v flag).

 The user creates his/her key pair by running ssh-keygen(1).  This stores the private key in ~/.ssh/id_dsa (DSA), ~/.ssh/id_ecdsa
 (ECDSA), ~/.ssh/id_ecdsa_sk (authenticator-hosted ECDSA), ~/.ssh/id_ed25519 (Ed25519), ~/.ssh/id_ed25519_sk (authenticator-hosted
 Ed25519), or ~/.ssh/id_rsa (RSA) and stores the public key in ~/.ssh/id_dsa.pub (DSA), ~/.ssh/id_ecdsa.pub (ECDSA),
 ~/.ssh/id_ecdsa_sk.pub (authenticator-hosted ECDSA), ~/.ssh/id_ed25519.pub (Ed25519), ~/.ssh/id_ed25519_sk.pub (authenticator-hosted
 Ed25519), or ~/.ssh/id_rsa.pub (RSA) in the user's home directory.  The user should then copy the public key to ~/.ssh/authorized_keys
 in his/her home directory on the remote machine.  The authorized_keys file corresponds to the conventional ~/.rhosts file, and has one
 key per line, though the lines can be very long.  After this, the user can log in without giving the password.

 A variation on public key authentication is available in the form of certificate authentication: instead of a set of public/private
 keys, signed certificates are used.  This has the advantage that a single trusted certification authority can be used in place of many
 public/private keys.  See the CERTIFICATES section of ssh-keygen(1) for more information.

 The most convenient way to use public key or certificate authentication may be with an authentication agent.  See ssh-agent(1) and (op‐
 tionally) the AddKeysToAgent directive in ssh_config(5) for more information.

 Challenge-response authentication works as follows: The server sends an arbitrary "challenge" text, and prompts for a response.  Exam‐
 ples of challenge-response authentication include BSD Authentication (see login.conf(5)) and PAM (some non-OpenBSD systems).

 Finally, if other authentication methods fail, ssh prompts the user for a password.  The password is sent to the remote host for check‐
 ing; however, since all communications are encrypted, the password cannot be seen by someone listening on the network.

 ssh automatically maintains and checks a database containing identification for all hosts it has ever been used with.  Host keys are
 stored in ~/.ssh/known_hosts in the user's home directory.  Additionally, the file /etc/ssh/ssh_known_hosts is automatically checked
 for known hosts.  Any new hosts are automatically added to the user's file.  If a host's identification ever changes, ssh warns about
 this and disables password authentication to prevent server spoofing or man-in-the-middle attacks, which could otherwise be used to
 circumvent the encryption.  The StrictHostKeyChecking option can be used to control logins to machines whose host key is not known or
 has changed.

 When the user's identity has been accepted by the server, the server either executes the given command in a non-interactive session or,
 if no command has been specified, logs into the machine and gives the user a normal shell as an interactive session.  All communication
 with the remote command or shell will be automatically encrypted.

 If an interactive session is requested ssh by default will only request a pseudo-terminal (pty) for interactive sessions when the
 client has one.  The flags -T and -t can be used to override this behaviour.

 If a pseudo-terminal has been allocated the user may use the escape characters noted below.

 If no pseudo-terminal has been allocated, the session is transparent and can be used to reliably transfer binary data.  On most sys‐
 tems, setting the escape character to “none” will also make the session transparent even if a tty is used.

 The session terminates when the command or shell on the remote machine exits and all X11 and TCP connections have been closed.
</code></pre>
<p>ESCAPE CHARACTERS<br>     When a pseudo-terminal has been requested, ssh supports a number of functions through the use of an escape character.</p>
<pre><code> A single tilde character can be sent as ~~ or by following the tilde by a character other than those described below.  The escape char‐
 acter must always follow a newline to be interpreted as special.  The escape character can be changed in configuration files using the
 EscapeChar configuration directive or on the command line by the -e option.

 The supported escapes (assuming the default ‘~’) are:

 ~.      Disconnect.

 ~^Z     Background ssh.

 ~#      List forwarded connections.

 ~&amp;      Background ssh at logout when waiting for forwarded connection / X11 sessions to terminate.

 ~?      Display a list of escape characters.

 ~B      Send a BREAK to the remote system (only useful if the peer supports it).

 ~C      Open command line.  Currently this allows the addition of port forwardings using the -L, -R and -D options (see above).  It
         also allows the cancellation of existing port-forwardings with -KL[bind_address:]port for local, -KR[bind_address:]port for re‐
         mote and -KD[bind_address:]port for dynamic port-forwardings.  !command allows the user to execute a local command if the
         PermitLocalCommand option is enabled in ssh_config(5).  Basic help is available, using the -h option.

 ~R      Request rekeying of the connection (only useful if the peer supports it).

 ~V      Decrease the verbosity (LogLevel) when errors are being written to stderr.

 ~v      Increase the verbosity (LogLevel) when errors are being written to stderr.
</code></pre>
<p>TCP FORWARDING<br>     Forwarding of arbitrary TCP connections over a secure channel can be specified either on the command line or in a configuration file.<br>     One possible application of TCP forwarding is a secure connection to a mail server; another is going through firewalls.</p>
<pre><code> In the example below, we look at encrypting communication for an IRC client, even though the IRC server it connects to does not di‐
 rectly support encrypted communication.  This works as follows: the user connects to the remote host using ssh, specifying the ports to
 be used to forward the connection.  After that it is possible to start the program locally, and ssh will encrypt and forward the con‐
 nection to the remote server.

 The following example tunnels an IRC session from the client to an IRC server at “server.example.com”, joining channel “#users”, nick‐
 name “pinky”, using the standard IRC port, 6667:

     $ ssh -f -L 6667:localhost:6667 server.example.com sleep 10
     $ irc -c '#users' pinky IRC/127.0.0.1

 The -f option backgrounds ssh and the remote command “sleep 10” is specified to allow an amount of time (10 seconds, in the example) to
 start the program which is going to use the tunnel.  If no connections are made within the time specified, ssh will exit.
</code></pre>
<p>X11 FORWARDING<br>     If the ForwardX11 variable is set to “yes” (or see the description of the -X, -x, and -Y options above) and the user is using X11 (the<br>     DISPLAY environment variable is set), the connection to the X11 display is automatically forwarded to the remote side in such a way<br>     that any X11 programs started from the shell (or command) will go through the encrypted channel, and the connection to the real X<br>     server will be made from the local machine.  The user should not manually set DISPLAY.  Forwarding of X11 connections can be configured<br>     on the command line or in configuration files.</p>
<pre><code> The DISPLAY value set by ssh will point to the server machine, but with a display number greater than zero.  This is normal, and hap‐
 pens because ssh creates a “proxy” X server on the server machine for forwarding the connections over the encrypted channel.

 ssh will also automatically set up Xauthority data on the server machine.  For this purpose, it will generate a random authorization
 cookie, store it in Xauthority on the server, and verify that any forwarded connections carry this cookie and replace it by the real
 cookie when the connection is opened.  The real authentication cookie is never sent to the server machine (and no cookies are sent in
 the plain).

 If the ForwardAgent variable is set to “yes” (or see the description of the -A and -a options above) and the user is using an authenti‐
 cation agent, the connection to the agent is automatically forwarded to the remote side.
</code></pre>
<p>VERIFYING HOST KEYS<br>     When connecting to a server for the first time, a fingerprint of the server’s public key is presented to the user (unless the option<br>     StrictHostKeyChecking has been disabled).  Fingerprints can be determined using ssh-keygen(1):</p>
<pre><code>       $ ssh-keygen -l -f /etc/ssh/ssh_host_rsa_key

 If the fingerprint is already known, it can be matched and the key can be accepted or rejected.  If only legacy (MD5) fingerprints for
 the server are available, the ssh-keygen(1) -E option may be used to downgrade the fingerprint algorithm to match.

 Because of the difficulty of comparing host keys just by looking at fingerprint strings, there is also support to compare host keys
 visually, using random art.  By setting the VisualHostKey option to “yes”, a small ASCII graphic gets displayed on every login to a
 server, no matter if the session itself is interactive or not.  By learning the pattern a known server produces, a user can easily find
 out that the host key has changed when a completely different pattern is displayed.  Because these patterns are not unambiguous how‐
 ever, a pattern that looks similar to the pattern remembered only gives a good probability that the host key is the same, not guaran‐
 teed proof.

 To get a listing of the fingerprints along with their random art for all known hosts, the following command line can be used:

       $ ssh-keygen -lv -f ~/.ssh/known_hosts

 If the fingerprint is unknown, an alternative method of verification is available: SSH fingerprints verified by DNS.  An additional re‐
 source record (RR), SSHFP, is added to a zonefile and the connecting client is able to match the fingerprint with that of the key pre‐
 sented.

 In this example, we are connecting a client to a server, “host.example.com”.  The SSHFP resource records should first be added to the
 zonefile for host.example.com:

       $ ssh-keygen -r host.example.com.

 The output lines will have to be added to the zonefile.  To check that the zone is answering fingerprint queries:

       $ dig -t SSHFP host.example.com

 Finally the client connects:

       $ ssh -o "VerifyHostKeyDNS ask" host.example.com
       [...]
       Matching host key fingerprint found in DNS.
       Are you sure you want to continue connecting (yes/no)?

 See the VerifyHostKeyDNS option in ssh_config(5) for more information.
</code></pre>
<p>SSH-BASED VIRTUAL PRIVATE NETWORKS<br>     ssh contains support for Virtual Private Network (VPN) tunnelling using the tun(4) network pseudo-device, allowing two networks to be<br>     joined securely.  The sshd_config(5) configuration option PermitTunnel controls whether the server supports this, and at what level<br>     (layer 2 or 3 traffic).</p>
<pre><code> The following example would connect client network 10.0.50.0/24 with remote network 10.0.99.0/24 using a point-to-point connection from
 10.1.1.1 to 10.1.1.2, provided that the SSH server running on the gateway to the remote network, at 192.168.1.15, allows it.

 On the client:

       # ssh -f -w 0:1 192.168.1.15 true
       # ifconfig tun0 10.1.1.1 10.1.1.2 netmask 255.255.255.252
       # route add 10.0.99.0/24 10.1.1.2

 On the server:

       # ifconfig tun1 10.1.1.2 10.1.1.1 netmask 255.255.255.252
       # route add 10.0.50.0/24 10.1.1.1

 Client access may be more finely tuned via the /root/.ssh/authorized_keys file (see below) and the PermitRootLogin server option.  The
 following entry would permit connections on tun(4) device 1 from user “jane” and on tun device 2 from user “john”, if PermitRootLogin
 is set to “forced-commands-only”:

   tunnel="1",command="sh /etc/netstart tun1" ssh-rsa ... jane
   tunnel="2",command="sh /etc/netstart tun2" ssh-rsa ... john

 Since an SSH-based setup entails a fair amount of overhead, it may be more suited to temporary setups, such as for wireless VPNs.  More
 permanent VPNs are better provided by tools such as ipsecctl(8) and isakmpd(8).
</code></pre>
<p>ENVIRONMENT<br>     ssh will normally set the following environment variables:</p>
<pre><code> DISPLAY               The DISPLAY variable indicates the location of the X11 server.  It is automatically set by ssh to point to a
                       value of the form “hostname:n”, where “hostname” indicates the host where the shell runs, and ‘n’ is an integer ≥
                       1.  ssh uses this special value to forward X11 connections over the secure channel.  The user should normally not
                       set DISPLAY explicitly, as that will render the X11 connection insecure (and will require the user to manually
                       copy any required authorization cookies).

 HOME                  Set to the path of the user's home directory.

 LOGNAME               Synonym for USER; set for compatibility with systems that use this variable.

 MAIL                  Set to the path of the user's mailbox.

 PATH                  Set to the default PATH, as specified when compiling ssh.

 SSH_ASKPASS           If ssh needs a passphrase, it will read the passphrase from the current terminal if it was run from a terminal.
                       If ssh does not have a terminal associated with it but DISPLAY and SSH_ASKPASS are set, it will execute the pro‐
                       gram specified by SSH_ASKPASS and open an X11 window to read the passphrase.  This is particularly useful when
                       calling ssh from a .xsession or related script.  (Note that on some machines it may be necessary to redirect the
                       input from /dev/null to make this work.)

 SSH_AUTH_SOCK         Identifies the path of a UNIX-domain socket used to communicate with the agent.

 SSH_CONNECTION        Identifies the client and server ends of the connection.  The variable contains four space-separated values:
                       client IP address, client port number, server IP address, and server port number.

 SSH_ORIGINAL_COMMAND  This variable contains the original command line if a forced command is executed.  It can be used to extract the
                       original arguments.

 SSH_TTY               This is set to the name of the tty (path to the device) associated with the current shell or command.  If the
                       current session has no tty, this variable is not set.

 SSH_TUNNEL            Optionally set by sshd(8) to contain the interface names assigned if tunnel forwarding was requested by the
                       client.

 SSH_USER_AUTH         Optionally set by sshd(8), this variable may contain a pathname to a file that lists the authentication methods
                       successfully used when the session was established, including any public keys that were used.

 TZ                    This variable is set to indicate the present time zone if it was set when the daemon was started (i.e. the daemon
                       passes the value on to new connections).

 USER                  Set to the name of the user logging in.

 Additionally, ssh reads ~/.ssh/environment, and adds lines of the format “VARNAME=value” to the environment if the file exists and
 users are allowed to change their environment.  For more information, see the PermitUserEnvironment option in sshd_config(5).
</code></pre>
<p>FILES<br>     ~/.rhosts<br>             This file is used for host-based authentication (see above).  On some machines this file may need to be world-readable if the<br>             user’s home directory is on an NFS partition, because sshd(8) reads it as root.  Additionally, this file must be owned by the<br>             user, and must not have write permissions for anyone else.  The recommended permission for most machines is read/write for the<br>             user, and not accessible by others.</p>
<pre><code> ~/.shosts
         This file is used in exactly the same way as .rhosts, but allows host-based authentication without permitting login with  rlogin/rsh.

 ~/.ssh/
         This directory is the default location for all user-specific configuration and authentication information.  There is no general requirement to keep the entire contents of this directory secret, but the recommended permissions are read/write/execute for  the user, and not accessible by others.

 ~/.ssh/authorized_keys
         Lists the public keys (DSA, ECDSA, Ed25519, RSA) that can be used for logging in as this user.  The format of this file is described in the sshd(8) manual page.  This file is not highly sensitive, but the recommended permissions are read/write for the user, and not accessible by others.

 ~/.ssh/config
         This is the per-user configuration file.  The file format and configuration options are described in ssh_config(5).  Because of
         the potential for abuse, this file must have strict permissions: read/write for the user, and not writable by others.  It may
         be group-writable provided that the group in question contains only the user.

 ~/.ssh/environment
         Contains additional definitions for environment variables; see ENVIRONMENT, above.

 ~/.ssh/id_dsa
 ~/.ssh/id_ecdsa
 ~/.ssh/id_ecdsa_sk
 ~/.ssh/id_ed25519
 ~/.ssh/id_ed25519_sk
 ~/.ssh/id_rsa
         Contains the private key for authentication.  These files contain sensitive data and should be readable by the user but not accessible by others (read/write/execute).  ssh will simply ignore a private key file if it is accessible by others.  It is possible to specify a passphrase when generating the key which will be used to encrypt the sensitive part of this file using
         AES-128.

 ~/.ssh/id_dsa.pub
 ~/.ssh/id_ecdsa.pub
 ~/.ssh/id_ecdsa_sk.pub
 ~/.ssh/id_ed25519.pub
 ~/.ssh/id_ed25519_sk.pub
 ~/.ssh/id_rsa.pub
         Contains the public key for authentication.  These files are not sensitive and can (but need not) be readable by anyone.

 ~/.ssh/known_hosts
         Contains a list of host keys for all hosts the user has logged into that are not already in the systemwide list of known host
         keys.  See sshd(8) for further details of the format of this file.

 ~/.ssh/rc
         Commands in this file are executed by ssh when the user logs in, just before the user's shell (or command) is started. 

 /etc/hosts.equiv
         This file is for host-based authentication (see above).  It should only be writable by root.

 /etc/ssh/shosts.equiv
         This file is used in exactly the same way as hosts.equiv, but allows host-based authentication without permitting login with
         rlogin/rsh.

 /etc/ssh/ssh_config
         Systemwide configuration file.  The file format and configuration options are described in ssh_config(5).

 /etc/ssh/ssh_host_key
 /etc/ssh/ssh_host_dsa_key
 /etc/ssh/ssh_host_ecdsa_key
 /etc/ssh/ssh_host_ed25519_key
 /etc/ssh/ssh_host_rsa_key
         These files contain the private parts of the host keys and are used for host-based authentication.

 /etc/ssh/ssh_known_hosts
         Systemwide list of known host keys.  This file should be prepared by the system administrator to contain the public host keys  of all machines in the organization.  It should be world-readable.  See sshd(8) for further details of the format of this file.

 /etc/ssh/sshrc
         Commands in this file are executed by ssh when the user logs in, just before the user's shell (or command) is started.  See the         sshd(8) manual page for more information.
</code></pre>
<blockquote>
<p>退出状态，如果成果返回远程命令的执行状态，出错的话返回255。</p>
</blockquote>
<h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><figure class="highlight mipsasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> -C      Requests compression of all data (including stdin, stdout, stderr, <span class="keyword">and </span>data for forwarded X11, TCP <span class="keyword">and </span>UNIX-domain connections).  The compression algorithm is the same used <span class="keyword">by </span>gzip(<span class="number">1</span>).  Compression is desirable on modem lines <span class="keyword">and </span>other slow connections, <span class="keyword">but </span>will only slow down things on fast networks.  The default value can <span class="keyword">be </span>set on a host-<span class="keyword">by-host </span><span class="keyword">basis </span>in the configuration files<span class="comment">; see the Compression option.请求压缩所有数据(包括stdin, stdout, stderr，以及转发的X11, TCP和unix域连接的数据)。压缩算法与gzip(1)相同。压缩在调制解调器线路和其他慢速连接上是可取的，但只会在高速网络上减慢速度。可以在配置文件中对每个主机设置默认值;请参阅压缩选项。</span></span><br><span class="line"></span><br><span class="line">- c cipher_spec 选择加密会话的密码规范。Cipher_spec是一个以逗号分隔的密码列表，按优先级排列，包括aes256，aes128等加密算法。</span><br><span class="line"></span><br><span class="line"> -D [<span class="keyword">bind_address:]port </span>指定本地的应用级动态端口转发。它的工作原理是分配一个套接字来侦听本地端端口，可选地绑定到指定的<span class="keyword">bind_address。每当建立到此端口的连接时，该连接将通过安全通道转发，然后使用应用程序协议来确定从远程计算机连接到哪里。目前支持SOCKS4和SOCKS5协议，ssh将充当SOCKS服务器。只有root才能前进特权端口。动态端口转发也可以在配置文件中指定。</span></span><br><span class="line"><span class="keyword"></span>IPv6地址可以通过将地址括在方括号中指定。只有超级用户才能转发特权端口。</span><br><span class="line"></span><br><span class="line">缺省情况下，本地端口按照“GatewayPorts”设置进行绑定。但是，可以使用显式的<span class="keyword">bind_address</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line">将连接绑定到特定地址。localhost的<span class="keyword">bind_address表示要绑定的监听端口</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line">仅本地使用，而空地址或“*”表示端口应该从所有接口可用。</span><br></pre></td></tr></tbody></table></figure>


    </div>

    
    
    
        <div class="reward-container">
  <div>处无为之事，行不言之教；作而弗始，生而弗有，为而弗恃，功成不居!</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.JPG" alt="郭大侠 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.JPG" alt="郭大侠 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/linux/" rel="tag"># linux</a>
              <a href="/tags/ssh/" rel="tag"># ssh</a>
              <a href="/tags/scp/" rel="tag"># scp</a>
              <a href="/tags/known-hosts/" rel="tag"># known_hosts</a>
              <a href="/tags/StrictHostKeyChecking/" rel="tag"># StrictHostKeyChecking</a>
              <a href="/tags/fg/" rel="tag"># fg</a>
              <a href="/tags/hostkeys/" rel="tag"># hostkeys</a>
              <a href="/tags/ssh-keygen/" rel="tag"># ssh-keygen</a>
              <a href="/tags/sftp/" rel="tag"># sftp</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2013/01/24/c-break-continue/" rel="prev" title="C语言 关于break和continue">
      <i class="fa fa-chevron-left"></i> C语言 关于break和continue
    </a></div>
      <div class="post-nav-item">
    <a href="/2013/01/24/linux-ssh-beginner/" rel="next" title="远程登陆利器 ssh">
      远程登陆利器 ssh <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-disqus">disqus</a></li>
            <li class="tab"><a href="#comment-valine">valine</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane disqus" id="comment-disqus">
              
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  
            </div>
            <div class="tab-pane valine" id="comment-valine">
              <div class="comments" id="valine-comments"></div>
            </div>
        </div>
      </div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ssh%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95%E5%BF%85%E5%A4%87%E7%A5%9E%E5%99%A8"><span class="nav-number">1.</span> <span class="nav-text">ssh远程登录必备神器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%96%E6%B6%88%E4%BD%BF%E7%94%A8ssh%E6%97%B6%E9%9C%80%E8%A6%81%E8%BE%93%E5%85%A5%E5%AF%86%E7%A0%81%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">取消使用ssh时需要输入密码的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%8D%E6%9D%A5%E5%8F%96%E4%BB%A3%E7%94%A8%E6%88%B7%E5%90%8D-IP%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.</span> <span class="nav-text">使用自定义名来取代用户名@IP的方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ssh%E4%B8%AD%E2%80%9CHost-key-verification-failed-%E2%80%9C%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.3.</span> <span class="nav-text">ssh中“Host key verification failed.“的解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8SSH%E9%80%80%E5%87%BA%E7%AC%A6%E5%88%87%E6%8D%A2SSH%E4%BC%9A%E8%AF%9D"><span class="nav-number">1.4.</span> <span class="nav-text">用SSH退出符切换SSH会话</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E8%AF%95SSH%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BC%9A%E8%AF%9D"><span class="nav-number">1.5.</span> <span class="nav-text">调试SSH客户端会话</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8SSH%E7%99%BB%E5%BD%95%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA"><span class="nav-number">1.6.</span> <span class="nav-text">用SSH登录到远程主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3SSH%E4%B8%80%E6%AE%B5%E6%97%B6%E9%97%B4%E4%B8%8D%E6%93%8D%E4%BD%9C%E5%B0%B1%E9%80%80%E5%87%BA%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-number">1.7.</span> <span class="nav-text">解决SSH一段时间不操作就退出的问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9SSH%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">1.7.1.</span> <span class="nav-text">修改SSH服务端的配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9SSH%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">1.7.2.</span> <span class="nav-text">修改SSH客户端的配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TODO"><span class="nav-number">1.8.</span> <span class="nav-text">TODO</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">郭大侠</p>
  <div class="site-description" itemprop="description">郭大侠的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">998</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">181</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1450</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://macshuo.com/" title="http:&#x2F;&#x2F;macshuo.com&#x2F;" rel="noopener" target="_blank">MacTalk</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://huhuidong.wordpress.com/" title="https:&#x2F;&#x2F;huhuidong.wordpress.com&#x2F;" rel="noopener" target="_blank">小胡</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2007 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">郭大侠</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"vIjrLnlboDVaaseO2yYcVSQF-gzGzoHsz","app_key":"NTHrGJp71GzEGvNUEUFumVcR","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://shaoguangleo.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "http://shaoguangleo.github.io/2013/01/24/linux-ssh/";
    this.page.identifier = "2013/01/24/linux-ssh/";
    this.page.title = "Linux ssh命令";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://shaoguangleo.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'vIjrLnlboDVaaseO2yYcVSQF-gzGzoHsz',
      appKey     : 'NTHrGJp71GzEGvNUEUFumVcR',
      placeholder: "路过，即是缘分...",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
