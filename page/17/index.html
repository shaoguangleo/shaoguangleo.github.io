<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"shaoguangleo.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="郭大侠的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="浩瀚宇宙 灿烂星空">
<meta property="og:url" content="http://shaoguangleo.github.io/page/17/index.html">
<meta property="og:site_name" content="浩瀚宇宙 灿烂星空">
<meta property="og:description" content="郭大侠的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="郭大侠">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://shaoguangleo.github.io/page/17/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>浩瀚宇宙 灿烂星空</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=a8cfacb0a536bd846d2fd545cedb4d61"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'a8cfacb0a536bd846d2fd545cedb4d61');
      }
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a8cfacb0a536bd846d2fd545cedb4d61";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>


<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="浩瀚宇宙 灿烂星空" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">浩瀚宇宙 灿烂星空</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">工作和生活中的七七八八</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2018/06/06/gpu-cuda-install/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/06/06/gpu-cuda-install/" class="post-title-link" itemprop="url">CUDA的安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-06 19:47:00" itemprop="dateCreated datePublished" datetime="2018-06-06T19:47:00+08:00">2018-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GPU/" itemprop="url" rel="index"><span itemprop="name">GPU</span></a>
                </span>
            </span>

          
            <span id="/2018/06/06/gpu-cuda-install/" class="post-meta-item leancloud_visitors" data-flag-title="CUDA的安装" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/06/06/gpu-cuda-install/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/06/06/gpu-cuda-install/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/06/06/gpu-cuda-install/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/06/06/gpu-cuda-install/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<h1 id="NVIDIA"><a href="#NVIDIA" class="headerlink" title="NVIDIA"></a>NVIDIA</h1><h2 id="Nvidia显卡驱动安装"><a href="#Nvidia显卡驱动安装" class="headerlink" title="Nvidia显卡驱动安装"></a>Nvidia显卡驱动安装</h2><h3 id="CentOS7-x2F-RHEL"><a href="#CentOS7-x2F-RHEL" class="headerlink" title="CentOS7/RHEL"></a>CentOS7/RHEL</h3><p>安装依赖包</p>
<figure class="highlight gml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -<span class="variable language_">y</span> update</span><br><span class="line">yum -<span class="variable language_">y</span> groupinstall <span class="string">"GNOME Desktop"</span> <span class="string">"Development Tools"</span></span><br><span class="line">yum -<span class="variable language_">y</span> install kernel-devel</span><br></pre></td></tr></tbody></table></figure>

<p>下载最新的NVIDIA驱动，==<strong>&gt;</strong>&nbsp;<a href="http://www.nvidia.com/object/unix.html">http://www.nvidia.com/object/unix.html</a> ==<strong>&gt;</strong>&nbsp;Latest Long Lived Branch version</p>
<p>增加自动内核编辑的选项</p>
<figure class="highlight cmake"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> epel-release</span><br><span class="line">yum -y <span class="keyword">install</span> dkms</span><br></pre></td></tr></tbody></table></figure>

<p>重新启动系统确保系统使用的为最新的内核版本。</p>
<p>编辑 <code>/etc/default/grub</code>在 “<code>GRUB_CMDLINE_LINUX</code>”增加<em>rd.driver.blacklist=nouveau nouveau.modeset=0</em></p>
<p>更新包含上述更改的grub文件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grub2-mkconfig -o /boot/grub2/grub.cfg</span><br></pre></td></tr></tbody></table></figure>

<p>编辑或创建文件`/etc/modprobe.d/blacklist.conf并增加内容<em>blacklist nouveau</em></p>
<p>备份旧的initramfs文件并创建一个新的</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mv</span> /boot/initramfs-(<span class="built_in">uname</span> -r).img /boot/initramfs-(<span class="built_in">uname</span> -r)-nouveau.img</span><br><span class="line"></span><br><span class="line">dracut /boot/initramfs-$(<span class="built_in">uname</span> -r).img $(<span class="built_in">uname</span> -r)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>重启机器，切换到文本模式，<code>systemctl isolate multi-user.target</code>，运行<code>sh NVIDIA-Linux-x86_64-*.run</code>，选项全部选yes即可。</p>
<h2 id="CUDA-Toolkit安装"><a href="#CUDA-Toolkit安装" class="headerlink" title="CUDA Toolkit安装"></a>CUDA Toolkit安装</h2><h2 id="Redhat-x2F-CentOS"><a href="#Redhat-x2F-CentOS" class="headerlink" title="Redhat/CentOS"></a>Redhat/CentOS</h2><p>下载最新的CUDA Toolkit文件 (run文件，不要下载rpm)<br>==&gt; <a href="https://developer.nvidia.com/cuda-downloads">https://developer.nvidia.com/cuda-downloads</a> ==&gt; Linux ==&gt; x86_64 ==&gt; RHEL/CentOS ==&gt; 7 ==&gt; runfile (local)</p>
<p><code>sh cuda_*.run</code><br>在安装NVIDIA driver的时候选no，因为我们已经在前面安装了，一般CUDA内置的会旧一些。其他选项默认即可。</p>
<p>添加环境变量：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> PATH=/usr/local/cuda-9.2/bin:<span class="variable">$PATH</span></span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/local/cuda-9.2/lib64:<span class="variable">$LD_LIBRARY_PATH</span></span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ./cuda_9.2.88_396.26_linux.run </span><br><span class="line">Logging to /tmp/cuda_install_6554.<span class="built_in">log</span></span><br><span class="line">Using more to view the EULA.</span><br><span class="line">End User License Agreement</span><br><span class="line">--------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Preface</span><br><span class="line">-------</span><br><span class="line"></span><br><span class="line">The Software License Agreement <span class="keyword">in</span> Chapter 1 and the Supplement</span><br><span class="line"><span class="keyword">in</span> Chapter 2 contain license terms and conditions that govern</span><br><span class="line">the use of NVIDIA software. By accepting this agreement, you</span><br><span class="line">agree to comply with all the terms and conditions applicable</span><br><span class="line">to the product(s) included herein.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NVIDIA Driver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Description</span><br><span class="line"></span><br><span class="line">This package contains the operating system driver and</span><br><span class="line">fundamental system software components <span class="keyword">for</span> NVIDIA GPUs.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NVIDIA CUDA Toolkit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Description</span><br><span class="line"></span><br><span class="line">The NVIDIA CUDA Toolkit provides command-line and graphical</span><br><span class="line">tools <span class="keyword">for</span> building, debugging and optimizing the performance</span><br><span class="line">of applications accelerated by NVIDIA GPUs, runtime and math</span><br><span class="line">libraries, and documentation including programming guides,</span><br><span class="line">user manuals, and API references.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Default Install Location of CUDA Toolkit</span><br><span class="line"></span><br><span class="line">Windows platform:</span><br><span class="line"></span><br><span class="line">%ProgramFiles%\NVIDIA GPU Computing Toolkit\CUDA\v#.#</span><br><span class="line"></span><br><span class="line">Linux platform:</span><br><span class="line"></span><br><span class="line">/usr/local/cuda-#.#</span><br><span class="line"></span><br><span class="line">Mac platform:</span><br><span class="line"></span><br><span class="line">/Developer/NVIDIA/CUDA-#.#</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NVIDIA CUDA Samples</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Description</span><br><span class="line"></span><br><span class="line">This package includes over 100+ CUDA examples that demonstrate</span><br><span class="line">various CUDA programming principles, and efficient CUDA</span><br><span class="line">implementation of algorithms <span class="keyword">in</span> specific application domains.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Default Install Location of CUDA Samples</span><br><span class="line"></span><br><span class="line">Windows platform:</span><br><span class="line"></span><br><span class="line">%ProgramData%\NVIDIA Corporation\CUDA Samples\v#.#</span><br><span class="line"></span><br><span class="line">Linux platform:</span><br><span class="line"></span><br><span class="line">/usr/local/cuda-#.#/samples</span><br><span class="line"></span><br><span class="line">and</span><br><span class="line"></span><br><span class="line"><span class="variable">$HOME</span>/NVIDIA_CUDA-#.#_Samples</span><br><span class="line"></span><br><span class="line">Mac platform:</span><br><span class="line"></span><br><span class="line">/Developer/NVIDIA/CUDA-#.#/samples</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NVIDIA Nsight Visual Studio Edition (Windows only)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Description</span><br><span class="line"></span><br><span class="line">NVIDIA Nsight Development Platform, Visual Studio Edition is a</span><br><span class="line">development environment integrated into Microsoft Visual</span><br><span class="line">Studio that provides tools <span class="keyword">for</span> debugging, profiling, analyzing</span><br><span class="line">and optimizing your GPU computing and graphics applications.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Default Install Location of Nsight Visual Studio Edition</span><br><span class="line"></span><br><span class="line">Windows platform:</span><br><span class="line"></span><br><span class="line">%ProgramFiles(x86)%\NVIDIA Corporation\Nsight Visual Studio Edition <span class="comment">#.#</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1. NVIDIA Software License Agreement</span><br><span class="line">------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Release Date: October 20, 2016</span><br><span class="line">------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">IMPORTANT NOTICE -- READ BEFORE DOWNLOADING, INSTALLING,</span><br><span class="line">COPYING OR USING THE LICENSED SOFTWARE:</span><br><span class="line">--------------------------------------------------------</span><br><span class="line"></span><br><span class="line">This Software License Agreement (<span class="string">"SLA”), made and entered</span></span><br><span class="line"><span class="string">into as of the time and date of click through action</span></span><br><span class="line"><span class="string">(“Effective Date”), is a legal agreement between you and</span></span><br><span class="line"><span class="string">NVIDIA Corporation ("</span>NVIDIA<span class="string">") and governs the use of the</span></span><br><span class="line"><span class="string">NVIDIA computer software and the documentation made available</span></span><br><span class="line"><span class="string">for use with such NVIDIA software. By downloading, installing,</span></span><br><span class="line"><span class="string">copying, or otherwise using the NVIDIA software and/or</span></span><br><span class="line"><span class="string">documentation, you agree to be bound by the terms of this SLA.</span></span><br><span class="line"><span class="string">If you do not agree to the terms of this SLA, do not download,</span></span><br><span class="line"><span class="string">install, copy or use the NVIDIA software or documentation. IF</span></span><br><span class="line"><span class="string">YOU ARE ENTERING INTO THIS SLA ON BEHALF OF A COMPANY OR OTHER</span></span><br><span class="line"><span class="string">LEGAL ENTITY, YOU REPRESENT THAT YOU HAVE THE LEGAL AUTHORITY</span></span><br><span class="line"><span class="string">TO BIND THE ENTITY TO THIS SLA, IN WHICH CASE “YOU” WILL</span></span><br><span class="line"><span class="string">MEAN THE ENTITY YOU REPRESENT. IF YOU DON’T HAVE SUCH</span></span><br><span class="line"><span class="string">AUTHORITY, OR IF YOU DON’T ACCEPT ALL THE TERMS AND</span></span><br><span class="line"><span class="string">CONDITIONS OF THIS SLA, THEN NVIDIA DOES NOT AGREE TO LICENSE</span></span><br><span class="line"><span class="string">THE LICENSED SOFTWARE TO YOU, AND YOU MAY NOT DOWNLOAD,</span></span><br><span class="line"><span class="string">INSTALL, COPY OR USE IT.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.1. License</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.1.1. License Grant</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Subject to the terms of the AGREEMENT, NVIDIA hereby grants</span></span><br><span class="line"><span class="string">you a non-exclusive, non-transferable license, without the</span></span><br><span class="line"><span class="string">right to sublicense (except as expressly set forth in a</span></span><br><span class="line"><span class="string">Supplement), during the applicable license term unless earlier</span></span><br><span class="line"><span class="string">terminated as provided below, to have Authorized Users install</span></span><br><span class="line"><span class="string">and use the Software, including modifications (if expressly</span></span><br><span class="line"><span class="string">permitted in a Supplement), in accordance with the</span></span><br><span class="line"><span class="string">Documentation. You are only licensed to activate and use</span></span><br><span class="line"><span class="string">Licensed Software for which you a have a valid license, even</span></span><br><span class="line"><span class="string">if during the download or installation you are presented with</span></span><br><span class="line"><span class="string">other product options. No Orders are binding on NVIDIA until</span></span><br><span class="line"><span class="string">accepted by NVIDIA. Your Orders are subject to the AGREEMENT.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">SLA Supplements</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Certain Licensed Software licensed under this SLA may be</span></span><br><span class="line"><span class="string">subject to additional terms and conditions that will be</span></span><br><span class="line"><span class="string">presented to you in a Supplement for acceptance prior to the</span></span><br><span class="line"><span class="string">delivery of such Licensed Software under this SLA and the</span></span><br><span class="line"><span class="string">applicable Supplement. Licensed Software will only be</span></span><br><span class="line"><span class="string">delivered to you upon your acceptance of all applicable terms.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.1.2. Limited Purposes Licenses</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">If your license is provided for one of the purposes indicated</span></span><br><span class="line"><span class="string">below, then notwithstanding contrary terms in Section 1.1 or</span></span><br><span class="line"><span class="string">in a Supplement, such licenses are for internal use and do not</span></span><br><span class="line"><span class="string">include any right or license to sub-license and distribute the</span></span><br><span class="line"><span class="string">Licensed Software or its output in any way in any public</span></span><br><span class="line"><span class="string">release, however limited, and/or in any manner that provides</span></span><br><span class="line"><span class="string">third parties with use of or access to the Licensed Software</span></span><br><span class="line"><span class="string">or its functionality or output, including (but not limited to)</span></span><br><span class="line"><span class="string">external alpha or beta testing or development phases. Further:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  1. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Evaluation License: You may use evaluation licenses solely</span></span><br><span class="line"><span class="string">    for your internal evaluation of the Licensed Software for</span></span><br><span class="line"><span class="string">    broader adoption within your Enterprise or in connection</span></span><br><span class="line"><span class="string">    with a NVIDIA product purchase decision, and such licenses</span></span><br><span class="line"><span class="string">    have an expiration date as indicated by NVIDIA in its sole</span></span><br><span class="line"><span class="string">    discretion (or ninety days from the date of download if no</span></span><br><span class="line"><span class="string">    other duration is indicated).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  2. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Educational/Academic License: You may use</span></span><br><span class="line"><span class="string">    educational/academic licenses solely for educational</span></span><br><span class="line"><span class="string">    purposes and all users must be enrolled or employed by an</span></span><br><span class="line"><span class="string">    academic institution. If you do not meet NVIDIA’s</span></span><br><span class="line"><span class="string">    academic program requirements for educational</span></span><br><span class="line"><span class="string">    institutions, you have no rights under this license.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  3. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Test/Development License. You may use test/development</span></span><br><span class="line"><span class="string">    licenses solely for your internal development, testing</span></span><br><span class="line"><span class="string">    and/or debugging of your software applications or for</span></span><br><span class="line"><span class="string">    interoperability testing with the Licensed Software, and</span></span><br><span class="line"><span class="string">    such licenses have an expiration date as indicated by</span></span><br><span class="line"><span class="string">    NVIDIA in its sole discretion (or one year from the date</span></span><br><span class="line"><span class="string">    of download if no other duration is indicated). NVIDIA</span></span><br><span class="line"><span class="string">    Confidential Information under the AGREEMENT includes</span></span><br><span class="line"><span class="string">    output from Licensed Software developer tools identified</span></span><br><span class="line"><span class="string">    as “Pro” versions, where the output reveals</span></span><br><span class="line"><span class="string">    functionality or performance data pertinent to NVIDIA</span></span><br><span class="line"><span class="string">    hardware or software products.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.1.3. Pre-release Licenses</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">With respect to alpha, beta, preview, and other pre-release</span></span><br><span class="line"><span class="string">Software and Documentation (“Pre-Release Licensed</span></span><br><span class="line"><span class="string">Software”) delivered to you under the AGREEMENT you</span></span><br><span class="line"><span class="string">acknowledge and agree that such Pre-Release Licensed Software</span></span><br><span class="line"><span class="string">(i) may not be fully functional, may contain errors or design</span></span><br><span class="line"><span class="string">flaws, and may have reduced or different security, privacy,</span></span><br><span class="line"><span class="string">accessibility, availability, and reliability standards</span></span><br><span class="line"><span class="string">relative to commercially provided NVIDIA software and</span></span><br><span class="line"><span class="string">documentation, and (ii) use of such Pre-Release Licensed</span></span><br><span class="line"><span class="string">Software may result in unexpected results, loss of data,</span></span><br><span class="line"><span class="string">project delays or other unpredictable damage or loss.</span></span><br><span class="line"><span class="string">THEREFORE, PRE-RELEASE LICENSED SOFTWARE IS NOT INTENDED FOR</span></span><br><span class="line"><span class="string">USE, AND SHOULD NOT BE USED, IN PRODUCTION OR</span></span><br><span class="line"><span class="string">BUSINESS-CRITICAL SYSTEMS. NVIDIA has no obligation to make</span></span><br><span class="line"><span class="string">available a commercial version of any Pre-Release Licensed</span></span><br><span class="line"><span class="string">Software and NVIDIA has the right to abandon development of</span></span><br><span class="line"><span class="string">Pre-Release Licensed Software at any time without liability.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.1.4. Enterprise and Contractor Usage</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You may allow your Enterprise employees and Contractors to</span></span><br><span class="line"><span class="string">access and use the Licensed Software pursuant to the terms of</span></span><br><span class="line"><span class="string">the AGREEMENT solely to perform work on your behalf, provided</span></span><br><span class="line"><span class="string">further that with respect to Contractors: (i) you obtain a</span></span><br><span class="line"><span class="string">written agreement from each Contractor which contains terms</span></span><br><span class="line"><span class="string">and obligations with respect to access to and use of Licensed</span></span><br><span class="line"><span class="string">Software no less protective of NVIDIA than those set forth in</span></span><br><span class="line"><span class="string">the AGREEMENT, and (ii) such Contractor’s access and use</span></span><br><span class="line"><span class="string">expressly excludes any sublicensing or distribution rights for</span></span><br><span class="line"><span class="string">the Licensed Software. You are responsible for the compliance</span></span><br><span class="line"><span class="string">with the terms and conditions of the AGREEMENT by your</span></span><br><span class="line"><span class="string">Enterprise and Contractors. Any act or omission that, if</span></span><br><span class="line"><span class="string">committed by you, would constitute a breach of the AGREEMENT</span></span><br><span class="line"><span class="string">shall be deemed to constitute a breach of the AGREEMENT if</span></span><br><span class="line"><span class="string">committed by your Enterprise or Contractors.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.1.5. Services</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Except as expressly indicated in an Order, NVIDIA is under no</span></span><br><span class="line"><span class="string">obligation to provide support for the Licensed Software or to</span></span><br><span class="line"><span class="string">provide any patches, maintenance, updates or upgrades under</span></span><br><span class="line"><span class="string">the AGREEMENT. Unless patches, maintenance, updates or</span></span><br><span class="line"><span class="string">upgrades are provided with their separate governing terms and</span></span><br><span class="line"><span class="string">conditions, they constitute Licensed Software licensed to you</span></span><br><span class="line"><span class="string">under the AGREEMENT.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.2. Limitations</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.2.1. License Restrictions</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Except as expressly authorized in the AGREEMENT, you agree</span></span><br><span class="line"><span class="string">that you will not (nor authorize third parties to): (i) copy</span></span><br><span class="line"><span class="string">and use Software that was licensed to you for use in one or</span></span><br><span class="line"><span class="string">more NVIDIA hardware products in other unlicensed products</span></span><br><span class="line"><span class="string">(provided that copies solely for backup purposes are allowed);</span></span><br><span class="line"><span class="string">(ii) reverse engineer, decompile, disassemble (except to the</span></span><br><span class="line"><span class="string">extent applicable laws specifically require that such</span></span><br><span class="line"><span class="string">activities be permitted) or attempt to derive the source code,</span></span><br><span class="line"><span class="string">underlying ideas, algorithm or structure of Software provided</span></span><br><span class="line"><span class="string">to you in object code form; (iii) sell, transfer, assign,</span></span><br><span class="line"><span class="string">distribute, rent, loan, lease, sublicense or otherwise make</span></span><br><span class="line"><span class="string">available the Licensed Software or its functionality to third</span></span><br><span class="line"><span class="string">parties (a) as an application services provider or service</span></span><br><span class="line"><span class="string">bureau, (b) by operating hosted/virtual system environments,</span></span><br><span class="line"><span class="string">(c) by hosting, time sharing or providing any other type of</span></span><br><span class="line"><span class="string">services, or (d) otherwise by means of the internet; (iv)</span></span><br><span class="line"><span class="string">modify, translate or otherwise create any derivative works of</span></span><br><span class="line"><span class="string">any Licensed Software; (v) remove, alter, cover or obscure any</span></span><br><span class="line"><span class="string">proprietary notice that appears on or with the Licensed</span></span><br><span class="line"><span class="string">Software or any copies thereof; (vi) use the Licensed</span></span><br><span class="line"><span class="string">Software, or allow its use, transfer, transmission or export</span></span><br><span class="line"><span class="string">in violation of any applicable export control laws, rules or</span></span><br><span class="line"><span class="string">regulations; (vii) distribute, permit access to, or sublicense</span></span><br><span class="line"><span class="string">the Licensed Software as a stand-alone product; (viii) bypass,</span></span><br><span class="line"><span class="string">disable, circumvent or remove any form of copy protection,</span></span><br><span class="line"><span class="string">encryption, security or digital rights management or</span></span><br><span class="line"><span class="string">authentication mechanism used by NVIDIA in connection with the</span></span><br><span class="line"><span class="string">Licensed Software, or use the Licensed Software together with</span></span><br><span class="line"><span class="string">any authorization code, serial number, or other copy</span></span><br><span class="line"><span class="string">protection device not supplied by NVIDIA directly or through</span></span><br><span class="line"><span class="string">an authorized reseller; (ix) use the Licensed Software for the</span></span><br><span class="line"><span class="string">purpose of developing competing products or technologies or</span></span><br><span class="line"><span class="string">assisting a third party in such activities; (x) use the</span></span><br><span class="line"><span class="string">Licensed Software with any system or application where the use</span></span><br><span class="line"><span class="string">or failure of such system or application can reasonably be</span></span><br><span class="line"><span class="string">expected to threaten or result in personal injury, death, or</span></span><br><span class="line"><span class="string">catastrophic loss including, without limitation, use in</span></span><br><span class="line"><span class="string">connection with any nuclear, avionics, navigation, military,</span></span><br><span class="line"><span class="string">medical, life support or other life critical application</span></span><br><span class="line"><span class="string">(“Critical Applications”), unless the parties have entered</span></span><br><span class="line"><span class="string">into a Critical Applications agreement; (xi) distribute any</span></span><br><span class="line"><span class="string">modification or derivative work you make to the Licensed</span></span><br><span class="line"><span class="string">Software under or by reference to the same name as used by</span></span><br><span class="line"><span class="string">NVIDIA; or (xii) use the Licensed Software in any manner that</span></span><br><span class="line"><span class="string">would cause the Licensed Software to become subject to an Open</span></span><br><span class="line"><span class="string">Source License. Nothing in the AGREEMENT shall be construed to</span></span><br><span class="line"><span class="string">give you a right to use, or otherwise obtain access to, any</span></span><br><span class="line"><span class="string">source code from which the Software or any portion thereof is</span></span><br><span class="line"><span class="string">compiled or interpreted. You acknowledge that NVIDIA does not</span></span><br><span class="line"><span class="string">design, test, manufacture or certify the Licensed Software for</span></span><br><span class="line"><span class="string">use in the context of a Critical Application and NVIDIA shall</span></span><br><span class="line"><span class="string">not be liable to you or any third party, in whole or in part,</span></span><br><span class="line"><span class="string">for any claims or damages arising from such use. You agree to</span></span><br><span class="line"><span class="string">defend, indemnify and hold harmless NVIDIA and its Affiliates,</span></span><br><span class="line"><span class="string">and their respective employees, contractors, agents, officers</span></span><br><span class="line"><span class="string">and directors, from and against any and all claims, damages,</span></span><br><span class="line"><span class="string">obligations, losses, liabilities, costs or debt, fines,</span></span><br><span class="line"><span class="string">restitutions and expenses (including but not limited to</span></span><br><span class="line"><span class="string">attorney’s fees and costs incident to establishing the right</span></span><br><span class="line"><span class="string">of indemnification) arising out of or related to you and your</span></span><br><span class="line"><span class="string">Enterprise, and their respective employees, contractors,</span></span><br><span class="line"><span class="string">agents, distributors, resellers, end users, officers and</span></span><br><span class="line"><span class="string">directors use of Licensed Software outside of the scope of the</span></span><br><span class="line"><span class="string">AGREEMENT or any other breach of the terms of the AGREEMENT.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.2.2. Third Party License Obligations</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You acknowledge and agree that the Licensed Software may</span></span><br><span class="line"><span class="string">include or incorporate third party technology (collectively</span></span><br><span class="line"><span class="string">“Third Party Components”), which is provided for use in or</span></span><br><span class="line"><span class="string">with the Software and not otherwise used separately. If the</span></span><br><span class="line"><span class="string">Licensed Software includes or incorporates Third Party</span></span><br><span class="line"><span class="string">Components, then the third-party pass-through terms and</span></span><br><span class="line"><span class="string">conditions (“Third Party Terms”) for the particular Third</span></span><br><span class="line"><span class="string">Party Component will be bundled with the Software or otherwise</span></span><br><span class="line"><span class="string">made available online as indicated by NVIDIA and will be</span></span><br><span class="line"><span class="string">incorporated by reference into the AGREEMENT. In the event of</span></span><br><span class="line"><span class="string">any conflict between the terms in the AGREEMENT and the Third</span></span><br><span class="line"><span class="string">Party Terms, the Third Party Terms shall govern. Copyright to</span></span><br><span class="line"><span class="string">Third Party Components are held by the copyright holders</span></span><br><span class="line"><span class="string">indicated in the copyright notices indicated in the Third</span></span><br><span class="line"><span class="string">Party Terms.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Audio/Video Encoders and Decoders</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You acknowledge and agree that it is your sole responsibility</span></span><br><span class="line"><span class="string">to obtain any additional third party licenses required to</span></span><br><span class="line"><span class="string">make, have made, use, have used, sell, import, and offer for</span></span><br><span class="line"><span class="string">sale your products or services that include or incorporate any</span></span><br><span class="line"><span class="string">Third Party Components and content relating to audio and/or</span></span><br><span class="line"><span class="string">video encoders and decoders from, including but not limited</span></span><br><span class="line"><span class="string">to, Microsoft, Thomson, Fraunhofer IIS, Sisvel S.p.A.,</span></span><br><span class="line"><span class="string">MPEG-LA, and Coding Technologies as NVIDIA does not grant to</span></span><br><span class="line"><span class="string">you under the AGREEMENT any necessary patent or other rights</span></span><br><span class="line"><span class="string">with respect to audio and/or video encoders and decoders.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.2.3. Limited Rights</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Your rights in the Licensed Software are limited to those</span></span><br><span class="line"><span class="string">expressly granted under the AGREEMENT and no other licenses</span></span><br><span class="line"><span class="string">are granted whether by implication, estoppel or otherwise.</span></span><br><span class="line"><span class="string">NVIDIA reserves all rights, title and interest in and to the</span></span><br><span class="line"><span class="string">Licensed Software not expressly granted under the AGREEMENT.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.3. Confidentiality</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Neither party will use the other party’s Confidential</span></span><br><span class="line"><span class="string">Information, except as necessary for the performance of the</span></span><br><span class="line"><span class="string">AGREEMENT, nor will either party disclose such Confidential</span></span><br><span class="line"><span class="string">Information to any third party, except to personnel of NVIDIA</span></span><br><span class="line"><span class="string">and its Affiliates, you, your Enterprise, your Enterprise</span></span><br><span class="line"><span class="string">Contractors, and each party’s legal and financial advisors</span></span><br><span class="line"><span class="string">that have a need to know such Confidential Information for the</span></span><br><span class="line"><span class="string">performance of the AGREEMENT, provided that each such</span></span><br><span class="line"><span class="string">personnel, employee and Contractor is subject to a written</span></span><br><span class="line"><span class="string">agreement that includes confidentiality obligations consistent</span></span><br><span class="line"><span class="string">with those set forth herein. Each party will use all</span></span><br><span class="line"><span class="string">reasonable efforts to maintain the confidentiality of all of</span></span><br><span class="line"><span class="string">the other party’s Confidential Information in its possession</span></span><br><span class="line"><span class="string">or control, but in no event less than the efforts that it</span></span><br><span class="line"><span class="string">ordinarily uses with respect to its own Confidential</span></span><br><span class="line"><span class="string">Information of similar nature and importance. The foregoing</span></span><br><span class="line"><span class="string">obligations will not restrict either party from disclosing the</span></span><br><span class="line"><span class="string">other party’s Confidential Information or the terms and</span></span><br><span class="line"><span class="string">conditions of the AGREEMENT as required under applicable</span></span><br><span class="line"><span class="string">securities regulations or pursuant to the order or requirement</span></span><br><span class="line"><span class="string">of a court, administrative agency, or other governmental body,</span></span><br><span class="line"><span class="string">provided that the party required to make such disclosure (i)</span></span><br><span class="line"><span class="string">gives reasonable notice to the other party to enable it to</span></span><br><span class="line"><span class="string">contest such order or requirement prior to its disclosure</span></span><br><span class="line"><span class="string">(whether through protective orders or otherwise), (ii) uses</span></span><br><span class="line"><span class="string">reasonable effort to obtain confidential treatment or similar</span></span><br><span class="line"><span class="string">protection to the fullest extent possible to avoid such public</span></span><br><span class="line"><span class="string">disclosure, and (iii) discloses only the minimum amount of</span></span><br><span class="line"><span class="string">information necessary to comply with such requirements.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1.4. Ownership</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You are not obligated to disclose to NVIDIA any modifications</span></span><br><span class="line"><span class="string">that you, your Enterprise or your Contractors make to the</span></span><br><span class="line"><span class="string">Licensed Software as permitted under the AGREEMENT. As between</span></span><br><span class="line"><span class="string">the parties, all modifications are owned by NVIDIA and</span></span><br><span class="line"><span class="string">licensed to you under the AGREEMENT unless otherwise expressly</span></span><br><span class="line"><span class="string">provided in a Supplement. The Licensed Software and all</span></span><br><span class="line"><span class="string">modifications owned by NVIDIA, and the respective Intellectual</span></span><br><span class="line"><span class="string">Property Rights therein, are and will remain the sole and</span></span><br><span class="line"><span class="string">exclusive property of NVIDIA or its licensors, whether the</span></span><br><span class="line"><span class="string">Licensed Software is separate from or combined with any other</span></span><br><span class="line"><span class="string">products or materials. You shall not engage in any act or</span></span><br><span class="line"><span class="string">omission that would impair NVIDIA’s and/or its licensors’</span></span><br><span class="line"><span class="string">Intellectual Property Rights in the Licensed Software or any</span></span><br><span class="line"><span class="string">Do you accept the previously read EULA?</span></span><br><span class="line"><span class="string">accept/decline/quit: accept</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Install NVIDIA Accelerated Graphics Driver for Linux-x86_64 396.26?</span></span><br><span class="line"><span class="string">(y)es/(n)o/(q)uit: y</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Do you want to install the OpenGL libraries?</span></span><br><span class="line"><span class="string">(y)es/(n)o/(q)uit [ default is yes ]: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Do you want to run nvidia-xconfig?</span></span><br><span class="line"><span class="string">This will update the system X configuration file so that the NVIDIA X driver</span></span><br><span class="line"><span class="string">is used. The pre-existing X configuration file will be backed up.</span></span><br><span class="line"><span class="string">This option should not be used on systems that require a custom</span></span><br><span class="line"><span class="string">X configuration, such as systems with multiple GPU vendors.</span></span><br><span class="line"><span class="string">(y)es/(n)o/(q)uit [ default is no ]: y</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Install the CUDA 9.2 Toolkit?</span></span><br><span class="line"><span class="string">(y)es/(n)o/(q)uit: y</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter Toolkit Location</span></span><br><span class="line"><span class="string"> [ default is /usr/local/cuda-9.2 ]: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Do you want to install a symbolic link at /usr/local/cuda?</span></span><br><span class="line"><span class="string">(y)es/(n)o/(q)uit: y</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Install the CUDA 9.2 Samples?</span></span><br><span class="line"><span class="string">(y)es/(n)o/(q)uit: y</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Enter CUDA Samples Location</span></span><br><span class="line"><span class="string"> [ default is /home/leo ]: /home/leo/cuda-example</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Installing the NVIDIA display driver...</span></span><br><span class="line"><span class="string">Installing the CUDA Toolkit in /usr/local/cuda-9.2 ...</span></span><br><span class="line"><span class="string">Missing recommended library: libGLU.so</span></span><br><span class="line"><span class="string">Missing recommended library: libXi.so</span></span><br><span class="line"><span class="string">Missing recommended library: libXmu.so</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Installing the CUDA Samples in /home/leo/cuda-example ...</span></span><br><span class="line"><span class="string">Copying samples to /home/leo/cuda-example/NVIDIA_CUDA-9.2_Samples now...</span></span><br><span class="line"><span class="string">Finished copying samples.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">===========</span></span><br><span class="line"><span class="string">= Summary =</span></span><br><span class="line"><span class="string">===========</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Driver:   Installed</span></span><br><span class="line"><span class="string">Toolkit:  Installed in /usr/local/cuda-9.2</span></span><br><span class="line"><span class="string">Samples:  Installed in /home/leo/cuda-example, but missing recommended libraries</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Please make sure that</span></span><br><span class="line"><span class="string"> -   PATH includes /usr/local/cuda-9.2/bin</span></span><br><span class="line"><span class="string"> -   LD_LIBRARY_PATH includes /usr/local/cuda-9.2/lib64, or, add /usr/local/cuda-9.2/lib64 to /etc/ld.so.conf and run ldconfig as root</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">To uninstall the CUDA Toolkit, run the uninstall script in /usr/local/cuda-9.2/bin</span></span><br><span class="line"><span class="string">To uninstall the NVIDIA Driver, run nvidia-uninstall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Please see CUDA_Installation_Guide_Linux.pdf in /usr/local/cuda-9.2/doc/pdf for detailed information on setting up CUDA.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Logfile is /tmp/cuda_install_6554.log</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="问题集锦"><a href="#问题集锦" class="headerlink" title="问题集锦"></a>问题集锦</h2><ol>
<li>ERROR: Unable to load the ‘nvidia-drm’ kernel module.</li>
</ol>
<blockquote>
<p>One probable reason is that the system is boot from UEFI but Secure Boot option is turned on in the BIOS setting. Turn it off and the problem will be solved.</p>
</blockquote>
<ol start="2">
<li>Error: You Appear To Be Running An X Server; Please Exit X Before Installing<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.按住CTRL+ALT+F1 进入命令行</span><br><span class="line"></span><br><span class="line">2.<span class="built_in">sudo</span> service lightdm stop    或者   <span class="built_in">sudo</span> stop lightdm</span><br><span class="line"></span><br><span class="line">3.<span class="built_in">sudo</span> init 3</span><br><span class="line"></span><br><span class="line">4.安装驱动程序：＃:  <span class="built_in">sudo</span> ./NVIDIA-Linux-x86_64-177.67-pkg2.run //当前目录下执行NVIDIA驱动程序</span><br><span class="line"></span><br><span class="line">5.按照提示安装完成，简单方法重启就好了     <span class="built_in">sudo</span>  reboot</span><br></pre></td></tr></tbody></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2018/05/20/linux-automake-27-frequently-asked-questions-about-automake/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/20/linux-automake-27-frequently-asked-questions-about-automake/" class="post-title-link" itemprop="url">Linux Automake 27 Frequently Asked Questions about Automake</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-20 22:28:00" itemprop="dateCreated datePublished" datetime="2018-05-20T22:28:00+08:00">2018-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/Automake/" itemprop="url" rel="index"><span itemprop="name">Automake</span></a>
                </span>
            </span>

          
            <span id="/2018/05/20/linux-automake-27-frequently-asked-questions-about-automake/" class="post-meta-item leancloud_visitors" data-flag-title="Linux Automake 27 Frequently Asked Questions about Automake" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/05/20/linux-automake-27-frequently-asked-questions-about-automake/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/05/20/linux-automake-27-frequently-asked-questions-about-automake/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/05/20/linux-automake-27-frequently-asked-questions-about-automake/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/05/20/linux-automake-27-frequently-asked-questions-about-automake/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>GNU Automake 版本(version 1.16.1, 26 February 2018)</p>
<p>Permission is granted to copy, distribute and/or modify this<br>document under the terms of the GNU Free Documentation License,<br>Version 1.3 or any later version published by the Free Software<br>Foundation; with no Invariant Sections, with no Front-Cover texts,<br>and with no Back-Cover Texts.  A copy of the license is included in<br>the section entitled “GNU Free Documentation License.”</p>
</blockquote>
<p>27 Frequently Asked Questions about Automake</p>
<hr>
<p>This chapter covers some questions that often come up on the mailing<br>lists.</p>
<h1 id="27-1-CVS-and-generated-files"><a href="#27-1-CVS-and-generated-files" class="headerlink" title="27.1 CVS and generated files"></a>27.1 CVS and generated files</h1><h2 id="Background-distributed-generated-Files"><a href="#Background-distributed-generated-Files" class="headerlink" title="Background: distributed generated Files"></a>Background: distributed generated Files</h2><p>Packages made with Autoconf and Automake ship with some generated files<br>like ‘configure’ or ‘Makefile.in’.  These files were generated on the<br>developer’s machine and are distributed so that end-users do not have to<br>install the maintainer tools required to rebuild them.  Other generated<br>files like Lex scanners, Yacc parsers, or Info documentation, are<br>usually distributed on similar grounds.</p>
<p>   Automake output rules in ‘Makefile’s to rebuild these files.  For<br>instance, ‘make’ will run ‘autoconf’ to rebuild ‘configure’ whenever<br>‘configure.ac’ is changed.  This makes development safer by ensuring a<br>‘configure’ is never out-of-date with respect to ‘configure.ac’.</p>
<p>   As generated files shipped in packages are up-to-date, and because<br>‘tar’ preserves times-tamps, these rebuild rules are not triggered when<br>a user unpacks and builds a package.</p>
<h2 id="Background-CVS-and-Timestamps"><a href="#Background-CVS-and-Timestamps" class="headerlink" title="Background: CVS and Timestamps"></a>Background: CVS and Timestamps</h2><p>Unless you use CVS keywords (in which case files must be updated at<br>commit time), CVS preserves timestamp during ‘cvs commit’ and ‘cvs<br>import -d’ operations.</p>
<p>   When you check out a file using ‘cvs checkout’ its timestamp is set<br>to that of the revision that is being checked out.</p>
<p>   However, during ‘cvs update’, files will have the date of the update,<br>not the original timestamp of this revision.  This is meant to make sure<br>that ‘make’ notices sources files have been updated.</p>
<p>   This timestamp shift is troublesome when both sources and generated<br>files are kept under CVS.  Because CVS processes files in lexical order,<br>‘configure.ac’ will appear newer than ‘configure’ after a ‘cvs update’<br>that updates both files, even if ‘configure’ was newer than<br>‘configure.ac’ when it was checked in.  Calling ‘make’ will then trigger<br>a spurious rebuild of ‘configure’.</p>
<h2 id="Living-with-CVS-in-Autoconfiscated-Projects"><a href="#Living-with-CVS-in-Autoconfiscated-Projects" class="headerlink" title="Living with CVS in Autoconfiscated Projects"></a>Living with CVS in Autoconfiscated Projects</h2><p>There are basically two clans amongst maintainers: those who keep all<br>distributed files under CVS, including generated files, and those who<br>keep generated files <em>out</em> of CVS.</p>
<p>All Files in CVS<br>…………….</p>
<p>   • The CVS repository contains all distributed files so you know<br>     exactly what is distributed, and you can checkout any prior version<br>     entirely.</p>
<p>   • Maintainers can see how generated files evolve (for instance, you<br>     can see what happens to your ‘Makefile.in’s when you upgrade<br>     Automake and make sure they look OK).</p>
<p>   • Users do not need the autotools to build a checkout of the project,<br>     it works just like a released tarball.</p>
<p>   • If users use ‘cvs update’ to update their copy, instead of ‘cvs<br>     checkout’ to fetch a fresh one, timestamps will be inaccurate.<br>     Some rebuild rules will be triggered and attempt to run developer<br>     tools such as ‘autoconf’ or ‘automake’.</p>
<pre><code> Calls to such tools are all wrapped into a call to the ‘missing’
 script discussed later (*note maintainer-mode::), so that the user
 will see more descriptive warnings about missing or out-of-date
 tools, and possible suggestions about how to obtain them, rather
 than just some “command not found” error, or (worse) some obscure
 message from some older version of the required tool they happen to
 have installed.

 Maintainers interested in keeping their package buildable from a
 CVS checkout even for those users that lack maintainer-specific
 tools might want to provide an helper script (or to enhance their
 existing bootstrap script) to fix the timestamps after a ‘cvs
 update’ or a ‘git checkout’, to prevent spurious rebuilds.  In case
 of a project committing the Autotools-generated files, as well as
 the generated ‘.info’ files, such script might look something like
 this:

      #!/bin/sh
      # fix-timestamp.sh: prevents useless rebuilds after "cvs update"
      sleep 1
      # aclocal-generated aclocal.m4 depends on locally-installed
      # '.m4' macro files, as well as on 'configure.ac'
      touch aclocal.m4
      sleep 1
      # autoconf-generated configure depends on aclocal.m4 and on
      # configure.ac
      touch configure
      # so does autoheader-generated config.h.in
      touch config.h.in
      # and all the automake-generated Makefile.in files
      touch `find . -name Makefile.in -print`
      # finally, the makeinfo-generated '.info' files depend on the
      # corresponding '.texi' files
      touch doc/*.info
</code></pre>
<p>   • In distributed development, developers are likely to have different<br>     version of the maintainer tools installed.  In this case rebuilds<br>     triggered by timestamp lossage will lead to spurious changes to<br>     generated files.  There are several solutions to this:</p>
<pre><code>    • All developers should use the same versions, so that the
      rebuilt files are identical to files in CVS.  (This starts to
      be difficult when each project you work on uses different
      versions.)
    • Or people use a script to fix the timestamp after a checkout
      (the GCC folks have such a script).
    • Or ‘configure.ac’ uses ‘AM_MAINTAINER_MODE’, which will
      disable all of these rebuild rules by default.  This is
      further discussed in *note maintainer-mode::.
</code></pre>
<p>   • Although we focused on spurious rebuilds, the converse can also<br>     happen.  CVS’s timestamp handling can also let you think an<br>     out-of-date file is up-to-date.</p>
<pre><code> For instance, suppose a developer has modified ‘Makefile.am’ and
 has rebuilt ‘Makefile.in’, and then decides to do a last-minute
 change to ‘Makefile.am’ right before checking in both files
 (without rebuilding ‘Makefile.in’ to account for the change).

 This last change to ‘Makefile.am’ makes the copy of ‘Makefile.in’
 out-of-date.  Since CVS processes files alphabetically, when
 another developer ‘cvs update’s his or her tree, ‘Makefile.in’ will
 happen to be newer than ‘Makefile.am’.  This other developer will
 not see that ‘Makefile.in’ is out-of-date.
</code></pre>
<p>Generated Files out of CVS<br>……………………..</p>
<p>One way to get CVS and ‘make’ working peacefully is to never store<br>generated files in CVS, i.e., do not CVS-control files that are<br>‘Makefile’ targets (also called <em>derived</em> files).</p>
<p>   This way developers are not annoyed by changes to generated files.<br>It does not matter if they all have different versions (assuming they<br>are compatible, of course).  And finally, timestamps are not lost,<br>changes to sources files can’t be missed as in the<br>‘Makefile.am’/‘Makefile.in’ example discussed earlier.</p>
<p>   The drawback is that the CVS repository is not an exact copy of what<br>is distributed and that users now need to install various development<br>tools (maybe even specific versions) before they can build a checkout.<br>But, after all, CVS’s job is versioning, not distribution.</p>
<p>   Allowing developers to use different versions of their tools can also<br>hide bugs during distributed development.  Indeed, developers will be<br>using (hence testing) their own generated files, instead of the<br>generated files that will be released actually.  The developer who<br>prepares the tarball might be using a version of the tool that produces<br>bogus output (for instance a non-portable C file), something other<br>developers could have noticed if they weren’t using their own versions<br>of this tool.</p>
<h2 id="Third-party-Files"><a href="#Third-party-Files" class="headerlink" title="Third-party Files"></a>Third-party Files</h2><p>Another class of files not discussed here (because they do not cause<br>timestamp issues) are files that are shipped with a package, but<br>maintained elsewhere.  For instance, tools like ‘gettextize’ and<br>‘autopoint’ (from Gettext) or ‘libtoolize’ (from Libtool), will install<br>or update files in your package.</p>
<p>   These files, whether they are kept under CVS or not, raise similar<br>concerns about version mismatch between developers’ tools.  The Gettext<br>manual has a section about this, see *note CVS Issues: (gettext)CVS<br>Issues.</p>
<h1 id="27-2-‘missing’-and-‘AM-MAINTAINER-MODE’"><a href="#27-2-‘missing’-and-‘AM-MAINTAINER-MODE’" class="headerlink" title="27.2 ‘missing’ and ‘AM_MAINTAINER_MODE’"></a>27.2 ‘missing’ and ‘AM_MAINTAINER_MODE’</h1><h2 id="‘missing’"><a href="#‘missing’" class="headerlink" title="‘missing’"></a>‘missing’</h2><p>The ‘missing’ script is a wrapper around several maintainer tools,<br>designed to warn users if a maintainer tool is required but missing.<br>Typical maintainer tools are ‘autoconf’, ‘automake’, ‘bison’, etc.<br>Because file generated by these tools are shipped with the other sources<br>of a package, these tools shouldn’t be required during a user build and<br>they are not checked for in ‘configure’.</p>
<p>   However, if for some reason a rebuild rule is triggered and involves<br>a missing tool, ‘missing’ will notice it and warn the user, even<br>suggesting how to obtain such a tool (at least in case it is a<br>well-known one, like ‘makeinfo’ or ‘bison’).  This is more helpful and<br>user-friendly than just having the rebuild rules spewing out a terse<br>error message like ‘sh: TOOL: command not found’.  Similarly, ‘missing’<br>will warn the user if it detects that a maintainer tool it attempted to<br>use seems too old (be warned that diagnosing this correctly is typically<br>more difficult that detecting missing tools, and requires cooperation<br>from the tool itself, so it won’t always work).</p>
<p>   If the required tool is installed, ‘missing’ will run it and won’t<br>attempt to continue after failures.  This is correct during development:<br>developers love fixing failures.  However, users with missing or too old<br>maintainer tools may get an error when the rebuild rule is spuriously<br>triggered, halting the build.  This failure to let the build continue is<br>one of the arguments of the ‘AM_MAINTAINER_MODE’ advocates.</p>
<h2 id="‘AM-MAINTAINER-MODE’"><a href="#‘AM-MAINTAINER-MODE’" class="headerlink" title="‘AM_MAINTAINER_MODE’"></a>‘AM_MAINTAINER_MODE’</h2><p>‘AM_MAINTAINER_MODE’ allows you to choose whether the so called “rebuild<br>rules” should be enabled or disabled.  With<br>‘AM_MAINTAINER_MODE([enable])’, they are enabled by default, otherwise<br>they are disabled by default.  In the latter case, if you have<br>‘AM_MAINTAINER_MODE’ in ‘configure.ac’, and run ‘./configure &amp;&amp; make’,<br>then ‘make’ will <em>never</em> attempt to rebuild ‘configure’, ‘Makefile.in’s,<br>Lex or Yacc outputs, etc.  I.e., this disables build rules for files<br>that are usually distributed and that users should normally not have to<br>update.</p>
<p>   The user can override the default setting by passing either<br>‘–enable-maintainer-mode’ or ‘–disable-maintainer-mode’ to<br>‘configure’.</p>
<p>   People use ‘AM_MAINTAINER_MODE’ either because they do not want their<br>users (or themselves) annoyed by timestamps lossage (*note CVS::), or<br>because they simply can’t stand the rebuild rules and prefer running<br>maintainer tools explicitly.</p>
<p>   ‘AM_MAINTAINER_MODE’ also allows you to disable some custom build<br>rules conditionally.  Some developers use this feature to disable rules<br>that need exotic tools that users may not have available.</p>
<p>   Several years ago François Pinard pointed out several arguments<br>against this ‘AM_MAINTAINER_MODE’ macro.  Most of them relate to<br>insecurity.  By removing dependencies you get non-dependable builds:<br>changes to sources files can have no effect on generated files and this<br>can be very confusing when unnoticed.  He adds that security shouldn’t<br>be reserved to maintainers (what ‘–enable-maintainer-mode’ suggests),<br>on the contrary.  If one user has to modify a ‘Makefile.am’, then either<br>‘Makefile.in’ should be updated or a warning should be output (this is<br>what Automake uses ‘missing’ for) but the last thing you want is that<br>nothing happens and the user doesn’t notice it (this is what happens<br>when rebuild rules are disabled by ‘AM_MAINTAINER_MODE’).</p>
<p>   Jim Meyering, the inventor of the ‘AM_MAINTAINER_MODE’ macro was<br>swayed by François’s arguments, and got rid of ‘AM_MAINTAINER_MODE’ in<br>all of his packages.</p>
<p>   Still many people continue to use ‘AM_MAINTAINER_MODE’, because it<br>helps them working on projects where all files are kept under version<br>control, and because ‘missing’ isn’t enough if you have the wrong<br>version of the tools.</p>
<h1 id="27-3-Why-doesn’t-Automake-support-wildcards"><a href="#27-3-Why-doesn’t-Automake-support-wildcards" class="headerlink" title="27.3 Why doesn’t Automake support wildcards?"></a>27.3 Why doesn’t Automake support wildcards?</h1><p>Developers are lazy.  They would often like to use wildcards in<br>‘Makefile.am’s, so that they would not need to remember to update<br>‘Makefile.am’s every time they add, delete, or rename a file.</p>
<p>   There are several objections to this:<br>   • When using CVS (or similar) developers need to remember they have<br>     to run ‘cvs add’ or ‘cvs rm’ anyway.  Updating ‘Makefile.am’<br>     accordingly quickly becomes a reflex.</p>
<pre><code> Conversely, if your application doesn’t compile because you forgot
 to add a file in ‘Makefile.am’, it will help you remember to ‘cvs
 add’ it.
</code></pre>
<p>   • Using wildcards makes it easy to distribute files by mistake.  For<br>     instance, some code a developer is experimenting with (a test case,<br>     say) that should not be part of the distribution.</p>
<p>   • Using wildcards it’s easy to omit some files by mistake.  For<br>     instance, one developer creates a new file, uses it in many places,<br>     but forgets to commit it.  Another developer then checks out the<br>     incomplete project and is able to run ‘make dist’ successfully,<br>     even though a file is missing.  By listing files, ‘make dist’<br>     <em>will</em> complain.</p>
<p>   • Wildcards are not portable to some non-GNU ‘make’ implementations,<br>     e.g., NetBSD ‘make’ will not expand globs such as ‘*’ in<br>     prerequisites of a target.</p>
<p>   • Finally, it’s really hard to <em>forget</em> to add a file to<br>     ‘Makefile.am’: files that are not listed in ‘Makefile.am’ are not<br>     compiled or installed, so you can’t even test them.</p>
<p>   Still, these are philosophical objections, and as such you may<br>disagree, or find enough value in wildcards to dismiss all of them.<br>Before you start writing a patch against Automake to teach it about<br>wildcards, let’s see the main technical issue: portability.</p>
<p>   Although ‘$(wildcard …)’ works with GNU ‘make’, it is not portable<br>to other ‘make’ implementations.</p>
<p>   The only way Automake could support ‘$(wildcard …)’ is by expanding<br>‘$(wildcard …)’ when ‘automake’ is run.  The resulting ‘Makefile.in’s<br>would be portable since they would list all files and not use<br>‘$(wildcard …)’.  However that means developers would need to remember<br>to run ‘automake’ each time they add, delete, or rename files.</p>
<p>   Compared to editing ‘Makefile.am’, this is a very small gain.  Sure,<br>it’s easier and faster to type ‘automake; make’ than to type ‘emacs<br>Makefile.am; make’.  But nobody bothered enough to write a patch to add<br>support for this syntax.  Some people use scripts to generate file lists<br>in ‘Makefile.am’ or in separate ‘Makefile’ fragments.</p>
<p>   Even if you don’t care about portability, and are tempted to use<br>‘$(wildcard …)’ anyway because you target only GNU Make, you should<br>know there are many places where Automake needs to know exactly which<br>files should be processed.  As Automake doesn’t know how to expand<br>‘$(wildcard …)’, you cannot use it in these places.  ‘$(wildcard …)’<br>is a black box comparable to ‘AC_SUBST’ed variables as far Automake is<br>concerned.</p>
<p>   You can get warnings about ‘$(wildcard …’) constructs using the<br>‘-Wportability’ flag.</p>
<h1 id="27-4-Limitations-on-File-Names"><a href="#27-4-Limitations-on-File-Names" class="headerlink" title="27.4 Limitations on File Names"></a>27.4 Limitations on File Names</h1><p>Automake attempts to support all kinds of file names, even those that<br>contain unusual characters or are unusually long.  However, some<br>limitations are imposed by the underlying operating system and tools.</p>
<p>   Most operating systems prohibit the use of the null byte in file<br>names, and reserve ‘/’ as a directory separator.  Also, they require<br>that file names are properly encoded for the user’s locale.  Automake is<br>subject to these limits.</p>
<p>   Portable packages should limit themselves to POSIX file names.  These<br>can contain ASCII letters and digits, ‘_’, ‘.’, and ‘-’.  File names<br>consist of components separated by ‘/’.  File name components cannot<br>begin with ‘-’.</p>
<p>   Portable POSIX file names cannot contain components that exceed a<br>14-byte limit, but nowadays it’s normally safe to assume the<br>more-generous XOPEN limit of 255 bytes.  POSIX limits file names to 255<br>bytes (XOPEN allows 1023 bytes), but you may want to limit a source<br>tarball to file names of 99 bytes to avoid interoperability problems<br>with old versions of ‘tar’.</p>
<p>   If you depart from these rules (e.g., by using non-ASCII characters<br>in file names, or by using lengthy file names), your installers may have<br>problems for reasons unrelated to Automake.  However, if this does not<br>concern you, you should know about the limitations imposed by Automake<br>itself.  These limitations are undesirable, but some of them seem to be<br>inherent to underlying tools like Autoconf, Make, M4, and the shell.<br>They fall into three categorie: install directories, build directories,<br>and file names.</p>
<p>   The following characters:</p>
<pre><code> newline " # $ ' `
</code></pre>
<p>   should not appear in the names of install directories.  For example,<br>the operand of ‘configure’’s ‘–prefix’ option should not contain these<br>characters.</p>
<p>   Build directories suffer the same limitations as install directories,<br>and in addition should not contain the following characters:</p>
<pre><code> &amp; @ \
</code></pre>
<p>   For example, the full name of the directory containing the source<br>files should not contain these characters.</p>
<p>   Source and installation file names like ‘main.c’ are limited even<br>further: they should conform to the POSIX/XOPEN rules described above.<br>In addition, if you plan to port to non-POSIX environments, you should<br>avoid file names that differ only in case (e.g., ‘makefile’ and<br>‘Makefile’).  Nowadays it is no longer worth worrying about the 8.3<br>limits of DOS file systems.</p>
<h1 id="27-5-Errors-with-distclean"><a href="#27-5-Errors-with-distclean" class="headerlink" title="27.5 Errors with distclean"></a>27.5 Errors with distclean</h1><p>This is a diagnostic you might encounter while running ‘make distcheck’.</p>
<p>   As explained in *note Checking the Distribution::, ‘make distcheck’<br>attempts to build and check your package for errors like this one.</p>
<p>   ‘make distcheck’ will perform a ‘VPATH’ build of your package (*note<br>VPATH Builds::), and then call ‘make distclean’.  Files left in the<br>build directory after ‘make distclean’ has run are listed after this<br>error.</p>
<p>   This diagnostic really covers two kinds of errors:</p>
<p>   • files that are forgotten by distclean;<br>   • distributed files that are erroneously rebuilt.</p>
<p>   The former left-over files are not distributed, so the fix is to mark<br>them for cleaning (*note Clean::), this is obvious and doesn’t deserve<br>more explanations.</p>
<p>   The latter bug is not always easy to understand and fix, so let’s<br>proceed with an example.  Suppose our package contains a program for<br>which we want to build a man page using ‘help2man’.  GNU ‘help2man’<br>produces simple manual pages from the ‘–help’ and ‘–version’ output of<br>other commands (*note Overview: (help2man)Top.).  Because we don’t want<br>to force our users to install ‘help2man’, we decide to distribute the<br>generated man page using the following setup.</p>
<pre><code> # This Makefile.am is bogus.
 bin_PROGRAMS = foo
 foo_SOURCES = foo.c
 dist_man_MANS = foo.1

 foo.1: foo$(EXEEXT)
         help2man --output=foo.1 ./foo$(EXEEXT)
</code></pre>
<p>   This will effectively distribute the man page.  However, ‘make<br>distcheck’ will fail with:</p>
<pre><code> ERROR: files left in build directory after distclean:
 ./foo.1
</code></pre>
<p>   Why was ‘foo.1’ rebuilt?  Because although distributed, ‘foo.1’<br>depends on a non-distributed built file: ‘foo$(EXEEXT)’.  ‘foo$(EXEEXT)’<br>is built by the user, so it will always appear to be newer than the<br>distributed ‘foo.1’.</p>
<p>   ‘make distcheck’ caught an inconsistency in our package.  Our intent<br>was to distribute ‘foo.1’ so users do not need to install ‘help2man’,<br>however since this rule causes this file to be always rebuilt, users<br><em>do</em> need ‘help2man’.  Either we should ensure that ‘foo.1’ is not<br>rebuilt by users, or there is no point in distributing ‘foo.1’.</p>
<p>   More generally, the rule is that distributed files should never<br>depend on non-distributed built files.  If you distribute something<br>generated, distribute its sources.</p>
<p>   One way to fix the above example, while still distributing ‘foo.1’ is<br>to not depend on ‘foo$(EXEEXT)’.  For instance, assuming ‘foo –version’<br>and ‘foo –help’ do not change unless ‘foo.c’ or ‘configure.ac’ change,<br>we could write the following ‘Makefile.am’:</p>
<pre><code> bin_PROGRAMS = foo
 foo_SOURCES = foo.c
 dist_man_MANS = foo.1

 foo.1: foo.c $(top_srcdir)/configure.ac
         $(MAKE) $(AM_MAKEFLAGS) foo$(EXEEXT)
         help2man --output=foo.1 ./foo$(EXEEXT)
</code></pre>
<p>   This way, ‘foo.1’ will not get rebuilt every time ‘foo$(EXEEXT)’<br>changes.  The ‘make’ call makes sure ‘foo$(EXEEXT)’ is up-to-date before<br>‘help2man’.  Another way to ensure this would be to use separate<br>directories for binaries and man pages, and set ‘SUBDIRS’ so that<br>binaries are built before man pages.</p>
<p>   We could also decide not to distribute ‘foo.1’.  In this case it’s<br>fine to have ‘foo.1’ dependent upon ‘foo$(EXEEXT)’, since both will have<br>to be rebuilt.  However it would be impossible to build the package in a<br>cross-compilation, because building ‘foo.1’ involves an <em>execution</em> of<br>‘foo$(EXEEXT)’.</p>
<p>   Another context where such errors are common is when distributed<br>files are built by tools that are built by the package.  The pattern is<br>similar:</p>
<pre><code> distributed-file: built-tools distributed-sources
         build-command
</code></pre>
<p>should be changed to</p>
<pre><code> distributed-file: distributed-sources
         $(MAKE) $(AM_MAKEFLAGS) built-tools
         build-command
</code></pre>
<p>or you could choose not to distribute ‘distributed-file’, if<br>cross-compilation does not matter.</p>
<p>   The points made through these examples are worth a summary:</p>
<p>   • Distributed files should never depend upon non-distributed built<br>     files.<br>   • Distributed files should be distributed with all their<br>     dependencies.<br>   • If a file is <em>intended</em> to be rebuilt by users, then there is no<br>     point in distributing it.</p>
<p>   For desperate cases, it’s always possible to disable this check by<br>setting ‘distcleancheck_listfiles’ as documented in *note Checking the<br>Distribution::.  Make sure you do understand the reason why ‘make<br>distcheck’ complains before you do this.  ‘distcleancheck_listfiles’ is<br>a way to <em>hide</em> errors, not to fix them.  You can always do better.</p>
<h1 id="27-6-Flag-Variables-Ordering"><a href="#27-6-Flag-Variables-Ordering" class="headerlink" title="27.6 Flag Variables Ordering"></a>27.6 Flag Variables Ordering</h1><pre><code> What is the difference between ‘AM_CFLAGS’, ‘CFLAGS’, and
 ‘mumble_CFLAGS’?

 Why does ‘automake’ output ‘CPPFLAGS’ after
 ‘AM_CPPFLAGS’ on compile lines?  Shouldn’t it be the converse?

 My ‘configure’ adds some warning flags into ‘CXXFLAGS’.  In
 one ‘Makefile.am’ I would like to append a new flag, however if I
 put the flag into ‘AM_CXXFLAGS’ it is prepended to the other
 flags, not appended.
</code></pre>
<h2 id="Compile-Flag-Variables"><a href="#Compile-Flag-Variables" class="headerlink" title="Compile Flag Variables"></a>Compile Flag Variables</h2><p>This section attempts to answer all the above questions.  We will mostly<br>discuss ‘CPPFLAGS’ in our examples, but actually the answer holds for<br>all the compile flags used in Automake: ‘CCASFLAGS’, ‘CFLAGS’,<br>‘CPPFLAGS’, ‘CXXFLAGS’, ‘FCFLAGS’, ‘FFLAGS’, ‘GCJFLAGS’, ‘LDFLAGS’,<br>‘LFLAGS’, ‘LIBTOOLFLAGS’, ‘OBJCFLAGS’, ‘OBJCXXFLAGS’, ‘RFLAGS’,<br>‘UPCFLAGS’, and ‘YFLAGS’.</p>
<p>   ‘CPPFLAGS’, ‘AM_CPPFLAGS’, and ‘mumble_CPPFLAGS’ are three variables<br>that can be used to pass flags to the C preprocessor (actually these<br>variables are also used for other languages like C++ or preprocessed<br>Fortran).  ‘CPPFLAGS’ is the user variable (*note User Variables::),<br>‘AM_CPPFLAGS’ is the Automake variable, and ‘mumble_CPPFLAGS’ is the<br>variable specific to the ‘mumble’ target (we call this a per-target<br>variable, *note Program and Library Variables::).</p>
<p>   Automake always uses two of these variables when compiling C sources<br>files.  When compiling an object file for the ‘mumble’ target, the first<br>variable will be ‘mumble_CPPFLAGS’ if it is defined, or ‘AM_CPPFLAGS’<br>otherwise.  The second variable is always ‘CPPFLAGS’.</p>
<p>   In the following example,</p>
<pre><code> bin_PROGRAMS = foo bar
 foo_SOURCES = xyz.c
 bar_SOURCES = main.c
 foo_CPPFLAGS = -DFOO
 AM_CPPFLAGS = -DBAZ
</code></pre>
<p>‘xyz.o’ will be compiled with ‘$(foo_CPPFLAGS) $(CPPFLAGS)’, (because<br>‘xyz.o’ is part of the ‘foo’ target), while ‘main.o’ will be compiled<br>with ‘$(AM_CPPFLAGS) $(CPPFLAGS)’ (because there is no per-target<br>variable for target ‘bar’).</p>
<p>   The difference between ‘mumble_CPPFLAGS’ and ‘AM_CPPFLAGS’ being<br>clear enough, let’s focus on ‘CPPFLAGS’.  ‘CPPFLAGS’ is a user variable,<br>i.e., a variable that users are entitled to modify in order to compile<br>the package.  This variable, like many others, is documented at the end<br>of the output of ‘configure –help’.</p>
<p>   For instance, someone who needs to add ‘/home/my/usr/include’ to the<br>C compiler’s search path would configure a package with</p>
<pre><code> ./configure CPPFLAGS='-I /home/my/usr/include'
</code></pre>
<p>and this flag would be propagated to the compile rules of all<br>‘Makefile’s.</p>
<p>   It is also not uncommon to override a user variable at ‘make’-time.<br>Many installers do this with ‘prefix’, but this can be useful with<br>compiler flags too.  For instance, if, while debugging a C++ project,<br>you need to disable optimization in one specific object file, you can<br>run something like</p>
<pre><code> rm file.o
 make CXXFLAGS=-O0 file.o
 make
</code></pre>
<p>   The reason ‘$(CPPFLAGS)’ appears after ‘$(AM_CPPFLAGS)’ or<br>‘$(mumble_CPPFLAGS)’ in the compile command is that users should always<br>have the last say.  It probably makes more sense if you think about it<br>while looking at the ‘CXXFLAGS=-O0’ above, which should supersede any<br>other switch from ‘AM_CXXFLAGS’ or ‘mumble_CXXFLAGS’ (and this of course<br>replaces the previous value of ‘CXXFLAGS’).</p>
<p>   You should never redefine a user variable such as ‘CPPFLAGS’ in<br>‘Makefile.am’.  Use ‘automake -Woverride’ to diagnose such mistakes.<br>Even something like</p>
<pre><code> CPPFLAGS = -DDATADIR=\"$(datadir)\" @CPPFLAGS@
</code></pre>
<p>is erroneous.  Although this preserves ‘configure’’s value of<br>‘CPPFLAGS’, the definition of ‘DATADIR’ will disappear if a user<br>attempts to override ‘CPPFLAGS’ from the ‘make’ command line.</p>
<pre><code> AM_CPPFLAGS = -DDATADIR=\"$(datadir)\"
</code></pre>
<p>is all that is needed here if no per-target flags are used.</p>
<p>   You should not add options to these user variables within ‘configure’<br>either, for the same reason.  Occasionally you need to modify these<br>variables to perform a test, but you should reset their values<br>afterwards.  In contrast, it is OK to modify the ‘AM_’ variables within<br>‘configure’ if you ‘AC_SUBST’ them, but it is rather rare that you need<br>to do this, unless you really want to change the default definitions of<br>the ‘AM_’ variables in all ‘Makefile’s.</p>
<p>   What we recommend is that you define extra flags in separate<br>variables.  For instance, you may write an Autoconf macro that computes<br>a set of warning options for the C compiler, and ‘AC_SUBST’ them in<br>‘WARNINGCFLAGS’; you may also have an Autoconf macro that determines<br>which compiler and which linker flags should be used to link with<br>library ‘libfoo’, and ‘AC_SUBST’ these in ‘LIBFOOCFLAGS’ and<br>‘LIBFOOLDFLAGS’.  Then, a ‘Makefile.am’ could use these variables as<br>follows:</p>
<pre><code> AM_CFLAGS = $(WARNINGCFLAGS)
 bin_PROGRAMS = prog1 prog2
 prog1_SOURCES = ...
 prog2_SOURCES = ...
 prog2_CFLAGS = $(LIBFOOCFLAGS) $(AM_CFLAGS)
 prog2_LDFLAGS = $(LIBFOOLDFLAGS)
</code></pre>
<p>   In this example both programs will be compiled with the flags<br>substituted into ‘$(WARNINGCFLAGS)’, and ‘prog2’ will additionally be<br>compiled with the flags required to link with ‘libfoo’.</p>
<p>   Note that listing ‘AM_CFLAGS’ in a per-target ‘CFLAGS’ variable is a<br>common idiom to ensure that ‘AM_CFLAGS’ applies to every target in a<br>‘Makefile.in’.</p>
<p>   Using variables like this gives you full control over the ordering of<br>the flags.  For instance, if there is a flag in $(WARNINGCFLAGS) that<br>you want to negate for a particular target, you can use something like<br>‘prog1_CFLAGS = $(AM_CFLAGS) -no-flag’.  If all of these flags had been<br>forcefully appended to ‘CFLAGS’, there would be no way to disable one<br>flag.  Yet another reason to leave user variables to users.</p>
<p>   Finally, we have avoided naming the variable of the example<br>‘LIBFOO_LDFLAGS’ (with an underscore) because that would cause Automake<br>to think that this is actually a per-target variable (like<br>‘mumble_LDFLAGS’) for some non-declared ‘LIBFOO’ target.</p>
<h2 id="Other-Variables"><a href="#Other-Variables" class="headerlink" title="Other Variables"></a>Other Variables</h2><p>There are other variables in Automake that follow similar principles to<br>allow user options.  For instance, Texinfo rules (*note Texinfo::) use<br>‘MAKEINFOFLAGS’ and ‘AM_MAKEINFOFLAGS’.  Similarly, DejaGnu tests (*note<br>DejaGnu Tests::) use ‘RUNTESTDEFAULTFLAGS’ and ‘AM_RUNTESTDEFAULTFLAGS’.<br>The tags and ctags rules (*note Tags::) use ‘ETAGSFLAGS’,<br>‘AM_ETAGSFLAGS’, ‘CTAGSFLAGS’, and ‘AM_CTAGSFLAGS’.  Java rules (*note<br>Java::) use ‘JAVACFLAGS’ and ‘AM_JAVACFLAGS’.  None of these rules<br>support per-target flags (yet).</p>
<p>   To some extent, even ‘AM_MAKEFLAGS’ (*note Subdirectories::) obeys<br>this naming scheme.  The slight difference is that ‘MAKEFLAGS’ is passed<br>to sub-‘make’s implicitly by ‘make’ itself.</p>
<p>   ‘ARFLAGS’ (*note A Library::) is usually defined by Automake and has<br>neither ‘AM_’ nor per-target cousin.</p>
<p>   Finally you should not think that the existence of a per-target<br>variable implies the existence of an ‘AM_’ variable or of a user<br>variable.  For instance, the ‘mumble_LDADD’ per-target variable<br>overrides the makefile-wide ‘LDADD’ variable (which is not a user<br>variable), and ‘mumble_LIBADD’ exists only as a per-target variable.<br>*Note Program and Library Variables::.</p>
<h1 id="27-7-Why-are-object-files-sometimes-renamed"><a href="#27-7-Why-are-object-files-sometimes-renamed" class="headerlink" title="27.7 Why are object files sometimes renamed?"></a>27.7 Why are object files sometimes renamed?</h1><p>This happens when per-target compilation flags are used.  Object files<br>need to be renamed just in case they would clash with object files<br>compiled from the same sources, but with different flags.  Consider the<br>following example.</p>
<pre><code> bin_PROGRAMS = true false
 true_SOURCES = generic.c
 true_CPPFLAGS = -DEXIT_CODE=0
 false_SOURCES = generic.c
 false_CPPFLAGS = -DEXIT_CODE=1
</code></pre>
<p>Obviously the two programs are built from the same source, but it would<br>be bad if they shared the same object, because ‘generic.o’ cannot be<br>built with both ‘-DEXIT_CODE=0’ <em>and</em> ‘-DEXIT_CODE=1’.  Therefore<br>‘automake’ outputs rules to build two different objects:<br>‘true-generic.o’ and ‘false-generic.o’.</p>
<p>   ‘automake’ doesn’t actually look whether source files are shared to<br>decide if it must rename objects.  It will just rename all objects of a<br>target as soon as it sees per-target compilation flags used.</p>
<p>   It’s OK to share object files when per-target compilation flags are<br>not used.  For instance, ‘true’ and ‘false’ will both use ‘version.o’ in<br>the following example.</p>
<pre><code> AM_CPPFLAGS = -DVERSION=1.0
 bin_PROGRAMS = true false
 true_SOURCES = true.c version.c
 false_SOURCES = false.c version.c
</code></pre>
<p>   Note that the renaming of objects is also affected by the<br>‘_SHORTNAME’ variable (*note Program and Library Variables::).</p>
<h1 id="27-8-Per-Object-Flags-Emulation"><a href="#27-8-Per-Object-Flags-Emulation" class="headerlink" title="27.8 Per-Object Flags Emulation"></a>27.8 Per-Object Flags Emulation</h1><pre><code> One of my source files needs to be compiled with different flags.  How
 do I do?
</code></pre>
<p>   Automake supports per-program and per-library compilation flags (see<br>*note Program and Library Variables:: and *note Flag Variables<br>Ordering::).  With this you can define compilation flags that apply to<br>all files compiled for a target.  For instance, in</p>
<pre><code> bin_PROGRAMS = foo
 foo_SOURCES = foo.c foo.h bar.c bar.h main.c
 foo_CFLAGS = -some -flags
</code></pre>
<p>‘foo-foo.o’, ‘foo-bar.o’, and ‘foo-main.o’ will all be compiled with<br>‘-some -flags’.  (If you wonder about the names of these object files,<br>see *note Renamed Objects::.)  Note that ‘foo_CFLAGS’ gives the flags to<br>use when compiling all the C sources of the <em>program</em> ‘foo’, it has<br>nothing to do with ‘foo.c’ or ‘foo-foo.o’ specifically.</p>
<p>   What if ‘foo.c’ needs to be compiled into ‘foo.o’ using some specific<br>flags, that none of the other files requires?  Obviously per-program<br>flags are not directly applicable here.  Something like per-object flags<br>are expected, i.e., flags that would be used only when creating<br>‘foo-foo.o’.  Automake does not support that, however this is easy to<br>simulate using a library that contains only that object, and compiling<br>this library with per-library flags.</p>
<pre><code> bin_PROGRAMS = foo
 foo_SOURCES = bar.c bar.h main.c
 foo_CFLAGS = -some -flags
 foo_LDADD = libfoo.a
 noinst_LIBRARIES = libfoo.a
 libfoo_a_SOURCES = foo.c foo.h
 libfoo_a_CFLAGS = -some -other -flags
</code></pre>
<p>   Here ‘foo-bar.o’ and ‘foo-main.o’ will all be compiled with ‘-some<br>-flags’, while ‘libfoo_a-foo.o’ will be compiled using ‘-some -other<br>-flags’.  Eventually, all three objects will be linked to form ‘foo’.</p>
<p>   This trick can also be achieved using Libtool convenience libraries,<br>for instance ‘noinst_LTLIBRARIES = libfoo.la’ (*note Libtool Convenience<br>Libraries::).</p>
<p>   Another tempting idea to implement per-object flags is to override<br>the compile rules ‘automake’ would output for these files.  Automake<br>will not define a rule for a target you have defined, so you could think<br>about defining the ‘foo-foo.o: foo.c’ rule yourself.  We recommend<br>against this, because this is error prone.  For instance, if you add<br>such a rule to the first example, it will break the day you decide to<br>remove ‘foo_CFLAGS’ (because ‘foo.c’ will then be compiled as ‘foo.o’<br>instead of ‘foo-foo.o’, *note Renamed Objects::).  Also in order to<br>support dependency tracking, the two ‘.o’/‘.obj’ extensions, and all the<br>other flags variables involved in a compilation, you will end up<br>modifying a copy of the rule previously output by ‘automake’ for this<br>file.  If a new release of Automake generates a different rule, your<br>copy will need to be updated by hand.</p>
<h1 id="27-9-Handling-Tools-that-Produce-Many-Outputs"><a href="#27-9-Handling-Tools-that-Produce-Many-Outputs" class="headerlink" title="27.9 Handling Tools that Produce Many Outputs"></a>27.9 Handling Tools that Produce Many Outputs</h1><p>This section describes a ‘make’ idiom that can be used when a tool<br>produces multiple output files.  It is not specific to Automake and can<br>be used in ordinary ‘Makefile’s.</p>
<p>   Suppose we have a program called ‘foo’ that will read one file called<br>‘data.foo’ and produce two files named ‘data.c’ and ‘data.h’.  We want<br>to write a ‘Makefile’ rule that captures this one-to-two dependency.</p>
<p>   The naive rule is incorrect:</p>
<pre><code> # This is incorrect.
 data.c data.h: data.foo
         foo data.foo
</code></pre>
<p>What the above rule really says is that ‘data.c’ and ‘data.h’ each<br>depend on ‘data.foo’, and can each be built by running ‘foo data.foo’.<br>In other words it is equivalent to:</p>
<pre><code> # We do not want this.
 data.c: data.foo
         foo data.foo
 data.h: data.foo
         foo data.foo
</code></pre>
<p>which means that ‘foo’ can be run twice.  Usually it will not be run<br>twice, because ‘make’ implementations are smart enough to check for the<br>existence of the second file after the first one has been built; they<br>will therefore detect that it already exists.  However there are a few<br>situations where it can run twice anyway:</p>
<p>   • The most worrying case is when running a parallel ‘make’.  If<br>     ‘data.c’ and ‘data.h’ are built in parallel, two ‘foo data.foo’<br>     commands will run concurrently.  This is harmful.<br>   • Another case is when the dependency (here ‘data.foo’) is (or<br>     depends upon) a phony target.</p>
<p>   A solution that works with parallel ‘make’ but not with phony<br>dependencies is the following:</p>
<pre><code> data.c data.h: data.foo
         foo data.foo
 data.h: data.c
</code></pre>
<p>The above rules are equivalent to</p>
<pre><code> data.c: data.foo
         foo data.foo
 data.h: data.foo data.c
         foo data.foo
</code></pre>
<p>therefore a parallel ‘make’ will have to serialize the builds of<br>‘data.c’ and ‘data.h’, and will detect that the second is no longer<br>needed once the first is over.</p>
<p>   Using this pattern is probably enough for most cases.  However it<br>does not scale easily to more output files (in this scheme all output<br>files must be totally ordered by the dependency relation), so we will<br>explore a more complicated solution.</p>
<p>   Another idea is to write the following:</p>
<pre><code> # There is still a problem with this one.
 data.c: data.foo
         foo data.foo
 data.h: data.c
</code></pre>
<p>The idea is that ‘foo data.foo’ is run only when ‘data.c’ needs to be<br>updated, but we further state that ‘data.h’ depends upon ‘data.c’.  That<br>way, if ‘data.h’ is required and ‘data.foo’ is out of date, the<br>dependency on ‘data.c’ will trigger the build.</p>
<p>   This is almost perfect, but suppose we have built ‘data.h’ and<br>‘data.c’, and then we erase ‘data.h’.  Then, running ‘make data.h’ will<br>not rebuild ‘data.h’.  The above rules just state that ‘data.c’ must be<br>up-to-date with respect to ‘data.foo’, and this is already the case.</p>
<p>   What we need is a rule that forces a rebuild when ‘data.h’ is<br>missing.  Here it is:</p>
<pre><code> data.c: data.foo
         foo data.foo
 data.h: data.c
 ## Recover from the removal of $@
         @if test -f $@; then :; else \
           rm -f data.c; \
           $(MAKE) $(AM_MAKEFLAGS) data.c; \
         fi
</code></pre>
<p>   The above scheme can be extended to handle more outputs and more<br>inputs.  One of the outputs is selected to serve as a witness to the<br>successful completion of the command, it depends upon all inputs, and<br>all other outputs depend upon it.  For instance, if ‘foo’ should<br>additionally read ‘data.bar’ and also produce ‘data.w’ and ‘data.x’, we<br>would write:</p>
<pre><code> data.c: data.foo data.bar
         foo data.foo data.bar
 data.h data.w data.x: data.c
 ## Recover from the removal of $@
         @if test -f $@; then :; else \
           rm -f data.c; \
           $(MAKE) $(AM_MAKEFLAGS) data.c; \
         fi
</code></pre>
<p>   However there are now three minor problems in this setup.  One is<br>related to the timestamp ordering of ‘data.h’, ‘data.w’, ‘data.x’, and<br>‘data.c’.  Another one is a race condition if a parallel ‘make’ attempts<br>to run multiple instances of the recover block at once.  Finally, the<br>recursive rule breaks ‘make -n’ when run with GNU ‘make’ (as well as<br>some other ‘make’ implementations), as it may remove ‘data.h’ even when<br>it should not (*note How the ‘MAKE’ Variable Works: (make)MAKE<br>Variable.).</p>
<p>   Let us deal with the first problem.  ‘foo’ outputs four files, but we<br>do not know in which order these files are created.  Suppose that<br>‘data.h’ is created before ‘data.c’.  Then we have a weird situation.<br>The next time ‘make’ is run, ‘data.h’ will appear older than ‘data.c’,<br>the second rule will be triggered, a shell will be started to execute<br>the ‘if…fi’ command, but actually it will just execute the ‘then’<br>branch, that is: nothing.  In other words, because the witness we<br>selected is not the first file created by ‘foo’, ‘make’ will start a<br>shell to do nothing each time it is run.</p>
<p>   A simple riposte is to fix the timestamps when this happens.</p>
<pre><code> data.c: data.foo data.bar
         foo data.foo data.bar
 data.h data.w data.x: data.c
         @if test -f $@; then \
           touch $@; \
         else \
 ## Recover from the removal of $@
           rm -f data.c; \
           $(MAKE) $(AM_MAKEFLAGS) data.c; \
         fi
</code></pre>
<p>   Another solution is to use a different and dedicated file as witness,<br>rather than using any of ‘foo’’s outputs.</p>
<pre><code> data.stamp: data.foo data.bar
         @rm -f data.tmp
         @touch data.tmp
         foo data.foo data.bar
         @mv -f data.tmp $@
 data.c data.h data.w data.x: data.stamp
 ## Recover from the removal of $@
         @if test -f $@; then :; else \
           rm -f data.stamp; \
           $(MAKE) $(AM_MAKEFLAGS) data.stamp; \
         fi
</code></pre>
<p>   ‘data.tmp’ is created before ‘foo’ is run, so it has a timestamp<br>older than output files output by ‘foo’.  It is then renamed to<br>‘data.stamp’ after ‘foo’ has run, because we do not want to update<br>‘data.stamp’ if ‘foo’ fails.</p>
<p>   This solution still suffers from the second problem: the race<br>condition in the recover rule.  If, after a successful build, a user<br>erases ‘data.c’ and ‘data.h’, and runs ‘make -j’, then ‘make’ may start<br>both recover rules in parallel.  If the two instances of the rule<br>execute ‘$(MAKE) $(AM_MAKEFLAGS) data.stamp’ concurrently the build is<br>likely to fail (for instance, the two rules will create ‘data.tmp’, but<br>only one can rename it).</p>
<p>   Admittedly, such a weird situation does not arise during ordinary<br>builds.  It occurs only when the build tree is mutilated.  Here ‘data.c’<br>and ‘data.h’ have been explicitly removed without also removing<br>‘data.stamp’ and the other output files.  ‘make clean; make’ will always<br>recover from these situations even with parallel makes, so you may<br>decide that the recover rule is solely to help non-parallel make users<br>and leave things as-is.  Fixing this requires some locking mechanism to<br>ensure only one instance of the recover rule rebuilds ‘data.stamp’.  One<br>could imagine something along the following lines.</p>
<pre><code> data.c data.h data.w data.x: data.stamp
 ## Recover from the removal of $@
         @if test -f $@; then :; else \
           trap 'rm -rf data.lock data.stamp' 1 2 13 15; \
 ## mkdir is a portable test-and-set
           if mkdir data.lock 2&gt;/dev/null; then \
 ## This code is being executed by the first process.
             rm -f data.stamp; \
             $(MAKE) $(AM_MAKEFLAGS) data.stamp; \
             result=$$?; rm -rf data.lock; exit $$result; \
           else \
 ## This code is being executed by the follower processes.
 ## Wait until the first process is done.
             while test -d data.lock; do sleep 1; done; \
 ## Succeed if and only if the first process succeeded.
             test -f data.stamp; \
           fi; \
         fi
</code></pre>
<p>   Using a dedicated witness, like ‘data.stamp’, is very handy when the<br>list of output files is not known beforehand.  As an illustration,<br>consider the following rules to compile many ‘*.el’ files into ‘*.elc’<br>files in a single command.  It does not matter how ‘ELFILES’ is defined<br>(as long as it is not empty: empty targets are not accepted by POSIX).</p>
<pre><code> ELFILES = one.el two.el three.el ...
 ELCFILES = $(ELFILES:=c)

 elc-stamp: $(ELFILES)
         @rm -f elc-temp
         @touch elc-temp
         $(elisp_comp) $(ELFILES)
         @mv -f elc-temp $@

 $(ELCFILES): elc-stamp
         @if test -f $@; then :; else \
 ## Recover from the removal of $@
           trap 'rm -rf elc-lock elc-stamp' 1 2 13 15; \
           if mkdir elc-lock 2&gt;/dev/null; then \
 ## This code is being executed by the first process.
             rm -f elc-stamp; \
             $(MAKE) $(AM_MAKEFLAGS) elc-stamp; \
             rmdir elc-lock; \
           else \
 ## This code is being executed by the follower processes.
 ## Wait until the first process is done.
             while test -d elc-lock; do sleep 1; done; \
 ## Succeed if and only if the first process succeeded.
             test -f elc-stamp; exit $$?; \
           fi; \
         fi
</code></pre>
<p>   These solutions all still suffer from the third problem, namely that<br>they break the promise that ‘make -n’ should not cause any actual<br>changes to the tree.  For those solutions that do not create lock files,<br>it is possible to split the recover rules into two separate recipe<br>commands, one of which does all work but the recursion, and the other<br>invokes the recursive ‘$(MAKE)’.  The solutions involving locking could<br>act upon the contents of the ‘MAKEFLAGS’ variable, but parsing that<br>portably is not easy (*note (autoconf)The Make Macro MAKEFLAGS::).  Here<br>is an example:</p>
<pre><code> ELFILES = one.el two.el three.el ...
 ELCFILES = $(ELFILES:=c)

 elc-stamp: $(ELFILES)
         @rm -f elc-temp
         @touch elc-temp
         $(elisp_comp) $(ELFILES)
         @mv -f elc-temp $@

 $(ELCFILES): elc-stamp
 ## Recover from the removal of $@
         @dry=; for f in x $$MAKEFLAGS; do \
           case $$f in \
             *=*|--*);; \
             *n*) dry=:;; \
           esac; \
         done; \
         if test -f $@; then :; else \
           $$dry trap 'rm -rf elc-lock elc-stamp' 1 2 13 15; \
           if $$dry mkdir elc-lock 2&gt;/dev/null; then \
 ## This code is being executed by the first process.
             $$dry rm -f elc-stamp; \
             $(MAKE) $(AM_MAKEFLAGS) elc-stamp; \
             $$dry rmdir elc-lock; \
           else \
 ## This code is being executed by the follower processes.
 ## Wait until the first process is done.
             while test -d elc-lock &amp;&amp; test -z "$$dry"; do \
               sleep 1; \
             done; \
 ## Succeed if and only if the first process succeeded.
             $$dry test -f elc-stamp; exit $$?; \
           fi; \
         fi
</code></pre>
<p>   For completeness it should be noted that GNU ‘make’ is able to<br>express rules with multiple output files using pattern rules (*note<br>Pattern Rule Examples: (make)Pattern Examples.).  We do not discuss<br>pattern rules here because they are not portable, but they can be<br>convenient in packages that assume GNU ‘make’.</p>
<h1 id="27-10-Installing-to-Hard-Coded-Locations"><a href="#27-10-Installing-to-Hard-Coded-Locations" class="headerlink" title="27.10 Installing to Hard-Coded Locations"></a>27.10 Installing to Hard-Coded Locations</h1><pre><code> My package needs to install some configuration file.  I tried to use
 the following rule, but ‘make distcheck’ fails.  Why?

      # Do not do this.
      install-data-local:
              $(INSTALL_DATA) $(srcdir)/afile $(DESTDIR)/etc/afile

 My package needs to populate the installation directory of another
 package at install-time.  I can easily compute that installation
 directory in ‘configure’, but if I install files therein,
 ‘make distcheck’ fails.  How else should I do?
</code></pre>
<p>   These two setups share their symptoms: ‘make distcheck’ fails because<br>they are installing files to hard-coded paths.  In the later case the<br>path is not really hard-coded in the package, but we can consider it to<br>be hard-coded in the system (or in whichever tool that supplies the<br>path).  As long as the path does not use any of the standard directory<br>variables (‘$(prefix)’, ‘$(bindir)’, ‘$(datadir)’, etc.), the effect<br>will be the same: user-installations are impossible.</p>
<p>   As a (non-root) user who wants to install a package, you usually have<br>no right to install anything in ‘/usr’ or ‘/usr/local’.  So you do<br>something like ‘./configure –prefix <del>/usr’ to install a package in your<br>own ‘</del>/usr’ tree.</p>
<p>   If a package attempts to install something to some hard-coded path<br>(e.g., ‘/etc/afile’), regardless of this ‘–prefix’ setting, then the<br>installation will fail.  ‘make distcheck’ performs such a ‘–prefix’<br>installation, hence it will fail too.</p>
<p>   Now, there are some easy solutions.</p>
<p>   The above ‘install-data-local’ example for installing ‘/etc/afile’<br>would be better replaced by</p>
<pre><code> sysconf_DATA = afile
</code></pre>
<p>by default ‘sysconfdir’ will be ‘$(prefix)/etc’, because this is what<br>the GNU Standards require.  When such a package is installed on an FHS<br>compliant system, the installer will have to set ‘–sysconfdir=/etc’.<br>As the maintainer of the package you should not be concerned by such<br>site policies: use the appropriate standard directory variable to<br>install your files so that the installer can easily redefine these<br>variables to match their site conventions.</p>
<p>   Installing files that should be used by another package is slightly<br>more involved.  Let’s take an example and assume you want to install a<br>shared library that is a Python extension module.  If you ask Python<br>where to install the library, it will answer something like this:</p>
<pre><code> % python -c 'from distutils import sysconfig;
              print sysconfig.get_python_lib(1,0)'
 /usr/lib/python2.5/site-packages
</code></pre>
<p>   If you indeed use this absolute path to install your shared library,<br>non-root users will not be able to install the package, hence distcheck<br>fails.</p>
<p>   Let’s do better.  The ‘sysconfig.get_python_lib()’ function actually<br>accepts a third argument that will replace Python’s installation prefix.</p>
<pre><code> % python -c 'from distutils import sysconfig;
              print sysconfig.get_python_lib(1,0,"${exec_prefix}")'
 ${exec_prefix}/lib/python2.5/site-packages
</code></pre>
<p>   You can also use this new path.  If you do<br>   • root users can install your package with the same ‘–prefix’ as<br>     Python (you get the behavior of the previous attempt)</p>
<p>   • non-root users can install your package too, they will have the<br>     extension module in a place that is not searched by Python but they<br>     can work around this using environment variables (and if you<br>     installed scripts that use this shared library, it’s easy to tell<br>     Python were to look in the beginning of your script, so the script<br>     works in both cases).</p>
<p>   The ‘AM_PATH_PYTHON’ macro uses similar commands to define<br>‘$(pythondir)’ and ‘$(pyexecdir)’ (*note Python::).</p>
<p>   Of course not all tools are as advanced as Python regarding that<br>substitution of PREFIX.  So another strategy is to figure the part of<br>the installation directory that must be preserved.  For instance, here<br>is how ‘AM_PATH_LISPDIR’ (*note Emacs Lisp::) computes ‘$(lispdir)’:</p>
<pre><code> $EMACS -batch -Q -eval '(while load-path
   (princ (concat (car load-path) "\n"))
   (setq load-path (cdr load-path)))' &gt;conftest.out
 lispdir=`sed -n
   -e 's,/$,,'
   -e '/.*\/lib\/x*emacs\/site-lisp$/{
         s,.*/lib/\(x*emacs/site-lisp\)$,${libdir}/\1,;p;q;
       }'
   -e '/.*\/share\/x*emacs\/site-lisp$/{
         s,.*/share/\(x*emacs/site-lisp\),${datarootdir}/\1,;p;q;
       }'
   conftest.out`
</code></pre>
<p>   I.e., it just picks the first directory that looks like<br>‘*/lib/<em>emacs/site-lisp’ or ‘</em>/share/*emacs/site-lisp’ in the search<br>path of emacs, and then substitutes ‘${libdir}’ or ‘${datadir}’<br>appropriately.</p>
<p>   The emacs case looks complicated because it processes a list and<br>expects two possible layouts, otherwise it’s easy, and the benefits for<br>non-root users are really worth the extra ‘sed’ invocation.</p>
<h1 id="27-11-Debugging-Make-Rules"><a href="#27-11-Debugging-Make-Rules" class="headerlink" title="27.11 Debugging Make Rules"></a>27.11 Debugging Make Rules</h1><p>The rules and dependency trees generated by ‘automake’ can get rather<br>complex, and leave the developer head-scratching when things don’t work<br>as expected.  Besides the debug options provided by the ‘make’ command<br>(*note (make)Options Summary::), here’s a couple of further hints for<br>debugging makefiles generated by ‘automake’ effectively:</p>
<p>   • If less verbose output has been enabled in the package with the use<br>     of silent rules (*note Automake Silent Rules::), you can use ‘make<br>     V=1’ to see the commands being executed.<br>   • ‘make -n’ can help show what would be done without actually doing<br>     it.  Note however, that this will <em>still execute</em> commands prefixed<br>     with ‘+’, and, when using GNU ‘make’, commands that contain the<br>     strings ‘$(MAKE)’ or ‘${MAKE}’ (*note (make)Instead of<br>     Execution::).  Typically, this is helpful to show what recursive<br>     rules would do, but it means that, in your own rules, you should<br>     not mix such recursion with actions that change any files.(1)<br>     Furthermore, note that GNU ‘make’ will update prerequisites for the<br>     ‘Makefile’ file itself even with ‘-n’ (*note (make)Remaking<br>     Makefiles::).<br>   • ‘make SHELL=”/bin/bash -vx”’ can help debug complex rules.  *Note<br>     (autoconf)The Make Macro SHELL::, for some portability quirks<br>     associated with this construct.<br>   • ‘echo ‘print: ; @echo “$(VAR)”‘ | make -f Makefile -f - print’ can<br>     be handy to examine the expanded value of variables.  You may need<br>     to use a target other than ‘print’ if that is already used or a<br>     file with that name exists.<br>   • <a href="http://bashdb.sourceforge.net/remake/">http://bashdb.sourceforge.net/remake/</a> provides a modified GNU<br>     ‘make’ command called ‘remake’ that copes with complex GNU<br>     ‘make’-specific Makefiles and allows to trace execution, examine<br>     variables, and call rules interactively, much like a debugger.</p>
<p>   ———- Footnotes ———-</p>
<p>   (1) Automake’s ‘dist’ and ‘distcheck’ rules had a bug in this regard<br>in that they created directories even with ‘-n’, but this has been fixed<br>in Automake 1.11.</p>
<h1 id="27-12-Reporting-Bugs"><a href="#27-12-Reporting-Bugs" class="headerlink" title="27.12 Reporting Bugs"></a>27.12 Reporting Bugs</h1><p>Most nontrivial software has bugs.  Automake is no exception.  Although<br>we cannot promise we can or will fix a bug, and we might not even agree<br>that it is a bug, we want to hear about problems you encounter.  Often<br>we agree they are bugs and want to fix them.</p>
<p>   To make it possible for us to fix a bug, please report it.  In order<br>to do so effectively, it helps to know when and how to do it.</p>
<p>   Before reporting a bug, it is a good idea to see if it is already<br>known.  You can look at the GNU Bug Tracker (<a href="https://debbugs.gnu.org/">https://debbugs.gnu.org/</a>)<br>and the bug-automake mailing list archives<br>(<a href="https://lists.gnu.org/archive/html/bug-automake/">https://lists.gnu.org/archive/html/bug-automake/</a>) for previous bug<br>reports.  We previously used a Gnats database<br>(<a href="http://sourceware.org/cgi-bin/gnatsweb.pl?database=automake">http://sourceware.org/cgi-bin/gnatsweb.pl?database=automake</a>) for bug<br>tracking, so some bugs might have been reported there already.  Please<br>do not use it for new bug reports, however.</p>
<p>   If the bug is not already known, it should be reported.  It is very<br>important to report bugs in a way that is useful and efficient.  For<br>this, please familiarize yourself with How to Report Bugs Effectively<br>(<a href="http://www.chiark.greenend.org.uk/~sgtatham/bugs.html">http://www.chiark.greenend.org.uk/~sgtatham/bugs.html</a>) and How to Ask<br>Questions the Smart Way<br>(<a href="http://catb.org/~esr/faqs/smart-questions.html">http://catb.org/~esr/faqs/smart-questions.html</a>).  This helps you and<br>developers to save time which can then be spent on fixing more bugs and<br>implementing more features.</p>
<p>   For a bug report, a feature request or other suggestions, please send<br>email to <a href="mailto:bug-automake@gnu.org">bug-automake@gnu.org</a>.  This will then open a new bug in the<br>bug tracker (<a href="https://debbugs.gnu.org/automake">https://debbugs.gnu.org/automake</a>).  Be sure to include the<br>versions of Autoconf and Automake that you use.  Ideally, post a minimal<br>‘Makefile.am’ and ‘configure.ac’ that reproduces the problem you<br>encounter.  If you have encountered test suite failures, please attach<br>the ‘test-suite.log’ file.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2018/05/08/astronomy-radio-recommend-reading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/08/astronomy-radio-recommend-reading/" class="post-title-link" itemprop="url">天文学推荐读物</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-08 23:16:44" itemprop="dateCreated datePublished" datetime="2018-05-08T23:16:44+08:00">2018-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Radio/" itemprop="url" rel="index"><span itemprop="name">Radio</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Radio/Astronomy/" itemprop="url" rel="index"><span itemprop="name">Astronomy</span></a>
                </span>
            </span>

          
            <span id="/2018/05/08/astronomy-radio-recommend-reading/" class="post-meta-item leancloud_visitors" data-flag-title="天文学推荐读物" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/05/08/astronomy-radio-recommend-reading/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/05/08/astronomy-radio-recommend-reading/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/05/08/astronomy-radio-recommend-reading/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/05/08/astronomy-radio-recommend-reading/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>[TOC]</p>
<h1 id="天文学推荐读物"><a href="#天文学推荐读物" class="headerlink" title="天文学推荐读物"></a>天文学推荐读物</h1><h2 id="射电天文学"><a href="#射电天文学" class="headerlink" title="射电天文学"></a>射电天文学</h2><p>下面的这些书大部分为射电天文学，部分包含射电干涉。</p>
<ul>
<li>Synthesis Imaging in Radio Astronomy II, G.B Taylor, C.L. Carilli, &amp; R.A. Perley eds, Astronomical Society of the Pacific Conference Series Volume 180.</li>
<li>The Fourier Transform and its Applications, R.N. Bracewell.</li>
<li>Interferometry and Synthesis in Radio Astronomy, A.R. Thompson, J.M. Moran &amp; G.W. Swenson.</li>
<li>Radio Astronomy, J.D. Kraus.</li>
<li>Radiotelescopes, W.N. Christiansen &amp; J.A. Högbom.</li>
<li>Tools of Radio Astronomy, K. Rohlfs &amp; T.L. Wilson.</li>
<li>Essential Radio Astronomy, James J. Condon &amp; Scott M. Ransom,2016</li>
<li>Very Long Baseline Interferometry Techniques and Applications, Marcello Felli, Ralph E. Spencer</li>
<li>Very Long Baseline Interferometry and the VLBA, Napier, Diamond &amp; Zensus</li>
</ul>
<p>用射电望远镜可以做那些科学，参考一下书籍：</p>
<ul>
<li><p>Galactic and Extragalactic Radio Astronomy, G.L. Verschuur &amp; K.I. Kellermann eds.</p>
</li>
<li><p>An Introduction to Radio Astronomy, B.F. Burke &amp; F. Graham-Smith.</p>
</li>
<li><p>Leiden Radio Classes materials</p>
</li>
</ul>
<blockquote>
<p>参考：<a href="http://www.atnf.csiro.au/">www.atnf.csiro.au</a></p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2018/05/07/linux-su-beginner/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/07/linux-su-beginner/" class="post-title-link" itemprop="url">焕然一新的 su</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-07 22:11:00" itemprop="dateCreated datePublished" datetime="2018-05-07T22:11:00+08:00">2018-05-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Linux入门</span></a>
                </span>
            </span>

          
            <span id="/2018/05/07/linux-su-beginner/" class="post-meta-item leancloud_visitors" data-flag-title="焕然一新的 su" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/05/07/linux-su-beginner/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/05/07/linux-su-beginner/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/05/07/linux-su-beginner/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/05/07/linux-su-beginner/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="焕然一新的-su"><a href="#焕然一新的-su" class="headerlink" title="焕然一新的 su"></a>焕然一新的 su</h1><p>.. note::<br>  几处早莺争暖树，谁家新燕啄春泥。<br>  白居易《钱塘湖春行》</p>
<p><code>su</code>的官方定义为：</p>
<blockquote>
<p>su - run a command with substitute user and group ID</p>
</blockquote>
<p>一言以蔽之，<code>su - user</code> 能切换到一个用户中去执行一个指令或脚本，而 <code>su</code> 应该是switch user的概念，这个命令可以让我们开启一个进程，赋予新的身份、用户ID、组ID等关联的各种读写访问权限。</p>
<p>所以，理所当然是需要密码的介入的。</p>
<p>而如果没有user的参数，默认就是进入到root账户了。</p>
<h2 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h2><p>该命令格式如下所示：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ su [options...] [-] [user [args...]]</span><br></pre></td></tr></tbody></table></figure>



<p>其中一些比较重要的选项如下所示:</p>
<ul>
<li><code>-f </code>，<code> –fast</code>：快速启动，不读取启动文件，这个取决于具体的shell。</li>
<li><code>-l</code> ， <code>–login</code>：这个参数让你有焕然一新的感觉，基本类似于重新登录。如果不指定，默认情况下是root环境。</li>
<li><code>-g</code>，<code>--group</code>：指定主要组，这个只能由root用户指定。</li>
<li><code>-m</code>， <code>-p</code> ，<code>–preserve-environment</code>：保留环境变量，除非指定了-l。</li>
<li><code>-s SHELL</code>，<code>--shell=SHELL</code>：切换使用的SHELL。</li>
</ul>
<h2 id="切换到用于user执行命令command"><a href="#切换到用于user执行命令command" class="headerlink" title="切换到用于user执行命令command"></a>切换到用于user执行命令command</h2><p>执行如下命令，会切换到user用户，然后执行ls命令</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ su - user -c <span class="built_in">ls</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="切换使用的SHELL"><a href="#切换使用的SHELL" class="headerlink" title="切换使用的SHELL"></a>切换使用的SHELL</h2><p>不同的人，可能对不同的SHELL情有独钟，A喜欢bash，B可能喜欢csh，这个就可以通过-s来切换，如下可以切换到csh</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ su - user -s /bin/csh</span><br></pre></td></tr></tbody></table></figure>

<p>关于SHELL，根据安装的环境不同，基本有如下几个：</p>
<ul>
<li>/bin/bash     </li>
<li>/bin/tcsh    </li>
<li>/usr/bin/sh  </li>
<li>/bin/csh      </li>
<li>/sbin/nologin  </li>
<li>/bin/sh</li>
</ul>
<h2 id="加与不加-的区别还是有的-su-user-和-su-user"><a href="#加与不加-的区别还是有的-su-user-和-su-user" class="headerlink" title="加与不加-的区别还是有的 su [user] 和 su - [user]"></a>加与不加-的区别还是有的 su [user] 和 su - [user]</h2><p><code>su [user]</code>切换到其他用户，但是不切换环境变量，<code>su - [user]</code>则是完整的切换到新的用户环境。</p>
<p>如：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/root</span><br><span class="line"></span><br><span class="line">$ su oper </span><br><span class="line">$ <span class="built_in">pwd</span>  </span><br><span class="line">/root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ su - oper </span><br><span class="line">Password:</span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/oper</span><br></pre></td></tr></tbody></table></figure>

<p>所以大家在切换用户时，尽量用su - [user]，否则可能会出现<u>环境变量不对</u>的问题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2018/05/07/linux-su/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/07/linux-su/" class="post-title-link" itemprop="url">Linux的su命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-07 22:11:00" itemprop="dateCreated datePublished" datetime="2018-05-07T22:11:00+08:00">2018-05-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/Linux%E5%85%A5%E9%97%A8/" itemprop="url" rel="index"><span itemprop="name">Linux入门</span></a>
                </span>
            </span>

          
            <span id="/2018/05/07/linux-su/" class="post-meta-item leancloud_visitors" data-flag-title="Linux的su命令" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/05/07/linux-su/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/05/07/linux-su/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/05/07/linux-su/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/05/07/linux-su/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><code>su - user</code> 能切换到一个用户中去执行一个指令或脚本</p>
<h2 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h2><p>该命令格式如下所示：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ su [options...] [-] [user [args...]]</span><br></pre></td></tr></tbody></table></figure>



<p>其中一些比较重要的选项如下所示:</p>
<ul>
<li><code>-f </code>，<code> –fast</code>：快速启动，不读取启动文件，这个取决于具体的shell。</li>
<li><code>-l</code> ， <code>–login</code>：这个参数让你有焕然一新的感觉，基本类似于重新登录。如果不指定，默认情况下是root环境。</li>
<li><code>-g</code>，<code>--group</code>：指定主要组，这个只能由root用户指定。</li>
<li><code>-m</code>， <code>-p</code> ，<code>–preserve-environment</code>：保留环境变量，除非指定了-l。</li>
<li><code>-s SHELL</code>，<code>--shell=SHELL</code>：切换使用的SHELL。</li>
</ul>
<h2 id="切换到用于user执行命令command"><a href="#切换到用于user执行命令command" class="headerlink" title="切换到用于user执行命令command"></a>切换到用于user执行命令command</h2><p>执行如下命令，会切换到user用户，然后执行ls命令</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ su - user -c <span class="built_in">ls</span></span><br></pre></td></tr></tbody></table></figure>



<h2 id="切换使用的SHELL"><a href="#切换使用的SHELL" class="headerlink" title="切换使用的SHELL"></a>切换使用的SHELL</h2><p>不同的人，可能对不同的SHELL情有独钟，A喜欢bash，B可能喜欢csh，这个就可以通过-s来切换，如下可以切换到csh</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ su - user -s /bin/csh</span><br></pre></td></tr></tbody></table></figure>

<p>关于SHELL，根据安装的环境不同，基本有如下几个：</p>
<ul>
<li>/bin/bash     </li>
<li>/bin/tcsh    </li>
<li>/usr/bin/sh  </li>
<li>/bin/csh      </li>
<li>/sbin/nologin  </li>
<li>/bin/sh</li>
</ul>
<h2 id="su-user-和-su-user-的区别："><a href="#su-user-和-su-user-的区别：" class="headerlink" title="su [user] 和 su - [user]的区别："></a>su [user] 和 su - [user]的区别：</h2><p><code>su [user]</code>切换到其他用户，但是不切换环境变量，<code>su - [user]</code>则是完整的切换到新的用户环境。</p>
<p>如：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/root</span><br><span class="line"></span><br><span class="line">$ su oper </span><br><span class="line">$ <span class="built_in">pwd</span>  </span><br><span class="line">/root</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ su - oper </span><br><span class="line">Password:</span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/oper</span><br></pre></td></tr></tbody></table></figure>

<p>所以大家在切换用户时，尽量用su - [user]，否则可能会出现<u>环境变量不对</u>的问题。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2018/05/06/linux-centos7-update-gitlab-ce/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/05/06/linux-centos7-update-gitlab-ce/" class="post-title-link" itemprop="url">CentOS7升级gitlab-ce</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-05-06 18:11:00" itemprop="dateCreated datePublished" datetime="2018-05-06T18:11:00+08:00">2018-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/CentOS/" itemprop="url" rel="index"><span itemprop="name">CentOS</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/CentOS/GitLab/" itemprop="url" rel="index"><span itemprop="name">GitLab</span></a>
                </span>
            </span>

          
            <span id="/2018/05/06/linux-centos7-update-gitlab-ce/" class="post-meta-item leancloud_visitors" data-flag-title="CentOS7升级gitlab-ce" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/05/06/linux-centos7-update-gitlab-ce/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/05/06/linux-centos7-update-gitlab-ce/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/05/06/linux-centos7-update-gitlab-ce/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/05/06/linux-centos7-update-gitlab-ce/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="备份升级"><a href="#备份升级" class="headerlink" title="备份升级"></a>备份升级</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> gitlab-rake gitlab:backup:create STRATEGY=copy  </span><br><span class="line"><span class="built_in">sudo</span> yum install -y gitlab-ce</span><br></pre></td></tr></tbody></table></figure>

<p>如果是从8.12的版本进行升级，首先需要升级到8.17.7</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> yum install gitlab-ce-8.17.7</span><br><span class="line"><span class="comment"># 此时就可以升级到最新的release版本了</span></span><br><span class="line"><span class="built_in">sudo</span> yum install gitlab-ce-10.0.0</span><br><span class="line"><span class="built_in">sudo</span> yum install gitlab-ce-11.0.0</span><br><span class="line"><span class="comment">#sudo yum install gitlab-ce-12.0.0</span></span><br><span class="line"><span class="comment">#sudo yum install gitlab-ce-13.0.0</span></span><br><span class="line"><span class="built_in">sudo</span> yum install -y gitlab-ce</span><br></pre></td></tr></tbody></table></figure>

<h1 id="配置并启动GitLab"><a href="#配置并启动GitLab" class="headerlink" title="配置并启动GitLab"></a>配置并启动GitLab</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> gitlab-ctl reconfigure</span><br><span class="line"><span class="built_in">sudo</span> gitlab-ctl restart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 偶尔提示需要升级数据库</span></span><br><span class="line"><span class="built_in">sudo</span> gitlab-ctl pg-upgrade</span><br></pre></td></tr></tbody></table></figure>

<h1 id="浏览并登陆"><a href="#浏览并登陆" class="headerlink" title="浏览并登陆"></a>浏览并登陆</h1><p>此时就可以设置用户名和密码了。</p>
<p>Enjoy!!!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2018/03/20/linux-automake-15-support-for-test-suites/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/20/linux-automake-15-support-for-test-suites/" class="post-title-link" itemprop="url">Linux Automake 15 Support for test suites</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-20 22:28:00" itemprop="dateCreated datePublished" datetime="2018-03-20T22:28:00+08:00">2018-03-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/Automake/" itemprop="url" rel="index"><span itemprop="name">Automake</span></a>
                </span>
            </span>

          
            <span id="/2018/03/20/linux-automake-15-support-for-test-suites/" class="post-meta-item leancloud_visitors" data-flag-title="Linux Automake 15 Support for test suites" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/03/20/linux-automake-15-support-for-test-suites/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/03/20/linux-automake-15-support-for-test-suites/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/03/20/linux-automake-15-support-for-test-suites/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/03/20/linux-automake-15-support-for-test-suites/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>GNU Automake 版本(version 1.16.1, 26 February 2018)</p>
<p>Permission is granted to copy, distribute and/or modify this<br>document under the terms of the GNU Free Documentation License,<br>Version 1.3 or any later version published by the Free Software<br>Foundation; with no Invariant Sections, with no Front-Cover texts,<br>and with no Back-Cover Texts.  A copy of the license is included in<br>the section entitled “GNU Free Documentation License.”</p>
</blockquote>
<p>15 Support for test suites</p>
<hr>
<p>Automake can generate code to handle two kinds of test suites.  One is<br>based on integration with the ‘dejagnu’ framework.  The other (and most<br>used) form is based on the use of generic test scripts, and its<br>activation is triggered by the definition of the special ‘TESTS’<br>variable.  This second form allows for various degrees of sophistication<br>and customization; in particular, it allows for concurrent execution of<br>test scripts, use of established test protocols such as TAP, and<br>definition of custom test drivers and test runners.</p>
<p>In either case, the testsuite is invoked via ‘make check’.</p>
<h1 id="15-1-Generalities-about-Testing"><a href="#15-1-Generalities-about-Testing" class="headerlink" title="15.1 Generalities about Testing"></a>15.1 Generalities about Testing</h1><p>The purpose of testing is to determine whether a program or system<br>behaves as expected (e.g., known inputs produce the expected outputs,<br>error conditions are correctly handled or reported, and older bugs do<br>not resurface).</p>
<p>   The minimal unit of testing is usually called <em>test case</em>, or simply<br><em>test</em>.  How a test case is defined or delimited, and even what exactly<br><em>constitutes</em> a test case, depends heavily on the testing paradigm<br>and/or framework in use, so we won’t attempt any more precise<br>definition.  The set of the test cases for a given program or system<br>constitutes its <em>testsuite</em>.</p>
<p>   A <em>test harness</em> (also <em>testsuite harness</em>) is a program or software<br>component that executes all (or part of) the defined test cases,<br>analyzes their outcomes, and report or register these outcomes<br>appropriately.  Again, the details of how this is accomplished (and how<br>the developer and user can influence it or interface with it) varies<br>wildly, and we’ll attempt no precise definition.</p>
<p>   A test is said to <em>pass</em> when it can determine that the condition or<br>behaviour it means to verify holds, and is said to <em>fail</em> when it can<br>determine that such condition of behaviour does <em>not</em> hold.</p>
<p>   Sometimes, tests can rely on non-portable tools or prerequisites, or<br>simply make no sense on a given system (for example, a test checking a<br>Windows-specific feature makes no sense on a GNU/Linux system).  In this<br>case, accordingly to the definition above, the tests can neither be<br>considered passed nor failed; instead, they are <em>skipped</em> – i.e., they<br>are not run, or their result is anyway ignored for what concerns the<br>count of failures an successes.  Skips are usually explicitly reported<br>though, so that the user will be aware that not all of the testsuite has<br>really run.</p>
<p>   It’s not uncommon, especially during early development stages, that<br>some tests fail for known reasons, and that the developer doesn’t want<br>to tackle these failures immediately (this is especially true when the<br>failing tests deal with corner cases).  In this situation, the better<br>policy is to declare that each of those failures is an <em>expected<br>failure</em> (or <em>xfail</em>).  In case a test that is expected to fail ends up<br>passing instead, many testing environments will flag the result as a<br>special kind of failure called <em>unexpected pass</em> (or <em>xpass</em>).</p>
<p>   Many testing environments and frameworks distinguish between test<br>failures and hard errors.  As we’ve seen, a test failure happens when<br>some invariant or expected behaviour of the software under test is not<br>met.  An <em>hard error</em> happens when e.g., the set-up of a test case<br>scenario fails, or when some other unexpected or highly undesirable<br>condition is encountered (for example, the program under test<br>experiences a segmentation fault).</p>
<h1 id="15-2-Simple-Tests"><a href="#15-2-Simple-Tests" class="headerlink" title="15.2 Simple Tests"></a>15.2 Simple Tests</h1><h2 id="15-2-1-Scripts-based-Testsuites"><a href="#15-2-1-Scripts-based-Testsuites" class="headerlink" title="15.2.1 Scripts-based Testsuites"></a>15.2.1 Scripts-based Testsuites</h2><p>If the special variable ‘TESTS’ is defined, its value is taken to be a<br>list of programs or scripts to run in order to do the testing.  Under<br>the appropriate circumstances, it’s possible for ‘TESTS’ to list also<br>data files to be passed to one or more test scripts defined by different<br>means (the so-called “log compilers”, *note Parallel Test Harness::).</p>
<p>   Test scripts can be executed serially or concurrently.  Automake<br>supports both these kinds of test execution, with the parallel test<br>harness being the default.  The concurrent test harness relies on the<br>concurrence capabilities (if any) offered by the underlying ‘make’<br>implementation, and can thus only be as good as those are.</p>
<p>   By default, only the exit statuses of the test scripts are considered<br>when determining the testsuite outcome.  But Automake allows also the<br>use of more complex test protocols, either standard (*note Using the TAP<br>test protocol::) or custom (*note Custom Test Drivers::).  Note that you<br>can’t enable such protocols when the serial harness is used, though.  In<br>the rest of this section we are going to concentrate mostly on<br>protocol-less tests, since we cover test protocols in a later section<br>(again, *note Custom Test Drivers::).</p>
<p>   When no test protocol is in use, an exit status of 0 from a test<br>script will denote a success, an exit status of 77 a skipped test, an<br>exit status of 99 an hard error, and any other exit status will denote a<br>failure.</p>
<p>   You may define the variable ‘XFAIL_TESTS’ to a list of tests (usually<br>a subset of ‘TESTS’) that are expected to fail; this will effectively<br>reverse the result of those tests (with the provision that skips and<br>hard errors remain untouched).  You may also instruct the testsuite<br>harness to treat hard errors like simple failures, by defining the<br>‘DISABLE_HARD_ERRORS’ make variable to a nonempty value.</p>
<p>   Note however that, for tests based on more complex test protocols,<br>the exact effects of ‘XFAIL_TESTS’ and ‘DISABLE_HARD_ERRORS’ might<br>change, or they might even have no effect at all (for example, in tests<br>using TAP, there is no way to disable hard errors, and the<br>‘DISABLE_HARD_ERRORS’ variable has no effect on them).</p>
<p>   The result of each test case run by the scripts in ‘TESTS’ will be<br>printed on standard output, along with the test name.  For test<br>protocols that allow more test cases per test script (such as TAP), a<br>number, identifier and/or brief description specific for the single test<br>case is expected to be printed in addition to the name of the test<br>script.  The possible results (whose meanings should be clear from the<br>previous *note Generalities about Testing::) are ‘PASS’, ‘FAIL’, ‘SKIP’,<br>‘XFAIL’, ‘XPASS’ and ‘ERROR’.  Here is an example of output from an<br>hypothetical testsuite that uses both plain and TAP tests:<br>     PASS: foo.sh<br>     PASS: zardoz.tap 1 - Daemon started<br>     PASS: zardoz.tap 2 - Daemon responding<br>     SKIP: zardoz.tap 3 - Daemon uses /proc # SKIP /proc is not mounted<br>     PASS: zardoz.tap 4 - Daemon stopped<br>     SKIP: bar.sh<br>     PASS: mu.tap 1<br>     XFAIL: mu.tap 2 # TODO frobnication not yet implemented</p>
<p>A testsuite summary (expected to report at least the number of run,<br>skipped and failed tests) will be printed at the end of the testsuite<br>run.</p>
<p>   If the standard output is connected to a capable terminal, then the<br>test results and the summary are colored appropriately.  The developer<br>and the user can disable colored output by setting the ‘make’ variable<br>‘AM_COLOR_TESTS=no’; the user can in addition force colored output even<br>without a connecting terminal with ‘AM_COLOR_TESTS=always’.  It’s also<br>worth noting that some ‘make’ implementations, when used in parallel<br>mode, have slightly different semantics (*note (autoconf)Parallel<br>make::), which can break the automatic detection of a connection to a<br>capable terminal.  If this is the case, the user will have to resort to<br>the use of ‘AM_COLOR_TESTS=always’ in order to have the testsuite output<br>colorized.</p>
<p>   Test programs that need data files should look for them in ‘srcdir’<br>(which is both a make variable and an environment variable made<br>available to the tests), so that they work when building in a separate<br>directory (*note Build Directories: (autoconf)Build Directories.), and<br>in particular for the ‘distcheck’ rule (*note Checking the<br>Distribution::).</p>
<p>   The ‘AM_TESTS_ENVIRONMENT’ and ‘TESTS_ENVIRONMENT’ variables can be<br>used to run initialization code and set environment variables for the<br>test scripts.  The former variable is developer-reserved, and can be<br>defined in the ‘Makefile.am’, while the latter is reserved for the user,<br>which can employ it to extend or override the settings in the former;<br>for this to work portably, however, the contents of a non-empty<br>‘AM_TESTS_ENVIRONMENT’ <em>must</em> be terminated by a semicolon.</p>
<p>   The ‘AM_TESTS_FD_REDIRECT’ variable can be used to define file<br>descriptor redirections for the test scripts.  One might think that<br>‘AM_TESTS_ENVIRONMENT’ could be used for this purpose, but experience<br>has shown that doing so portably is practically impossible.  The main<br>hurdle is constituted by Korn shells, which usually set the<br>close-on-exec flag on file descriptors opened with the ‘exec’ builtin,<br>thus rendering an idiom like ‘AM_TESTS_ENVIRONMENT = exec 9&gt;&amp;2;’<br>ineffectual.  This issue also affects some Bourne shells, such as the<br>HP-UX’s ‘/bin/sh’,</p>
<pre><code> AM_TESTS_ENVIRONMENT = \
 ## Some environment initializations are kept in a separate shell
 ## file 'tests-env.sh', which can make it easier to also run tests
 ## from the command line.
   . $(srcdir)/tests-env.sh; \
 ## On Solaris, prefer more POSIX-compliant versions of the standard
 ## tools by default.
   if test -d /usr/xpg4/bin; then \
     PATH=/usr/xpg4/bin:$$PATH; export PATH; \
   fi;
 ## With this, the test scripts will be able to print diagnostic
 ## messages to the original standard error stream, even if the test
 ## driver redirects the stderr of the test scripts to a log file
 ## before executing them.
 AM_TESTS_FD_REDIRECT = 9&gt;&amp;2
</code></pre>
<p>Note however that ‘AM_TESTS_ENVIRONMENT’ is, for historical and<br>implementation reasons, <em>not</em> supported by the serial harness (*note<br>Serial Test Harness::).</p>
<p>   Automake ensures that each file listed in ‘TESTS’ is built before it<br>is run; you can list both source and derived programs (or scripts) in<br>‘TESTS’; the generated rule will look both in ‘srcdir’ and ‘.’.  For<br>instance, you might want to run a C program as a test.  To do this you<br>would list its name in ‘TESTS’ and also in ‘check_PROGRAMS’, and then<br>specify it as you would any other program.</p>
<p>   Programs listed in ‘check_PROGRAMS’ (and ‘check_LIBRARIES’,<br>‘check_LTLIBRARIES’…)  are only built during ‘make check’, not during<br>‘make all’.  You should list there any program needed by your tests that<br>does not need to be built by ‘make all’.  Note that ‘check_PROGRAMS’ are<br><em>not</em> automatically added to ‘TESTS’ because ‘check_PROGRAMS’ usually<br>lists programs used by the tests, not the tests themselves.  Of course<br>you can set ‘TESTS = $(check_PROGRAMS)’ if all your programs are test<br>cases.</p>
<h2 id="15-2-2-Older-and-discouraged-serial-test-harness"><a href="#15-2-2-Older-and-discouraged-serial-test-harness" class="headerlink" title="15.2.2 Older (and discouraged) serial test harness"></a>15.2.2 Older (and discouraged) serial test harness</h2><p>First, note that today the use of this harness is strongly discouraged<br>in favour of the parallel test harness (*note Parallel Test Harness::).<br>Still, there are <em>few</em> situations when the advantages offered by the<br>parallel harness are irrelevant, and when test concurrency can even<br>cause tricky problems.  In those cases, it might make sense to still use<br>the serial harness, for simplicity and reliability (we still suggest<br>trying to give the parallel harness a shot though).</p>
<p>   The serial test harness is enabled by the Automake option<br>‘serial-tests’.  It operates by simply running the tests serially, one<br>at the time, without any I/O redirection.  It’s up to the user to<br>implement logging of tests’ output, if that’s required or desired.</p>
<p>   For historical and implementation reasons, the ‘AM_TESTS_ENVIRONMENT’<br>variable is <em>not</em> supported by this harness (it will be silently ignored<br>if defined); only ‘TESTS_ENVIRONMENT’ is, and it is to be considered a<br>developer-reserved variable.  This is done so that, when using the<br>serial harness, ‘TESTS_ENVIRONMENT’ can be defined to an invocation of<br>an interpreter through which the tests are to be run.  For instance, the<br>following setup may be used to run tests with Perl:</p>
<pre><code> TESTS_ENVIRONMENT = $(PERL) -Mstrict -w
 TESTS = foo.pl bar.pl baz.pl
</code></pre>
<p>It’s important to note that the use of ‘TESTS_ENVIRONMENT’ endorsed here<br>would be <em>invalid</em> with the parallel harness.  That harness provides a<br>more elegant way to achieve the same effect, with the further benefit of<br>freeing the ‘TESTS_ENVIRONMENT’ variable for the user (*note Parallel<br>Test Harness::).</p>
<p>   Another, less serious limit of the serial harness is that it doesn’t<br>really distinguish between simple failures and hard errors; this is due<br>to historical reasons only, and might be fixed in future Automake<br>versions.</p>
<h2 id="15-2-3-Parallel-Test-Harness"><a href="#15-2-3-Parallel-Test-Harness" class="headerlink" title="15.2.3 Parallel Test Harness"></a>15.2.3 Parallel Test Harness</h2><p>By default, Automake generated a parallel (concurrent) test harness.  It<br>features automatic collection of the test scripts output in ‘.log’<br>files, concurrent execution of tests with ‘make -j’, specification of<br>inter-test dependencies, lazy reruns of tests that have not completed in<br>a prior run, and hard errors for exceptional failures.</p>
<p>   The parallel test harness operates by defining a set of ‘make’ rules<br>that run the test scripts listed in ‘TESTS’, and, for each such script,<br>save its output in a corresponding ‘.log’ file and its results (and<br>other “metadata”, *note API for Custom Test Drivers::) in a<br>corresponding ‘.trs’ (as in Test ReSults) file.  The ‘.log’ file will<br>contain all the output emitted by the test on its standard output and<br>its standard error.  The ‘.trs’ file will contain, among the other<br>things, the results of the test cases run by the script.</p>
<p>   The parallel test harness will also create a summary log file,<br>‘TEST_SUITE_LOG’, which defaults to ‘test-suite.log’ and requires a<br>‘.log’ suffix.  This file depends upon all the ‘.log’ and ‘.trs’ files<br>created for the test scripts listed in ‘TESTS’.</p>
<p>   As with the serial harness above, by default one status line is<br>printed per completed test, and a short summary after the suite has<br>completed.  However, standard output and standard error of the test are<br>redirected to a per-test log file, so that parallel execution does not<br>produce intermingled output.  The output from failed tests is collected<br>in the ‘test-suite.log’ file.  If the variable ‘VERBOSE’ is set, this<br>file is output after the summary.</p>
<p>   Each couple of ‘.log’ and ‘.trs’ files is created when the<br>corresponding test has completed.  The set of log files is listed in the<br>read-only variable ‘TEST_LOGS’, and defaults to ‘TESTS’, with the<br>executable extension if any (*note EXEEXT::), as well as any suffix<br>listed in ‘TEST_EXTENSIONS’ removed, and ‘.log’ appended.  Results are<br>undefined if a test file name ends in several concatenated suffixes.<br>‘TEST_EXTENSIONS’ defaults to ‘.test’; it can be overridden by the user,<br>in which case any extension listed in it must be constituted by a dot,<br>followed by a non-digit alphabetic character, followed by any number of<br>alphabetic characters.  For example, ‘.sh’, ‘.T’ and ‘.t1’ are valid<br>extensions, while ‘.x-y’, ‘.6c’ and ‘.t.1’ are not.</p>
<p>   It is important to note that, due to current limitations (unlikely to<br>be lifted), configure substitutions in the definition of ‘TESTS’ can<br>only work if they will expand to a list of tests that have a suffix<br>listed in ‘TEST_EXTENSIONS’.</p>
<p>   For tests that match an extension ‘.EXT’ listed in ‘TEST_EXTENSIONS’,<br>you can provide a custom “test runner” using the variable<br>‘EXT_LOG_COMPILER’ (note the upper-case extension) and pass options in<br>‘AM_EXT_LOG_FLAGS’ and allow the user to pass options in<br>‘EXT_LOG_FLAGS’.  It will cause all tests with this extension to be<br>called with this runner.  For all tests without a registered extension,<br>the variables ‘LOG_COMPILER’, ‘AM_LOG_FLAGS’, and ‘LOG_FLAGS’ may be<br>used.  For example,</p>
<pre><code> TESTS = foo.pl bar.py baz
 TEST_EXTENSIONS = .pl .py
 PL_LOG_COMPILER = $(PERL)
 AM_PL_LOG_FLAGS = -w
 PY_LOG_COMPILER = $(PYTHON)
 AM_PY_LOG_FLAGS = -v
 LOG_COMPILER = ./wrapper-script
 AM_LOG_FLAGS = -d
</code></pre>
<p>will invoke ‘$(PERL) -w foo.pl’, ‘$(PYTHON) -v bar.py’, and<br>‘./wrapper-script -d baz’ to produce ‘foo.log’, ‘bar.log’, and<br>‘baz.log’, respectively.  The ‘foo.trs’, ‘bar.trs’ and ‘baz.trs’ files<br>will be automatically produced as a side-effect.</p>
<p>   It’s important to note that, differently from what we’ve seen for the<br>serial test harness (*note Serial Test Harness::), the<br>‘AM_TESTS_ENVIRONMENT’ and ‘TESTS_ENVIRONMENT’ variables <em>cannot</em> be<br>used to define a custom test runner; the ‘LOG_COMPILER’ and ‘LOG_FLAGS’<br>(or their extension-specific counterparts) should be used instead:</p>
<pre><code> ## This is WRONG!
 AM_TESTS_ENVIRONMENT = PERL5LIB='$(srcdir)/lib' $(PERL) -Mstrict -w

 ## Do this instead.
 AM_TESTS_ENVIRONMENT = PERL5LIB='$(srcdir)/lib'; export PERL5LIB;
 LOG_COMPILER = $(PERL)
 AM_LOG_FLAGS = -Mstrict -w
</code></pre>
<p>   By default, the test suite harness will run all tests, but there are<br>several ways to limit the set of tests that are run:</p>
<p>   • You can set the ‘TESTS’ variable.  For example, you can use a<br>     command like this to run only a subset of the tests:</p>
<pre><code>      env TESTS="foo.test bar.test" make -e check

 Note however that the command above will unconditionally overwrite
 the ‘test-suite.log’ file, thus clobbering the recorded results of
 any previous testsuite run.  This might be undesirable for packages
 whose testsuite takes long time to execute.  Luckily, this problem
 can easily be avoided by overriding also ‘TEST_SUITE_LOG’ at
 runtime; for example,

      env TEST_SUITE_LOG=partial.log TESTS="..." make -e check

 will write the result of the partial testsuite runs to the
 ‘partial.log’, without touching ‘test-suite.log’.
</code></pre>
<p>   • You can set the ‘TEST_LOGS’ variable.  By default, this variable is<br>     computed at ‘make’ run time from the value of ‘TESTS’ as described<br>     above.  For example, you can use the following:</p>
<pre><code>      set x subset*.log; shift
      env TEST_LOGS="foo.log $*" make -e check

 The comments made above about ‘TEST_SUITE_LOG’ overriding applies
 here too.
</code></pre>
<p>   • By default, the test harness removes all old per-test ‘.log’ and<br>     ‘.trs’ files before it starts running tests to regenerate them.<br>     The variable ‘RECHECK_LOGS’ contains the set of ‘.log’ (and, by<br>     implication, ‘.trs’) files which are removed.  ‘RECHECK_LOGS’<br>     defaults to ‘TEST_LOGS’, which means all tests need to be<br>     rechecked.  By overriding this variable, you can choose which tests<br>     need to be reconsidered.  For example, you can lazily rerun only<br>     those tests which are outdated, i.e., older than their prerequisite<br>     test files, by setting this variable to the empty value:</p>
<pre><code>      env RECHECK_LOGS= make -e check
</code></pre>
<p>   • You can ensure that all tests are rerun which have failed or passed<br>     unexpectedly, by running ‘make recheck’ in the test directory.<br>     This convenience target will set ‘RECHECK_LOGS’ appropriately<br>     before invoking the main test harness.</p>
<p>In order to guarantee an ordering between tests even with ‘make -jN’,<br>dependencies between the corresponding ‘.log’ files may be specified<br>through usual ‘make’ dependencies.  For example, the following snippet<br>lets the test named ‘foo-execute.test’ depend upon completion of the<br>test ‘foo-compile.test’:</p>
<pre><code> TESTS = foo-compile.test foo-execute.test
 foo-execute.log: foo-compile.log
</code></pre>
<p>Please note that this ordering ignores the <em>results</em> of required tests,<br>thus the test ‘foo-execute.test’ is run even if the test<br>‘foo-compile.test’ failed or was skipped beforehand.  Further, please<br>note that specifying such dependencies currently works only for tests<br>that end in one of the suffixes listed in ‘TEST_EXTENSIONS’.</p>
<p>   Tests without such specified dependencies may be run concurrently<br>with parallel ‘make -jN’, so be sure they are prepared for concurrent<br>execution.</p>
<p>   The combination of lazy test execution and correct dependencies<br>between tests and their sources may be exploited for efficient unit<br>testing during development.  To further speed up the edit-compile-test<br>cycle, it may even be useful to specify compiled programs in<br>‘EXTRA_PROGRAMS’ instead of with ‘check_PROGRAMS’, as the former allows<br>intertwined compilation and test execution (but note that<br>‘EXTRA_PROGRAMS’ are not cleaned automatically, *note Uniform::).</p>
<p>   The variables ‘TESTS’ and ‘XFAIL_TESTS’ may contain conditional parts<br>as well as configure substitutions.  In the latter case, however,<br>certain restrictions apply: substituted test names must end with a<br>nonempty test suffix like ‘.test’, so that one of the inference rules<br>generated by ‘automake’ can apply.  For literal test names, ‘automake’<br>can generate per-target rules to avoid this limitation.</p>
<p>   Please note that it is currently not possible to use ‘$(srcdir)/’ or<br>‘$(top_srcdir)/’ in the ‘TESTS’ variable.  This technical limitation is<br>necessary to avoid generating test logs in the source tree and has the<br>unfortunate consequence that it is not possible to specify distributed<br>tests that are themselves generated by means of explicit rules, in a way<br>that is portable to all ‘make’ implementations (*note (autoconf)Make<br>Target Lookup::, the semantics of FreeBSD and OpenBSD ‘make’ conflict<br>with this).  In case of doubt you may want to require to use GNU ‘make’,<br>or work around the issue with inference rules to generate the tests.</p>
<h1 id="15-3-Custom-Test-Drivers"><a href="#15-3-Custom-Test-Drivers" class="headerlink" title="15.3 Custom Test Drivers"></a>15.3 Custom Test Drivers</h1><h2 id="15-3-1-Overview-of-Custom-Test-Drivers-Support"><a href="#15-3-1-Overview-of-Custom-Test-Drivers-Support" class="headerlink" title="15.3.1 Overview of Custom Test Drivers Support"></a>15.3.1 Overview of Custom Test Drivers Support</h2><p>Starting from Automake version 1.12, the parallel test harness allows<br>the package authors to use third-party custom test drivers, in case the<br>default ones are inadequate for their purposes, or do not support their<br>testing protocol of choice.</p>
<p>   A custom test driver is expected to properly run the test programs<br>passed to it (including the command-line arguments passed to those<br>programs, if any), to analyze their execution and outcome, to create the<br>‘.log’ and ‘.trs’ files associated to these test runs, and to display<br>the test results on the console.  It is responsibility of the author of<br>the test driver to ensure that it implements all the above steps<br>meaningfully and correctly; Automake isn’t and can’t be of any help<br>here.  On the other hand, the Automake-provided code for testsuite<br>summary generation offers support for test drivers allowing several test<br>results per test script, if they take care to register such results<br>properly (*note Log files generation and test results recording::).</p>
<p>   The exact details of how test scripts’ results are to be determined<br>and analyzed is left to the individual drivers.  Some drivers might only<br>consider the test script exit status (this is done for example by the<br>default test driver used by the parallel test harness, described in the<br>previous section).  Other drivers might implement more complex and<br>advanced test protocols, which might require them to parse and<br>interpreter the output emitted by the test script they’re running<br>(examples of such protocols are TAP and SubUnit).</p>
<p>   It’s very important to note that, even when using custom test<br>drivers, most of the infrastructure described in the previous section<br>about the parallel harness remains in place; this includes:</p>
<p>   • list of test scripts defined in ‘TESTS’, and overridable at runtime<br>     through the redefinition of ‘TESTS’ or ‘TEST_LOGS’;<br>   • concurrency through the use of ‘make’’s option ‘-j’;<br>   • per-test ‘.log’ and ‘.trs’ files, and generation of a summary<br>     ‘.log’ file from them;<br>   • ‘recheck’ target, ‘RECHECK_LOGS’ variable, and lazy reruns of<br>     tests;<br>   • inter-test dependencies;<br>   • support for ‘check_*’ variables (‘check_PROGRAMS’,<br>     ‘check_LIBRARIES’, …);<br>   • use of ‘VERBOSE’ environment variable to get verbose output on<br>     testsuite failures;<br>   • definition and honoring of ‘TESTS_ENVIRONMENT’,<br>     ‘AM_TESTS_ENVIRONMENT’ and ‘AM_TESTS_FD_REDIRECT’ variables;<br>   • definition of generic and extension-specific ‘LOG_COMPILER’ and<br>     ‘LOG_FLAGS’ variables.</p>
<p>On the other hand, the exact semantics of how (and if) testsuite output<br>colorization, ‘XFAIL_TESTS’, and hard errors are supported and handled<br>is left to the individual test drivers.</p>
<h2 id="15-3-2-Declaring-Custom-Test-Drivers"><a href="#15-3-2-Declaring-Custom-Test-Drivers" class="headerlink" title="15.3.2 Declaring Custom Test Drivers"></a>15.3.2 Declaring Custom Test Drivers</h2><p>Custom testsuite drivers are declared by defining the make variables<br>‘LOG_DRIVER’ or ‘EXT_LOG_DRIVER’ (where EXT must be declared in<br>‘TEST_EXTENSIONS’).  They must be defined to programs or scripts that<br>will be used to drive the execution, logging, and outcome report of the<br>tests with corresponding extensions (or of those with no registered<br>extension in the case of ‘LOG_DRIVER’).  Clearly, multiple distinct test<br>drivers can be declared in the same ‘Makefile.am’.  Note moreover that<br>the ‘LOG_DRIVER’ variables are <em>not</em> a substitute for the ‘LOG_COMPILER’<br>variables: the two sets of variables can, and often do, usefully and<br>legitimately coexist.</p>
<p>   The developer-reserved variable ‘AM_LOG_DRIVER_FLAGS’ and the<br>user-reserved variable ‘LOG_DRIVER_FLAGS’ can be used to define flags<br>that will be passed to each invocation of ‘LOG_DRIVER’, with the<br>user-defined flags obviously taking precedence over the<br>developer-reserved ones.  Similarly, for each extension EXT declared in<br>‘TEST_EXTENSIONS’, flags listed in ‘AM_EXT_LOG_DRIVER_FLAGS’ and<br>‘EXT_LOG_DRIVER_FLAGS’ will be passed to invocations of<br>‘EXT_LOG_DRIVER’.</p>
<h2 id="15-3-3-API-for-Custom-Test-Drivers"><a href="#15-3-3-API-for-Custom-Test-Drivers" class="headerlink" title="15.3.3 API for Custom Test Drivers"></a>15.3.3 API for Custom Test Drivers</h2><p>Note that <em>the APIs described here are still highly experimental</em>, and<br>will very likely undergo tightenings and likely also extensive changes<br>in the future, to accommodate for 新特性 or to satisfy additional<br>portability requirements.</p>
<p>   The main characteristic of these APIs is that they are designed to<br>share as much infrastructure, semantics, and implementation details as<br>possible with the parallel test harness and its default driver.</p>
<p>15.3.3.1 Command-line arguments for test drivers<br>…………………………………………</p>
<p>A custom driver can rely on various command-line options and arguments<br>being passed to it automatically by the Automake-generated test harness.<br>It is <em>mandatory</em> that it understands all of them (even if the exact<br>interpretation of the associated semantics can legitimately change<br>between a test driver and another, and even be a no-op in some drivers).</p>
<p>Here is the list of options:</p>
<p>‘–test-name=NAME’<br>     The name of the test, with VPATH prefix (if any) removed.  This can<br>     have a suffix and a directory component (as in e.g.,<br>     ‘sub/foo.test’), and is mostly meant to be used in console reports<br>     about testsuite advancements and results (*note Testsuite progress<br>     output::).<br>‘–log-file=PATH.log’<br>     The ‘.log’ file the test driver must create (*note Basics of test<br>     metadata::).  If it has a directory component (as in e.g.,<br>     ‘sub/foo.log’), the test harness will ensure that such directory<br>     exists <em>before</em> the test driver is called.<br>‘–trs-file=PATH.trs’<br>     The ‘.trs’ file the test driver must create (*note Basics of test<br>     metadata::).  If it has a directory component (as in e.g.,<br>     ‘sub/foo.trs’), the test harness will ensure that such directory<br>     exists <em>before</em> the test driver is called.<br>‘–color-tests={yes|no}’<br>     Whether the console output should be colorized or not (*note Simple<br>     tests and color-tests::, to learn when this option gets activated<br>     and when it doesn’t).<br>‘–expect-failure={yes|no}’<br>     Whether the tested program is expected to fail.<br>‘–enable-hard-errors={yes|no}’<br>     Whether “hard errors” in the tested program should be treated<br>     differently from normal failures or not (the default should be<br>     ‘yes’).  The exact meaning of “hard error” is highly dependent from<br>     the test protocols or conventions in use.<br>‘–’<br>     Explicitly terminate the list of options.</p>
<p>The first non-option argument passed to the test driver is the program<br>to be run, and all the following ones are command-line options and<br>arguments for this program.</p>
<p>   Note that the exact semantics attached to the ‘–color-tests’,<br>‘–expect-failure’ and ‘–enable-hard-errors’ options are left up to the<br>individual test drivers.  Still, having a behaviour compatible or at<br>least similar to that provided by the default driver is advised, as that<br>would offer a better consistency and a more pleasant user experience.</p>
<p>15.3.3.2 Log files generation and test results recording<br>………………………………………………..</p>
<p>The test driver must correctly generate the files specified by the<br>‘–log-file’ and ‘–trs-file’ option (even when the tested program fails<br>or crashes).</p>
<p>   The ‘.log’ file should ideally contain all the output produced by the<br>tested program, plus optionally other information that might facilitate<br>debugging or analysis of bug reports.  Apart from that, its format is<br>basically free.</p>
<p>   The ‘.trs’ file is used to register some metadata through the use of<br>custom reStructuredText fields.  This metadata is expected to be<br>employed in various ways by the parallel test harness; for example, to<br>count the test results when printing the testsuite summary, or to decide<br>which tests to re-run upon ‘make recheck’.  Unrecognized metadata in a<br>‘.trs’ file is currently ignored by the harness, but this might change<br>in the future.  The list of currently recognized metadata follows.</p>
<p>‘:test-result:’<br>     The test driver must use this field to register the results of<br>     <em>each</em> test case run by a test script file.  Several<br>     ‘:test-result:’ fields can be present in the same ‘.trs’ file; this<br>     is done in order to support test protocols that allow a single test<br>     script to run more test cases.</p>
<pre><code> The only recognized test results are currently ‘PASS’, ‘XFAIL’,
 ‘SKIP’, ‘FAIL’, ‘XPASS’ and ‘ERROR’.  These results, when declared
 with ‘:test-result:’, can be optionally followed by text holding
 the name and/or a brief description of the corresponding test; the
 harness will ignore such extra text when generating
 ‘test-suite.log’ and preparing the testsuite summary.
</code></pre>
<p>‘:recheck:’<br>     If this field is present and defined to ‘no’, then the<br>     corresponding test script will <em>not</em> be run upon a ‘make recheck’.<br>     What happens when two or more ‘:recheck:’ fields are present in the<br>     same ‘.trs’ file is undefined behaviour.</p>
<p>‘:copy-in-global-log:’<br>     If this field is present and defined to ‘no’, then the content of<br>     the ‘.log’ file will <em>not</em> be copied into the global<br>     ‘test-suite.log’.  We allow to forsake such copying because, while<br>     it can be useful in debugging and analysis of bug report, it can<br>     also be just a waste of space in normal situations, e.g., when a<br>     test script is successful.  What happens when two or more<br>     ‘:copy-in-global-log:’ fields are present in the same ‘.trs’ file<br>     is undefined behaviour.</p>
<p>‘:test-global-result:’<br>     This is used to declare the “global result” of the script.<br>     Currently, the value of this field is needed only to be reported<br>     (more or less verbatim) in the generated global log file<br>     ‘$(TEST_SUITE_LOG)’, so it’s quite free-form.  For example, a test<br>     script which run 10 test cases, 6 of which pass and 4 of which are<br>     skipped, could reasonably have a ‘PASS/SKIP’ value for this field,<br>     while a test script which run 19 successful tests and one failed<br>     test could have an ‘ALMOST PASSED’ value.  What happens when two or<br>     more ‘:test-global-result:’ fields are present in the same ‘.trs’<br>     file is undefined behaviour.</p>
<p>Let’s see a small example.  Assume a ‘.trs’ file contains the following<br>lines:</p>
<pre><code> :test-result: PASS server starts
 :global-log-copy: no
 :test-result: PASS HTTP/1.1 request
 :test-result: FAIL HTTP/1.0 request
 :recheck: yes
 :test-result: SKIP HTTPS request (TLS library wasn't available)
 :test-result: PASS server stops
</code></pre>
<p>Then the corresponding test script will be re-run by ‘make check’, will<br>contribute with <em>five</em> test results to the testsuite summary (three of<br>these tests being successful, one failed, and one skipped), and the<br>content of the corresponding ‘.log’ file will <em>not</em> be copied in the<br>global log file ‘test-suite.log’.</p>
<p>15.3.3.3 Testsuite progress output<br>…………………………….</p>
<p>A custom test driver also has the task of displaying, on the standard<br>output, the test results as soon as they become available.  Depending on<br>the protocol in use, it can also display the reasons for failures and<br>skips, and, more generally, any useful diagnostic output (but remember<br>that each line on the screen is precious, so that cluttering the screen<br>with overly verbose information is bad idea).  The exact format of this<br>progress output is left up to the test driver; in fact, a custom test<br>driver might <em>theoretically</em> even decide not to do any such report,<br>leaving it all to the testsuite summary (that would be a very lousy<br>idea, of course, and serves only to illustrate the flexibility that is<br>granted here).</p>
<p>   Remember that consistency is good; so, if possible, try to be<br>consistent with the output of the built-in Automake test drivers,<br>providing a similar “look &amp; feel”.  In particular, the testsuite<br>progress output should be colorized when the ‘–color-tests’ is passed<br>to the driver.  On the other end, if you are using a known and<br>widespread test protocol with well-established implementations, being<br>consistent with those implementations’ output might be a good idea too.</p>
<h1 id="15-4-Using-the-TAP-test-protocol"><a href="#15-4-Using-the-TAP-test-protocol" class="headerlink" title="15.4 Using the TAP test protocol"></a>15.4 Using the TAP test protocol</h1><h2 id="15-4-1-Introduction-to-TAP"><a href="#15-4-1-Introduction-to-TAP" class="headerlink" title="15.4.1 Introduction to TAP"></a>15.4.1 Introduction to TAP</h2><p>TAP, the Test Anything Protocol, is a simple text-based interface<br>between testing modules or programs and a test harness.  The tests (also<br>called “TAP producers” in this context) write test results in a simple<br>format on standard output; a test harness (also called “TAP consumer”)<br>will parse and interpret these results, and properly present them to the<br>user, and/or register them for later analysis.  The exact details of how<br>this is accomplished can vary among different test harnesses.  The<br>Automake harness will present the results on the console in the usual<br>fashion (*note Testsuite progress on console::), and will use the ‘.trs’<br>files (*note Basics of test metadata::) to store the test results and<br>related metadata.  Apart from that, it will try to remain as much<br>compatible as possible with pre-existing and widespread utilities, such<br>as the ‘prove’ utility<br>(<a href="http://search.cpan.org/~andya/Test-Harness/bin/prove">http://search.cpan.org/~andya/Test-Harness/bin/prove</a>), at least for the<br>simpler usages.</p>
<p>   TAP started its life as part of the test harness for Perl, but today<br>it has been (mostly) standardized, and has various independent<br>implementations in different languages; among them, C, C++, Perl,<br>Python, PHP, and Java.  For a semi-official specification of the TAP<br>protocol, please refer to the documentation of ‘Test::Harness::TAP’<br>(<a href="http://search.cpan.org/~petdance/Test-Harness/lib/Test/Harness/TAP.pod">http://search.cpan.org/~petdance/Test-Harness/lib/Test/Harness/TAP.pod</a>).</p>
<p>   The most relevant real-world usages of TAP are obviously in the<br>testsuites of ‘perl’ and of many perl modules.  Still, also other<br>important third-party packages, such as ‘git’ (<a href="http://git-scm.com/">http://git-scm.com/</a>), use<br>TAP in their testsuite.</p>
<h2 id="15-4-2-Use-TAP-with-the-Automake-test-harness"><a href="#15-4-2-Use-TAP-with-the-Automake-test-harness" class="headerlink" title="15.4.2 Use TAP with the Automake test harness"></a>15.4.2 Use TAP with the Automake test harness</h2><p>Currently, the TAP driver that comes with Automake requires some by-hand<br>steps on the developer’s part (this situation should hopefully be<br>improved in future Automake versions).  You’ll have to grab the<br>‘tap-driver.sh’ script from the Automake distribution by hand, copy it<br>in your source tree, and use the Automake support for third-party test<br>drivers to instruct the harness to use the ‘tap-driver.sh’ script and<br>the awk program found by ‘AM_INIT_AUTOMAKE’ to run your TAP-producing<br>tests.  See the example below for clarification.</p>
<p>   Apart from the options common to all the Automake test drivers (*note<br>Command-line arguments for test drivers::), the ‘tap-driver.sh’ supports<br>the following options, whose names are chosen for enhanced compatibility<br>with the ‘prove’ utility.</p>
<p>‘–ignore-exit’<br>     Causes the test driver to ignore the exit status of the test<br>     scripts; by default, the driver will report an error if the script<br>     exits with a non-zero status.  This option has effect also on<br>     non-zero exit statuses due to termination by a signal.<br>‘–comments’<br>     Instruct the test driver to display TAP diagnostic (i.e., lines<br>     beginning with the ‘#’ character) in the testsuite progress output<br>     too; by default, TAP diagnostic is only copied to the ‘.log’ file.<br>‘–no-comments’<br>     Revert the effects of ‘–comments’.<br>‘–merge’<br>     Instruct the test driver to merge the test scripts’ standard error<br>     into their standard output.  This is necessary if you want to<br>     ensure that diagnostics from the test scripts are displayed in the<br>     correct order relative to test results; this can be of great help<br>     in debugging (especially if your test scripts are shell scripts run<br>     with shell tracing active).  As a downside, this option might cause<br>     the test harness to get confused if anything that appears on<br>     standard error looks like a test result.<br>‘–no-merge’<br>     Revert the effects of ‘–merge’.<br>‘–diagnostic-string=STRING’<br>     Change the string that introduces TAP diagnostic from the default<br>     value of “‘#’” to ‘STRING’.  This can be useful if your TAP-based<br>     test scripts produce verbose output on which they have limited<br>     control (because, say, the output comes from other tools invoked in<br>     the scripts), and it might contain text that gets spuriously<br>     interpreted as TAP diagnostic: such an issue can be solved by<br>     redefining the string that activates TAP diagnostic to a value you<br>     know won’t appear by chance in the tests’ output.  Note however<br>     that this feature is non-standard, as the “official” TAP protocol<br>     does not allow for such a customization; so don’t use it if you can<br>     avoid it.</p>
<p>Here is an example of how the TAP driver can be set up and used.</p>
<pre><code> % cat configure.ac
 AC_INIT([GNU Try Tap], [1.0], [bug-automake@gnu.org])
 AC_CONFIG_AUX_DIR([build-aux])
 AM_INIT_AUTOMAKE([foreign -Wall -Werror])
 AC_CONFIG_FILES([Makefile])
 AC_REQUIRE_AUX_FILE([tap-driver.sh])
 AC_OUTPUT

 % cat Makefile.am
 TEST_LOG_DRIVER = env AM_TAP_AWK='$(AWK)' $(SHELL) \
                   $(top_srcdir)/build-aux/tap-driver.sh
 TESTS = foo.test bar.test baz.test
 EXTRA_DIST = $(TESTS)

 % cat foo.test
 #!/bin/sh
 echo 1..4 # Number of tests to be executed.
 echo 'ok 1 - Swallows fly'
 echo 'not ok 2 - Caterpillars fly # TODO metamorphosis in progress'
 echo 'ok 3 - Pigs fly # SKIP not enough acid'
 echo '# I just love word plays ...'
 echo 'ok 4 - Flies fly too :-)'

 % cat bar.test
 #!/bin/sh
 echo 1..3
 echo 'not ok 1 - Bummer, this test has failed.'
 echo 'ok 2 - This passed though.'
 echo 'Bail out! Ennui kicking in, sorry...'
 echo 'ok 3 - This will not be seen.'

 % cat baz.test
 #!/bin/sh
 echo 1..1
 echo ok 1
 # Exit with error, even if all the tests have been successful.
 exit 7

 % cp PREFIX/share/automake-APIVERSION/tap-driver.sh .
 % autoreconf -vi &amp;&amp; ./configure &amp;&amp; make check
 ...
 PASS: foo.test 1 - Swallows fly
 XFAIL: foo.test 2 - Caterpillars fly # TODO metamorphosis in progress
 SKIP: foo.test 3 - Pigs fly # SKIP not enough acid
 PASS: foo.test 4 - Flies fly too :-)
 FAIL: bar.test 1 - Bummer, this test has failed.
 PASS: bar.test 2 - This passed though.
 ERROR: bar.test - Bail out! Ennui kicking in, sorry...
 PASS: baz.test 1
 ERROR: baz.test - exited with status 7
 ...
 Please report to bug-automake@gnu.org
 ...
 % echo exit status: $?
 exit status: 1

 % env TEST_LOG_DRIVER_FLAGS='--comments --ignore-exit' \
       TESTS='foo.test baz.test' make -e check
 ...
 PASS: foo.test 1 - Swallows fly
 XFAIL: foo.test 2 - Caterpillars fly # TODO metamorphosis in progress
 SKIP: foo.test 3 - Pigs fly # SKIP not enough acid
 # foo.test: I just love word plays...
 PASS: foo.test 4 - Flies fly too :-)
 PASS: baz.test 1
 ...
 % echo exit status: $?
 exit status: 0
</code></pre>
<h2 id="15-4-3-Incompatibilities-with-other-TAP-parsers-and-drivers"><a href="#15-4-3-Incompatibilities-with-other-TAP-parsers-and-drivers" class="headerlink" title="15.4.3 Incompatibilities with other TAP parsers and drivers"></a>15.4.3 Incompatibilities with other TAP parsers and drivers</h2><p>For implementation or historical reasons, the TAP driver and harness as<br>implemented by Automake have some minors incompatibilities with the<br>mainstream versions, which you should be aware of.</p>
<p>   • A ‘Bail out!’ directive doesn’t stop the whole testsuite, but only<br>     the test script it occurs in.  This doesn’t follow TAP<br>     specifications, but on the other hand it maximizes compatibility<br>     (and code sharing) with the “hard error” concept of the default<br>     testsuite driver.<br>   • The ‘version’ and ‘pragma’ directives are not supported.<br>   • The ‘–diagnostic-string’ option of our driver allows to modify the<br>     string that introduces TAP diagnostic from the default value of<br>     “‘#’”.  The standard TAP protocol has currently no way to allow<br>     this, so if you use it your diagnostic will be lost to more<br>     compliant tools like ‘prove’ and ‘Test::Harness’<br>   • And there are probably some other small and yet undiscovered<br>     incompatibilities, especially in corner cases or with rare usages.</p>
<h2 id="15-4-4-Links-and-external-resources-on-TAP"><a href="#15-4-4-Links-and-external-resources-on-TAP" class="headerlink" title="15.4.4 Links and external resources on TAP"></a>15.4.4 Links and external resources on TAP</h2><p>Here are some links to more extensive official or third-party<br>documentation and resources about the TAP protocol and related tools and<br>libraries.<br>   •  ‘Test::Harness::TAP’<br>     (<a href="http://search.cpan.org/~petdance/Test-Harness/lib/Test/Harness/TAP.pod">http://search.cpan.org/~petdance/Test-Harness/lib/Test/Harness/TAP.pod</a>),<br>     the (mostly) official documentation about the TAP format and<br>     protocol.<br>   •  ‘prove’ (<a href="http://search.cpan.org/~andya/Test-Harness/bin/prove">http://search.cpan.org/~andya/Test-Harness/bin/prove</a>),<br>     the most famous command-line TAP test driver, included in the<br>     distribution of ‘perl’ and ‘Test::Harness’<br>     (<a href="http://search.cpan.org/~andya/Test-Harness/lib/Test/Harness.pm">http://search.cpan.org/~andya/Test-Harness/lib/Test/Harness.pm</a>).<br>   • The TAP wiki (<a href="http://testanything.org/wiki/index.php/Main_Page">http://testanything.org/wiki/index.php/Main_Page</a>).<br>   • A “gentle introduction” to testing for perl coders:<br>     ‘Test::Tutorial’<br>     (<a href="http://search.cpan.org/dist/Test-Simple/lib/Test/Tutorial.pod">http://search.cpan.org/dist/Test-Simple/lib/Test/Tutorial.pod</a>).<br>   •  ‘Test::Simple’<br>     (<a href="http://search.cpan.org/~mschwern/Test-Simple/lib/Test/Simple.pm">http://search.cpan.org/~mschwern/Test-Simple/lib/Test/Simple.pm</a>)<br>     and ‘Test::More’<br>     (<a href="http://search.cpan.org/~mschwern/Test-Simple/lib/Test/More.pm">http://search.cpan.org/~mschwern/Test-Simple/lib/Test/More.pm</a>),<br>     the standard perl testing libraries, which are based on TAP.<br>   • C TAP Harness<br>     (<a href="http://www.eyrie.org/~eagle/software/c-tap-harness/">http://www.eyrie.org/~eagle/software/c-tap-harness/</a>), a C-based<br>     project implementing both a TAP producer and a TAP consumer.<br>   • tap4j (<a href="http://www.tap4j.org/">http://www.tap4j.org/</a>), a Java-based project implementing<br>     both a TAP producer and a TAP consumer.</p>
<h1 id="15-5-DejaGnu-Tests"><a href="#15-5-DejaGnu-Tests" class="headerlink" title="15.5 DejaGnu Tests"></a>15.5 DejaGnu Tests</h1><p>If ‘dejagnu’ (<a href="https://ftp.gnu.org/gnu/dejagnu/">https://ftp.gnu.org/gnu/dejagnu/</a>) appears in<br>‘AUTOMAKE_OPTIONS’, then a ‘dejagnu’-based test suite is assumed.  The<br>variable ‘DEJATOOL’ is a list of names that are passed, one at a time,<br>as the ‘–tool’ argument to ‘runtest’ invocations; it defaults to the<br>name of the package.</p>
<p>   The variable ‘RUNTESTDEFAULTFLAGS’ holds the ‘–tool’ and ‘–srcdir’<br>flags that are passed to dejagnu by default; this can be overridden if<br>necessary.</p>
<p>   The variables ‘EXPECT’ and ‘RUNTEST’ can also be overridden to<br>provide project-specific values.  For instance, you will need to do this<br>if you are testing a compiler toolchain, because the default values do<br>not take into account host and target names.</p>
<p>   The contents of the variable ‘RUNTESTFLAGS’ are passed to the<br>‘runtest’ invocation.  This is considered a “user variable” (*note User<br>Variables::).  If you need to set ‘runtest’ flags in ‘Makefile.am’, you<br>can use ‘AM_RUNTESTFLAGS’ instead.</p>
<p>   Automake will generate rules to create a local ‘site.exp’ file,<br>defining various variables detected by ‘configure’.  This file is<br>automatically read by DejaGnu.  It is OK for the user of a package to<br>edit this file in order to tune the test suite.  However this is not the<br>place where the test suite author should define new variables: this<br>should be done elsewhere in the real test suite code.  Especially,<br>‘site.exp’ should not be distributed.</p>
<p>   Still, if the package author has legitimate reasons to extend<br>‘site.exp’ at ‘make’ time, he can do so by defining the variable<br>‘EXTRA_DEJAGNU_SITE_CONFIG’; the files listed there will be considered<br>‘site.exp’ prerequisites, and their content will be appended to it (in<br>the same order in which they appear in ‘EXTRA_DEJAGNU_SITE_CONFIG’).<br>Note that files are <em>not</em> distributed by default.</p>
<p>   For more information regarding DejaGnu test suites, see *note<br>(dejagnu)Top::.</p>
<h1 id="15-6-Install-Tests"><a href="#15-6-Install-Tests" class="headerlink" title="15.6 Install Tests"></a>15.6 Install Tests</h1><p>The ‘installcheck’ target is available to the user as a way to run any<br>tests after the package has been installed.  You can add tests to this<br>by writing an ‘installcheck-local’ rule.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2018/03/20/linux-automake-8-building-programs-and-libraries/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/20/linux-automake-8-building-programs-and-libraries/" class="post-title-link" itemprop="url">Linux Automake 8 编译程序和库</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-20 22:28:00" itemprop="dateCreated datePublished" datetime="2018-03-20T22:28:00+08:00">2018-03-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/Automake/" itemprop="url" rel="index"><span itemprop="name">Automake</span></a>
                </span>
            </span>

          
            <span id="/2018/03/20/linux-automake-8-building-programs-and-libraries/" class="post-meta-item leancloud_visitors" data-flag-title="Linux Automake 8 编译程序和库" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/03/20/linux-automake-8-building-programs-and-libraries/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/03/20/linux-automake-8-building-programs-and-libraries/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/03/20/linux-automake-8-building-programs-and-libraries/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/03/20/linux-automake-8-building-programs-and-libraries/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>GNU Automake 版本(version 1.16.1, 26 February 2018)</p>
<p>Permission is granted to copy, distribute and/or modify this<br>document under the terms of the GNU Free Documentation License,<br>Version 1.3 or any later version published by the Free Software<br>Foundation; with no Invariant Sections, with no Front-Cover texts,<br>and with no Back-Cover Texts.  A copy of the license is included in<br>the section entitled “GNU Free Documentation License.”</p>
</blockquote>
<h1 id="8-Building-Programs-and-Libraries"><a href="#8-Building-Programs-and-Libraries" class="headerlink" title="8 Building Programs and Libraries"></a>8 Building Programs and Libraries</h1><hr>
<p>A large part of Automake functionality is dedicated to making it easy<br>to build programs and libraries.</p>
<h2 id="8-1-Building-a-program"><a href="#8-1-Building-a-program" class="headerlink" title="8.1 Building a program"></a>8.1 Building a program</h2><p>======================</p>
<p>为了编译一个程序，你需要告诉Automake需要哪些源码，需要链接哪些库。</p>
<h3 id="8-1-1-Defining-program-sources"><a href="#8-1-1-Defining-program-sources" class="headerlink" title="8.1.1 Defining program sources"></a>8.1.1 Defining program sources</h3><hr>
<p>In a directory containing source that gets built into a program (as<br>opposed to a library or a script), the <code>PROGRAMS</code> primary is used.<br>Programs can be installed in <code>bindir</code>, <code>sbindir</code>, <code>libexecdir</code>,<br><code>pkglibexecdir</code>, or not at all (<code>noinst_</code>).  They can also be built only<br>for <code>make check</code>, in which case the prefix is <code>check_</code>.</p>
<p>   For instance:</p>
<pre><code> bin_PROGRAMS = hello
</code></pre>
<p>   In this simple case, the resulting <code>Makefile.in</code> will contain code to<br>generate a program named <code>hello</code>.</p>
<p>   Associated with each program are several assisting variables that are<br>named after the program.  These variables are all optional, and have<br>reasonable defaults.  Each variable, its use, and default is spelled out<br>below; we use the “hello” example throughout.</p>
<p>   The variable <code>hello_SOURCES</code> is used to specify which source files<br>get built into an executable:</p>
<pre><code> hello_SOURCES = hello.c version.c getopt.c getopt1.c getopt.h system.h
</code></pre>
<p>   This causes each mentioned <code>.c</code> file to be compiled into the<br>corresponding <code>.o</code>.  Then all are linked to produce <code>hello</code>.</p>
<p>   If <code>hello_SOURCES</code> is not specified, then it defaults to the single<br>file <code>hello.c</code></p>
<p>   Multiple programs can be built in a single directory.  Multiple<br>programs can share a single source file, which must be listed in each<br><code>_SOURCES</code> definition.</p>
<p>   Header files listed in a <code>_SOURCES</code> definition will be included in<br>the distribution but otherwise ignored.  In case it isn<code>t obvious, you should not include the header file generated by </code>configure<code>in a</code>_SOURCES<code> variable; this file should not be distributed.  Lex (</code>.l<code>) and Yacc (</code>.y`) files can also be listed; see *note Yacc and Lex::.</p>
<h3 id="8-1-2-Linking-the-program"><a href="#8-1-2-Linking-the-program" class="headerlink" title="8.1.2 Linking the program"></a>8.1.2 Linking the program</h3><hr>
<p>如果希望链接 <code>configure</code>文件中没有的库，可以使用 <code>LDADD</code> 搞定。这个变量用于指定链接的目标文件或者库，如果希望再指定一些参数，可以使用 <code>AM_LDFLAGS</code> 。</p>
<p>   Sometimes, multiple programs are built in one directory but do not<br>share the same link-time requirements.  In this case, you can use the<br><code>PROG_LDADD</code> variable (where PROG is the name of the program as it<br>appears in some <code>_PROGRAMS</code> variable, and usually written in lowercase)<br>to override <code>LDADD</code>.  If this variable exists for a given program, then<br>that program is not linked using <code>LDADD</code>.</p>
<p>   For instance, in GNU cpio, <code>pax</code>, <code>cpio</code> and <code>mt</code> are linked against<br>the library <code>libcpio.a</code>.  However, <code>rmt</code> is built in the same directory,<br>and has no such link requirement.  Also, <code>mt</code> and <code>rmt</code> are only built<br>on certain architectures.  Here is what cpio<code>s </code>src/Makefile.am` looks<br>like (abridged):</p>
<pre><code> bin_PROGRAMS = cpio pax $(MT)
 libexec_PROGRAMS = $(RMT)
 EXTRA_PROGRAMS = mt rmt

 LDADD = ../lib/libcpio.a $(INTLLIBS)
 rmt_LDADD =

 cpio_SOURCES = ...
 pax_SOURCES = ...
 mt_SOURCES = ...
 rmt_SOURCES = ...
</code></pre>
<p>   <code>PROG_LDADD</code> is inappropriate for passing program-specific linker<br>flags (except for <code>-l</code>, <code>-L</code>, <code>-dlopen</code> and <code>-dlpreopen</code>).  So, use the<br><code>PROG_LDFLAGS</code> variable for this purpose.</p>
<p>   It is also occasionally useful to have a program depend on some other<br>target that is not actually part of that program.  This can be done<br>using either the <code>PROG_DEPENDENCIES</code> or the <code>EXTRA_PROG_DEPENDENCIES</code><br>variable.  Each program depends on the contents both variables, but no<br>further interpretation is done.</p>
<p>   Since these dependencies are associated to the link rule used to<br>create the programs they should normally list files used by the link<br>command.  That is <code>*.$(OBJEXT)</code>, <code>*.a</code>, or <code>*.la</code> files.  In rare cases<br>you may need to add other kinds of files such as linker scripts, but<br><em>listing a source file in <code>_DEPENDENCIES</code> is wrong</em>.  If some source<br>file needs to be built before all the components of a program are built,<br>consider using the <code>BUILT_SOURCES</code> variable instead (*note Sources::).</p>
<p>   If <code>PROG_DEPENDENCIES</code> is not supplied, it is computed by Automake.<br>The automatically-assigned value is the contents of <code>PROG_LDADD</code>, with<br>most configure substitutions, <code>-l</code>, <code>-L</code>, <code>-dlopen</code> and <code>-dlpreopen</code><br>options removed.  The configure substitutions that are left in are only<br><code>$(LIBOBJS)</code> and <code>$(ALLOCA)</code>; these are left because it is known that<br>they will not cause an invalid value for <code>PROG_DEPENDENCIES</code> to be<br>generated.</p>
<p>  The <code>EXTRA_PROG_DEPENDENCIES</code> may be useful for cases where you<br>merely want to augment the <code>automake</code>-generated <code>PROG_DEPENDENCIES</code><br>rather than replacing it.</p>
<p>   We recommend that you avoid using <code>-l</code> options in <code>LDADD</code> or<br><code>PROG_LDADD</code> when referring to libraries built by your package.<br>Instead, write the file name of the library explicitly as in the above<br><code>cpio</code> example.  Use <code>-l</code> only to list third-party libraries.  If you<br>follow this rule, the default value of <code>PROG_DEPENDENCIES</code> will list all<br>your local libraries and omit the other ones.</p>
<h3 id="8-1-3-Conditional-compilation-of-sources"><a href="#8-1-3-Conditional-compilation-of-sources" class="headerlink" title="8.1.3 Conditional compilation of sources"></a>8.1.3 Conditional compilation of sources</h3><hr>
<p>You can<code>t put a configure substitution (e.g., </code>@FOO@<code>or</code>$(FOO)<code>where</code>FOO<code>is defined via</code>AC_SUBST<code>) into a </code>_SOURCES<code> variable.  The reason for this is a bit hard to explain, but suffice to say that it simply won</code>t work.  Automake will give an error if you try to do this.</p>
<p>   Fortunately there are two other ways to achieve the same result.  One<br>is to use configure substitutions in <code>_LDADD</code> variables, the other is to<br>use an Automake conditional.</p>
<p>Conditional Compilation using <code>_LDADD</code> Substitutions<br>…………………………………………….</p>
<p>Automake must know all the source files that could possibly go into a<br>program, even if not all the files are built in every circumstance.  Any<br>files that are only conditionally built should be listed in the<br>appropriate <code>EXTRA_</code> variable.  For instance, if <code>hello-linux.c</code> or<br><code>hello-generic.c</code> were conditionally included in <code>hello</code>, the<br><code>Makefile.am</code> would contain:</p>
<pre><code> bin_PROGRAMS = hello
 hello_SOURCES = hello-common.c
 EXTRA_hello_SOURCES = hello-linux.c hello-generic.c
 hello_LDADD = $(HELLO_SYSTEM)
 hello_DEPENDENCIES = $(HELLO_SYSTEM)
</code></pre>
<p>You can then setup the <code>$(HELLO_SYSTEM)</code> substitution from<br><code>configure.ac</code>:</p>
<pre><code> ...
 case $host in
   *linux*) HELLO_SYSTEM='hello-linux.$(OBJEXT)' ;;
   *)       HELLO_SYSTEM='hello-generic.$(OBJEXT)' ;;
 esac
 AC_SUBST([HELLO_SYSTEM])
 ...
</code></pre>
<p>   In this case, the variable <code>HELLO_SYSTEM</code> should be replaced by<br>either <code>hello-linux.o</code> or <code>hello-generic.o</code>, and added to both<br><code>hello_DEPENDENCIES</code> and <code>hello_LDADD</code> in order to be built and linked<br>in.</p>
<p>Conditional Compilation using Automake Conditionals<br>……………………………………………</p>
<p>An often simpler way to compile source files conditionally is to use<br>Automake conditionals.  For instance, you could use this <code>Makefile.am</code><br>construct to build the same <code>hello</code> example:</p>
<pre><code> bin_PROGRAMS = hello
 if LINUX
 hello_SOURCES = hello-linux.c hello-common.c
 else
 hello_SOURCES = hello-generic.c hello-common.c
 endif
</code></pre>
<p>   In this case, <code>configure.ac</code> should setup the <code>LINUX</code> conditional<br>using <code>AM_CONDITIONAL</code> (*note Conditionals::).</p>
<p>   When using conditionals like this you don<code>t need to use the </code>EXTRA_`<br>variable, because Automake will examine the contents of each variable to<br>construct the complete list of source files.</p>
<p>   If your program uses a lot of files, you will probably prefer a<br>conditional <code>+=</code>.</p>
<pre><code> bin_PROGRAMS = hello
 hello_SOURCES = hello-common.c
 if LINUX
 hello_SOURCES += hello-linux.c
 else
 hello_SOURCES += hello-generic.c
 endif
</code></pre>
<h3 id="8-1-4-Conditional-compilation-of-programs"><a href="#8-1-4-Conditional-compilation-of-programs" class="headerlink" title="8.1.4 Conditional compilation of programs"></a>8.1.4 Conditional compilation of programs</h3><hr>
<p>Sometimes it is useful to determine the programs that are to be built at<br>configure time.  For instance, GNU <code>cpio</code> only builds <code>mt</code> and <code>rmt</code><br>under special circumstances.  The means to achieve conditional<br>compilation of programs are the same you can use to compile source files<br>conditionally: substitutions or conditionals.</p>
<p>Conditional Programs using <code>configure</code> Substitutions<br>…………………………………………….</p>
<p>In this case, you must notify Automake of all the programs that can<br>possibly be built, but at the same time cause the generated<br><code>Makefile.in</code> to use the programs specified by <code>configure</code>.  This is<br>done by having <code>configure</code> substitute values into each <code>_PROGRAMS</code><br>definition, while listing all optionally built programs in<br><code>EXTRA_PROGRAMS</code>.</p>
<pre><code> bin_PROGRAMS = cpio pax $(MT)
 libexec_PROGRAMS = $(RMT)
 EXTRA_PROGRAMS = mt rmt
</code></pre>
<p>   As explained in *note EXEEXT::, Automake will rewrite <code>bin_PROGRAMS</code>,<br><code>libexec_PROGRAMS</code>, and <code>EXTRA_PROGRAMS</code>, appending <code>$(EXEEXT)</code> to each<br>binary.  Obviously it cannot rewrite values obtained at run-time through<br><code>configure</code> substitutions, therefore you should take care of appending<br><code>$(EXEEXT)</code> yourself, as in <code>AC_SUBST([MT], ['mt${EXEEXT}'])</code>.</p>
<p>Conditional Programs using Automake Conditionals<br>…………………………………………</p>
<p>You can also use Automake conditionals (*note Conditionals::) to select<br>programs to be built.  In this case you don<code>t have to worry about </code>$(EXEEXT)<code>or</code>EXTRA_PROGRAMS`.</p>
<pre><code> bin_PROGRAMS = cpio pax
 if WANT_MT
   bin_PROGRAMS += mt
 endif
 if WANT_RMT
   libexec_PROGRAMS = rmt
 endif
</code></pre>
<h2 id="8-2-Building-a-library"><a href="#8-2-Building-a-library" class="headerlink" title="8.2 Building a library"></a>8.2 Building a library</h2><p>======================</p>
<p>Building a library is much like building a program.  In this case, the<br>name of the primary is <code>LIBRARIES</code>.  Libraries can be installed in<br><code>libdir</code> or <code>pkglibdir</code>.</p>
<p>   *Note A Shared Library::, for information on how to build shared<br>libraries using libtool and the <code>LTLIBRARIES</code> primary.</p>
<p>   Each <code>_LIBRARIES</code> variable is a list of the libraries to be built.<br>For instance, to create a library named <code>libcpio.a</code>, but not install it,<br>you would write:</p>
<pre><code> noinst_LIBRARIES = libcpio.a
 libcpio_a_SOURCES = ...
</code></pre>
<p>   The sources that go into a library are determined exactly as they are<br>for programs, via the <code>_SOURCES</code> variables.  Note that the library name<br>is canonicalized (*note Canonicalization::), so the <code>_SOURCES</code> variable<br>corresponding to <code>libcpio.a</code> is <code>libcpio_a_SOURCES</code>, not<br><code>libcpio.a_SOURCES</code>.</p>
<p>   Extra objects can be added to a library using the <code>LIBRARY_LIBADD</code><br>variable.  This should be used for objects determined by <code>configure</code>.<br>Again from <code>cpio</code>:</p>
<pre><code> libcpio_a_LIBADD = $(LIBOBJS) $(ALLOCA)
</code></pre>
<p>   In addition, sources for extra objects that will not exist until<br>configure-time must be added to the <code>BUILT_SOURCES</code> variable (*note<br>Sources::).</p>
<p>   Building a static library is done by compiling all object files, then<br>by invoking <code>$(AR) $(ARFLAGS)</code> followed by the name of the library and<br>the list of objects, and finally by calling <code>$(RANLIB)</code> on that library.<br>You should call <code>AC_PROG_RANLIB</code> from your <code>configure.ac</code> to define<br><code>RANLIB</code> (Automake will complain otherwise).  You should also call<br><code>AM_PROG_AR</code> to define <code>AR</code>, in order to support unusual archivers such<br>as Microsoft lib.  <code>ARFLAGS</code> will default to <code>cru</code>; you can override<br>this variable by setting it in your <code>Makefile.am</code> or by <code>AC_SUBST</code>ing it<br>from your <code>configure.ac</code>.  You can override the <code>AR</code> variable by<br>defining a per-library <code>maude_AR</code> variable (*note Program and Library<br>Variables::).</p>
<p>   Be careful when selecting library components conditionally.  Because<br>building an empty library is not portable, you should ensure that any<br>library always contains at least one object.</p>
<p>   To use a static library when building a program, add it to <code>LDADD</code><br>for this program.  In the following example, the program <code>cpio</code> is<br>statically linked with the library <code>libcpio.a</code>.</p>
<pre><code> noinst_LIBRARIES = libcpio.a
 libcpio_a_SOURCES = ...

 bin_PROGRAMS = cpio
 cpio_SOURCES = cpio.c ...
 cpio_LDADD = libcpio.a
</code></pre>
<h2 id="8-3-Building-a-Shared-Library"><a href="#8-3-Building-a-Shared-Library" class="headerlink" title="8.3 Building a Shared Library"></a>8.3 Building a Shared Library</h2><p>=============================</p>
<p>Building shared libraries portably is a relatively complex matter.  For<br>this reason, GNU Libtool (*note Introduction: (libtool)Top.) was created<br>to help build shared libraries in a platform-independent way.</p>
<h3 id="8-3-1-The-Libtool-Concept"><a href="#8-3-1-The-Libtool-Concept" class="headerlink" title="8.3.1 The Libtool Concept"></a>8.3.1 The Libtool Concept</h3><hr>
<p>Libtool abstracts shared and static libraries into a unified concept<br>henceforth called “libtool libraries”.  Libtool libraries are files<br>using the <code>.la</code> suffix, and can designate a static library, a shared<br>library, or maybe both.  Their exact nature cannot be determined until<br><code>./configure</code> is run: not all platforms support all kinds of libraries,<br>and users can explicitly select which libraries should be built.<br>(However the package<code>s maintainers can tune the default, *note The </code>AC_PROG_LIBTOOL` macro: (libtool)AC_PROG_LIBTOOL.)</p>
<p>   Because object files for shared and static libraries must be compiled<br>differently, libtool is also used during compilation.  Object files<br>built by libtool are called “libtool objects”: these are files using the<br><code>.lo</code> suffix.  Libtool libraries are built from these libtool objects.</p>
<p>   You should not assume anything about the structure of <code>.la</code> or <code>.lo</code><br>files and how libtool constructs them: this is libtool<code>s concern, and the last thing one wants is to learn about libtool</code>s guts.  However the<br>existence of these files matters, because they are used as targets and<br>dependencies in <code>Makefile</code>s rules when building libtool libraries.<br>There are situations where you may have to refer to these, for instance<br>when expressing dependencies for building source files conditionally<br>(*note Conditional Libtool Sources::).</p>
<p>   People considering writing a plug-in system, with dynamically loaded<br>modules, should look into <code>libltdl</code>: libtool`s dlopening library (*note<br>Using libltdl: (libtool)Using libltdl.).  This offers a portable<br>dlopening facility to load libtool libraries dynamically, and can also<br>achieve static linking where unavoidable.</p>
<p>   Before we discuss how to use libtool with Automake in details, it<br>should be noted that the libtool manual also has a section about how to<br>use Automake with libtool (*note Using Automake with Libtool:<br>(libtool)Using Automake.).</p>
<h3 id="8-3-2-Building-Libtool-Libraries"><a href="#8-3-2-Building-Libtool-Libraries" class="headerlink" title="8.3.2 Building Libtool Libraries"></a>8.3.2 Building Libtool Libraries</h3><hr>
<p>Automake uses libtool to build libraries declared with the <code>LTLIBRARIES</code><br>primary.  Each <code>_LTLIBRARIES</code> variable is a list of libtool libraries to<br>build.  For instance, to create a libtool library named <code>libgettext.la</code>,<br>and install it in <code>libdir</code>, write:</p>
<pre><code> lib_LTLIBRARIES = libgettext.la
 libgettext_la_SOURCES = gettext.c gettext.h ...
</code></pre>
<p>   Automake predefines the variable <code>pkglibdir</code>, so you can use<br><code>pkglib_LTLIBRARIES</code> to install libraries in <code>$(libdir)/@PACKAGE@/</code>.</p>
<p>   If <code>gettext.h</code> is a public header file that needs to be installed in<br>order for people to use the library, it should be declared using a<br><code>_HEADERS</code> variable, not in <code>libgettext_la_SOURCES</code>.  Headers listed in<br>the latter should be internal headers that are not part of the public<br>interface.</p>
<pre><code> lib_LTLIBRARIES = libgettext.la
 libgettext_la_SOURCES = gettext.c ...
 include_HEADERS = gettext.h ...
</code></pre>
<p>   A package can build and install such a library along with other<br>programs that use it.  This dependency should be specified using<br><code>LDADD</code>.  The following example builds a program named <code>hello</code> that is<br>linked with <code>libgettext.la</code>.</p>
<pre><code> lib_LTLIBRARIES = libgettext.la
 libgettext_la_SOURCES = gettext.c ...

 bin_PROGRAMS = hello
 hello_SOURCES = hello.c ...
 hello_LDADD = libgettext.la
</code></pre>
<p>Whether <code>hello</code> is statically or dynamically linked with <code>libgettext.la</code><br>is not yet known: this will depend on the configuration of libtool and<br>the capabilities of the host.</p>
<h3 id="8-3-3-Building-Libtool-Libraries-Conditionally"><a href="#8-3-3-Building-Libtool-Libraries-Conditionally" class="headerlink" title="8.3.3 Building Libtool Libraries Conditionally"></a>8.3.3 Building Libtool Libraries Conditionally</h3><hr>
<p>Like conditional programs (*note Conditional Programs::), there are two<br>main ways to build conditional libraries: using Automake conditionals or<br>using Autoconf <code>AC_SUBST</code>itutions.</p>
<p>   The important implementation detail you have to be aware of is that<br>the place where a library will be installed matters to libtool: it needs<br>to be indicated <em>at link-time</em> using the <code>-rpath</code> option.</p>
<p>   For libraries whose destination directory is known when Automake<br>runs, Automake will automatically supply the appropriate <code>-rpath</code> option<br>to libtool.  This is the case for libraries listed explicitly in some<br>installable <code>_LTLIBRARIES</code> variables such as <code>lib_LTLIBRARIES</code>.</p>
<p>   However, for libraries determined at configure time (and thus<br>mentioned in <code>EXTRA_LTLIBRARIES</code>), Automake does not know the final<br>installation directory.  For such libraries you must add the <code>-rpath</code><br>option to the appropriate <code>_LDFLAGS</code> variable by hand.</p>
<p>   The examples below illustrate the differences between these two<br>methods.</p>
<p>   Here is an example where <code>WANTEDLIBS</code> is an <code>AC_SUBST</code>ed variable set<br>at <code>./configure</code>-time to either <code>libfoo.la</code>, <code>libbar.la</code>, both, or none.<br>Although <code>$(WANTEDLIBS)</code> appears in the <code>lib_LTLIBRARIES</code>, Automake<br>cannot guess it relates to <code>libfoo.la</code> or <code>libbar.la</code> at the time it<br>creates the link rule for these two libraries.  Therefore the <code>-rpath</code><br>argument must be explicitly supplied.</p>
<pre><code> EXTRA_LTLIBRARIES = libfoo.la libbar.la
 lib_LTLIBRARIES = $(WANTEDLIBS)
 libfoo_la_SOURCES = foo.c ...
 libfoo_la_LDFLAGS = -rpath '$(libdir)'
 libbar_la_SOURCES = bar.c ...
 libbar_la_LDFLAGS = -rpath '$(libdir)'
</code></pre>
<p>   Here is how the same <code>Makefile.am</code> would look using Automake<br>conditionals named <code>WANT_LIBFOO</code> and <code>WANT_LIBBAR</code>.  Now Automake is<br>able to compute the <code>-rpath</code> setting itself, because it<code>s clear that both libraries will end up in </code>$(libdir)` if they are installed.</p>
<pre><code> lib_LTLIBRARIES =
 if WANT_LIBFOO
 lib_LTLIBRARIES += libfoo.la
 endif
 if WANT_LIBBAR
 lib_LTLIBRARIES += libbar.la
 endif
 libfoo_la_SOURCES = foo.c ...
 libbar_la_SOURCES = bar.c ...
</code></pre>
<h3 id="8-3-4-Libtool-Libraries-with-Conditional-Sources"><a href="#8-3-4-Libtool-Libraries-with-Conditional-Sources" class="headerlink" title="8.3.4 Libtool Libraries with Conditional Sources"></a>8.3.4 Libtool Libraries with Conditional Sources</h3><hr>
<p>Conditional compilation of sources in a library can be achieved in the<br>same way as conditional compilation of sources in a program (*note<br>Conditional Sources::).  The only difference is that <code>_LIBADD</code> should be<br>used instead of <code>_LDADD</code> and that it should mention libtool objects<br>(<code>.lo</code> files).</p>
<p>   So, to mimic the <code>hello</code> example from *note Conditional Sources::, we<br>could build a <code>libhello.la</code> library using either <code>hello-linux.c</code> or<br><code>hello-generic.c</code> with the following <code>Makefile.am</code>.</p>
<pre><code> lib_LTLIBRARIES = libhello.la
 libhello_la_SOURCES = hello-common.c
 EXTRA_libhello_la_SOURCES = hello-linux.c hello-generic.c
 libhello_la_LIBADD = $(HELLO_SYSTEM)
 libhello_la_DEPENDENCIES = $(HELLO_SYSTEM)
</code></pre>
<p>And make sure <code>configure</code> defines <code>HELLO_SYSTEM</code> as either<br><code>hello-linux.lo</code> or <code>hello-generic.lo</code>.</p>
<p>   Or we could simply use an Automake conditional as follows.</p>
<pre><code> lib_LTLIBRARIES = libhello.la
 libhello_la_SOURCES = hello-common.c
 if LINUX
 libhello_la_SOURCES += hello-linux.c
 else
 libhello_la_SOURCES += hello-generic.c
 endif
</code></pre>
<h2 id="8-3-5-Libtool-Convenience-Libraries"><a href="#8-3-5-Libtool-Convenience-Libraries" class="headerlink" title="8.3.5 Libtool Convenience Libraries"></a>8.3.5 Libtool Convenience Libraries</h2><p>Sometimes you want to build libtool libraries that should not be<br>installed.  These are called “libtool convenience libraries” and are<br>typically used to encapsulate many sublibraries, later gathered into one<br>big installed library.</p>
<p>   Libtool convenience libraries are declared by directory-less<br>variables such as <code>noinst_LTLIBRARIES</code>, <code>check_LTLIBRARIES</code>, or even<br><code>EXTRA_LTLIBRARIES</code>.  Unlike installed libtool libraries they do not<br>need an <code>-rpath</code> flag at link time (actually this is the only<br>difference).</p>
<p>   Convenience libraries listed in <code>noinst_LTLIBRARIES</code> are always<br>built.  Those listed in <code>check_LTLIBRARIES</code> are built only upon <code>make check</code>.  Finally, libraries listed in <code>EXTRA_LTLIBRARIES</code> are never<br>built explicitly: Automake outputs rules to build them, but if the<br>library does not appear as a Makefile dependency anywhere it won<code>t be built (this is why </code>EXTRA_LTLIBRARIES` is used for conditional<br>compilation).</p>
<p>   Here is a sample setup merging libtool convenience libraries from<br>subdirectories into one main <code>libtop.la</code> library.</p>
<pre><code> # -- Top-level Makefile.am --
 SUBDIRS = sub1 sub2 ...
 lib_LTLIBRARIES = libtop.la
 libtop_la_SOURCES =
 libtop_la_LIBADD = \
   sub1/libsub1.la \
   sub2/libsub2.la \
   ...

 # -- sub1/Makefile.am --
 noinst_LTLIBRARIES = libsub1.la
 libsub1_la_SOURCES = ...

 # -- sub2/Makefile.am --
 # showing nested convenience libraries
 SUBDIRS = sub2.1 sub2.2 ...
 noinst_LTLIBRARIES = libsub2.la
 libsub2_la_SOURCES =
 libsub2_la_LIBADD = \
   sub21/libsub21.la \
   sub22/libsub22.la \
   ...
</code></pre>
<p>   When using such setup, beware that <code>automake</code> will assume <code>libtop.la</code><br>is to be linked with the C linker.  This is because <code>libtop_la_SOURCES</code><br>is empty, so <code>automake</code> picks C as default language.  If<br><code>libtop_la_SOURCES</code> was not empty, <code>automake</code> would select the linker as<br>explained in *note How the Linker is Chosen::.</p>
<p>   If one of the sublibraries contains non-C source, it is important<br>that the appropriate linker be chosen.  One way to achieve this is to<br>pretend that there is such a non-C file among the sources of the<br>library, thus forcing <code>automake</code> to select the appropriate linker.  Here<br>is the top-level <code>Makefile</code> of our example updated to force C++ linking.</p>
<pre><code> SUBDIRS = sub1 sub2 ...
 lib_LTLIBRARIES = libtop.la
 libtop_la_SOURCES =
 # Dummy C++ source to cause C++ linking.
 nodist_EXTRA_libtop_la_SOURCES = dummy.cxx
 libtop_la_LIBADD = \
   sub1/libsub1.la \
   sub2/libsub2.la \
   ...
</code></pre>
<p>   <code>EXTRA_*_SOURCES</code> variables are used to keep track of source files<br>that might be compiled (this is mostly useful when doing conditional<br>compilation using <code>AC_SUBST</code>, *note Conditional Libtool Sources::), and<br>the <code>nodist_</code> prefix means the listed sources are not to be distributed<br>(*note Program and Library Variables::).  In effect the file <code>dummy.cxx</code><br>does not need to exist in the source tree.  Of course if you have some<br>real source file to list in <code>libtop_la_SOURCES</code> there is no point in<br>cheating with <code>nodist_EXTRA_libtop_la_SOURCES</code>.</p>
<h2 id="8-3-6-Libtool-Modules"><a href="#8-3-6-Libtool-Modules" class="headerlink" title="8.3.6 Libtool Modules"></a>8.3.6 Libtool Modules</h2><hr>
<p>These are libtool libraries meant to be dlopened.  They are indicated to<br>libtool by passing <code>-module</code> at link-time.</p>
<pre><code> pkglib_LTLIBRARIES = mymodule.la
 mymodule_la_SOURCES = doit.c
 mymodule_la_LDFLAGS = -module
</code></pre>
<p>   Ordinarily, Automake requires that a library<code>s name start with </code>lib<code>. However, when building a dynamically loadable module you might wish to use a "nonstandard" name.  Automake will not complain about such nonstandard names if it knows the library being built is a libtool module, i.e., if </code>-module<code> explicitly appears in the library</code>s<br><code>_LDFLAGS</code> variable (or in the common <code>AM_LDFLAGS</code> variable when no<br>per-library <code>_LDFLAGS</code> variable is defined).</p>
<p>   As always, <code>AC_SUBST</code> variables are black boxes to Automake since<br>their values are not yet known when <code>automake</code> is run.  Therefore if<br><code>-module</code> is set via such a variable, Automake cannot notice it and will<br>proceed as if the library was an ordinary libtool library, with strict<br>naming.</p>
<p>   If <code>mymodule_la_SOURCES</code> is not specified, then it defaults to the<br>single file <code>mymodule.c</code> (*note Default _SOURCES::).</p>
<h2 id="8-3-7-LIBADD-LDFLAGS-and-LIBTOOLFLAGS"><a href="#8-3-7-LIBADD-LDFLAGS-and-LIBTOOLFLAGS" class="headerlink" title="8.3.7 _LIBADD, _LDFLAGS, and _LIBTOOLFLAGS"></a>8.3.7 <code>_LIBADD</code>, <code>_LDFLAGS</code>, and <code>_LIBTOOLFLAGS</code></h2><hr>
<p>As shown in previous sections, the <code>LIBRARY_LIBADD</code> variable should be<br>used to list extra libtool objects (<code>.lo</code> files) or libtool libraries<br>(<code>.la</code>) to add to LIBRARY.</p>
<p>   The <code>LIBRARY_LDFLAGS</code> variable is the place to list additional<br>libtool linking flags, such as <code>-version-info</code>, <code>-static</code>, and a lot<br>more.  *Note Link mode: (libtool)Link mode.</p>
<p>   The <code>libtool</code> command has two kinds of options: mode-specific options<br>and generic options.  Mode-specific options such as the aforementioned<br>linking flags should be lumped with the other flags passed to the tool<br>invoked by <code>libtool</code> (hence the use of <code>LIBRARY_LDFLAGS</code> for libtool<br>linking flags).  Generic options include <code>--tag=TAG</code> and <code>--silent</code><br>(*note Invoking <code>libtool</code>: (libtool)Invoking libtool. for more options)<br>should appear before the mode selection on the command line; in<br><code>Makefile.am</code>s they should be listed in the <code>LIBRARY_LIBTOOLFLAGS</code><br>variable.</p>
<p>   If <code>LIBRARY_LIBTOOLFLAGS</code> is not defined, then the variable<br><code>AM_LIBTOOLFLAGS</code> is used instead.</p>
<p>   These flags are passed to libtool after the <code>--tag=TAG</code> option<br>computed by Automake (if any), so <code>LIBRARY_LIBTOOLFLAGS</code> (or<br><code>AM_LIBTOOLFLAGS</code>) is a good place to override or supplement the<br><code>--tag=TAG</code> setting.</p>
<p>   The libtool rules also use a <code>LIBTOOLFLAGS</code> variable that should not<br>be set in <code>Makefile.am</code>: this is a user variable (*note Flag Variables<br>Ordering::.  It allows users to run <code>make LIBTOOLFLAGS=--silent</code>, for<br>instance.  Note that the verbosity of <code>libtool</code> can also be influenced<br>by the Automake support for silent rules (*note Automake Silent<br>Rules::).</p>
<h2 id="8-3-8-LTLIBOBJS-and-LTALLOCA"><a href="#8-3-8-LTLIBOBJS-and-LTALLOCA" class="headerlink" title="8.3.8 LTLIBOBJS and LTALLOCA"></a>8.3.8 <code>LTLIBOBJS</code> and <code>LTALLOCA</code></h2><p>Where an ordinary library might include <code>$(LIBOBJS)</code> or <code>$(ALLOCA)</code><br>(*note LIBOBJS::), a libtool library must use <code>$(LTLIBOBJS)</code> or<br><code>$(LTALLOCA)</code>.  This is required because the object files that libtool<br>operates on do not necessarily end in <code>.o</code>.</p>
<p>   Nowadays, the computation of <code>LTLIBOBJS</code> from <code>LIBOBJS</code> is performed<br>automatically by Autoconf (*note <code>AC_LIBOBJ</code> vs. <code>LIBOBJS</code>:<br>(autoconf)AC_LIBOBJ vs LIBOBJS.).</p>
<h2 id="8-3-9-Common-Issues-Related-to-Libtool-96-s-Use"><a href="#8-3-9-Common-Issues-Related-to-Libtool-96-s-Use" class="headerlink" title="8.3.9 Common Issues Related to Libtool`s Use"></a>8.3.9 Common Issues Related to Libtool`s Use</h2><p>8.3.9.1 Error: <code>required file </code>./ltmain.sh’ not found`<br>………………………………………………</p>
<p>Libtool comes with a tool called <code>libtoolize</code> that will install<br>libtool<code>s supporting files into a package.  Running this command will install </code>ltmain.sh<code>.  You should execute it before </code>aclocal<code>and</code>automake`.</p>
<p>   People upgrading old packages to newer autotools are likely to face<br>this issue because older Automake versions used to call <code>libtoolize</code>.<br>Therefore old build scripts do not call <code>libtoolize</code>.</p>
<p>   Since Automake 1.6, it has been decided that running <code>libtoolize</code> was<br>none of Automake<code>s business.  Instead, that functionality has been moved into the </code>autoreconf<code>command (*note Using</code>autoreconf<code>: (autoconf)autoreconf Invocation.).  If you do not want to remember what to run and when, just learn the </code>autoreconf<code>command.  Hopefully, replacing existing</code>bootstrap<code>or</code>autogen.sh<code>scripts by a call to</code>autoreconf` should also free you from any similar incompatible change<br>in the future.</p>
<h2 id="8-3-9-2-Objects-created-with-both-libtool-and-without"><a href="#8-3-9-2-Objects-created-with-both-libtool-and-without" class="headerlink" title="8.3.9.2 Objects created with both libtool and without"></a>8.3.9.2 Objects <code>created with both libtool and without</code></h2><p>……………………………………………….</p>
<p>Sometimes, the same source file is used both to build a libtool library<br>and to build another non-libtool target (be it a program or another<br>library).</p>
<p>   Let<code>s consider the following </code>Makefile.am`.</p>
<pre><code> bin_PROGRAMS = prog
 prog_SOURCES = prog.c foo.c ...

 lib_LTLIBRARIES = libfoo.la
 libfoo_la_SOURCES = foo.c ...
</code></pre>
<p>(In this trivial case the issue could be avoided by linking <code>libfoo.la</code><br>with <code>prog</code> instead of listing <code>foo.c</code> in <code>prog_SOURCES</code>.  But let<code>s assume we really want to keep </code>prog<code>and</code>libfoo.la` separate.)</p>
<p>   Technically, it means that we should build <code>foo.$(OBJEXT)</code> for<br><code>prog</code>, and <code>foo.lo</code> for <code>libfoo.la</code>.  The problem is that in the course<br>of creating <code>foo.lo</code>, libtool may erase (or replace) <code>foo.$(OBJEXT)</code>,<br>and this cannot be avoided.</p>
<p>   Therefore, when Automake detects this situation it will complain with<br>a message such as<br>​     object ‘foo.$(OBJEXT)’ created both with libtool and without</p>
<p>   A workaround for this issue is to ensure that these two objects get<br>different basenames.  As explained in *note Renamed Objects::, this<br>happens automatically when per-targets flags are used.</p>
<pre><code> bin_PROGRAMS = prog
 prog_SOURCES = prog.c foo.c ...
 prog_CFLAGS = $(AM_CFLAGS)

 lib_LTLIBRARIES = libfoo.la
 libfoo_la_SOURCES = foo.c ...
</code></pre>
<p>Adding <code>prog_CFLAGS = $(AM_CFLAGS)</code> is almost a no-op, because when the<br><code>prog_CFLAGS</code> is defined, it is used instead of <code>AM_CFLAGS</code>.  However as<br>a side effect it will cause <code>prog.c</code> and <code>foo.c</code> to be compiled as<br><code>prog-prog.$(OBJEXT)</code> and <code>prog-foo.$(OBJEXT)</code>, which solves the issue.</p>
<h1 id="8-4-Program-and-Library-Variables"><a href="#8-4-Program-and-Library-Variables" class="headerlink" title="8.4 Program and Library Variables"></a>8.4 Program and Library Variables</h1><p>Associated with each program is a collection of variables that can be<br>used to modify how that program is built.  There is a similar list of<br>such variables for each library.  The canonical name of the program (or<br>library) is used as a base for naming these variables.</p>
<p>   In the list below, we use the name “maude” to refer to the program or<br>library.  In your <code>Makefile.am</code> you would replace this with the<br>canonical name of your program.  This list also refers to “maude” as a<br>program, but in general the same rules apply for both static and dynamic<br>libraries; the documentation below notes situations where programs and<br>libraries differ.</p>
<p><code>maude_SOURCES</code><br>​     This variable, if it exists, lists all the source files that are<br>​     compiled to build the program.  These files are added to the<br>​     distribution by default.  When building the program, Automake will<br>​     cause each source file to be compiled to a single <code>.o</code> file (or<br>​     <code>.lo</code> when using libtool).  Normally these object files are named<br>​     after the source file, but other factors can change this.  If a<br>​     file in the <code>_SOURCES</code> variable has an unrecognized extension,<br>​     Automake will do one of two things with it.  If a suffix rule<br>​     exists for turning files with the unrecognized extension into <code>.o</code><br>​     files, then <code>automake</code> will treat this file as it will any other<br>​     source file (*note Support for Other Languages::).  Otherwise, the<br>​     file will be ignored as though it were a header file.</p>
<pre><code> The prefixes `dist_` and `nodist_` can be used to control whether
 files listed in a `_SOURCES` variable are distributed.  `dist_` is
 redundant, as sources are distributed by default, but it can be
 specified for clarity if desired.

 It is possible to have both `dist_` and `nodist_` variants of a
 given `_SOURCES` variable at once; this lets you easily distribute
 some files and not others, for instance:

      nodist_maude_SOURCES = nodist.c
      dist_maude_SOURCES = dist-me.c

 By default the output file (on Unix systems, the `.o` file) will be
 put into the current build directory.  However, if the option
 `subdir-objects` is in effect in the current directory then the
 `.o` file will be put into the subdirectory named after the source
 file.  For instance, with `subdir-objects` enabled,
 `sub/dir/file.c` will be compiled to `sub/dir/file.o`.  Some people
 prefer this mode of operation.  You can specify `subdir-objects` in
 `AUTOMAKE_OPTIONS` (*note Options::).
</code></pre>
<p><code>EXTRA_maude_SOURCES</code><br>​     Automake needs to know the list of files you intend to compile<br>​     <em>statically</em>.  For one thing, this is the only way Automake has of<br>​     knowing what sort of language support a given <code>Makefile.in</code><br>​     requires.  (1) This means that, for example, you can<code>t put a ​     configure substitution like </code>@my_sources@<code>into a</code>_SOURCES<code>​     variable.  If you intend to conditionally compile source files and ​     use</code>configure<code>to substitute the appropriate object names into, ​     e.g.,</code><em>LDADD<code>(see below), then you should list the corresponding ​     source files in the</code>EXTRA</em>` variable.</p>
<pre><code> This variable also supports `dist_` and `nodist_` prefixes.  For
 instance, `nodist_EXTRA_maude_SOURCES` would list extra sources
 that may need to be built, but should not be distributed.
</code></pre>
<p><code>maude_AR</code><br>​     A static library is created by default by invoking <code>$(AR) ​     $(ARFLAGS)</code> followed by the name of the library and then the<br>​     objects being put into the library.  You can override this by<br>​     setting the <code>_AR</code> variable.  This is usually used with C++; some<br>​     C++ compilers require a special invocation in order to instantiate<br>​     all the templates that should go into a library.  For instance, the<br>​     SGI C++ compiler likes this variable set like so:<br>​          libmaude_a_AR = $(CXX) -ar -o</p>
<p><code>maude_LIBADD</code><br>​     Extra objects can be added to a <em>library</em> using the <code>_LIBADD</code><br>​     variable.  For instance, this should be used for objects determined<br>​     by <code>configure</code> (*note A Library::).</p>
<pre><code> In the case of libtool libraries, `maude_LIBADD` can also refer to
 other libtool libraries.
</code></pre>
<p><code>maude_LDADD</code><br>​     Extra objects (<code>*.$(OBJEXT)</code>) and libraries (<code>*.a</code>, <code>*.la</code>) can be<br>​     added to a <em>program</em> by listing them in the <code>_LDADD</code> variable.  For<br>​     instance, this should be used for objects determined by <code>configure</code><br>​     (*note Linking::).</p>
<pre><code> `_LDADD` and `_LIBADD` are inappropriate for passing
 program-specific linker flags (except for `-l`, `-L`, `-dlopen` and
 `-dlpreopen`).  Use the `_LDFLAGS` variable for this purpose.

 For instance, if your `configure.ac` uses `AC_PATH_XTRA`, you could
 link your program against the X libraries like so:

      maude_LDADD = $(X_PRE_LIBS) $(X_LIBS) $(X_EXTRA_LIBS)

 We recommend that you use `-l` and `-L` only when referring to
 third-party libraries, and give the explicit file names of any
 library built by your package.  Doing so will ensure that
 `maude_DEPENDENCIES` (see below) is correctly defined by default.
</code></pre>
<p><code>maude_LDFLAGS</code><br>​     This variable is used to pass extra flags to the link step of a<br>​     program or a shared library.  It overrides the <code>AM_LDFLAGS</code><br>​     variable.</p>
<p><code>maude_LIBTOOLFLAGS</code><br>​     This variable is used to pass extra options to <code>libtool</code>.  It<br>​     overrides the <code>AM_LIBTOOLFLAGS</code> variable.  These options are output<br>​     before <code>libtool``s </code>–mode=MODE` option, so they should not be<br>​     mode-specific options (those belong to the compiler or linker<br>​     flags).  *Note Libtool Flags::.</p>
<p><code>maude_DEPENDENCIES</code><br><code>EXTRA_maude_DEPENDENCIES</code><br>​     It is also occasionally useful to have a target (program or<br>​     library) depend on some other file that is not actually part of<br>​     that target.  This can be done using the <code>_DEPENDENCIES</code> variable.<br>​     Each target depends on the contents of such a variable, but no<br>​     further interpretation is done.</p>
<pre><code> Since these dependencies are associated to the link rule used to
 create the programs they should normally list files used by the
 link command.  That is `*.$(OBJEXT)`, `*.a`, or `*.la` files for
 programs; `*.lo` and `*.la` files for Libtool libraries; and
 `*.$(OBJEXT)` files for static libraries.  In rare cases you may
 need to add other kinds of files such as linker scripts, but
 _listing a source file in `_DEPENDENCIES` is wrong_.  If some
 source file needs to be built before all the components of a
 program are built, consider using the `BUILT_SOURCES` variable
 (*note Sources::).

 If `_DEPENDENCIES` is not supplied, it is computed by Automake.
 The automatically-assigned value is the contents of `_LDADD` or
 `_LIBADD`, with most configure substitutions, `-l`, `-L`, `-dlopen`
 and `-dlpreopen` options removed.  The configure substitutions that
 are left in are only `$(LIBOBJS)` and `$(ALLOCA)`; these are left
 because it is known that they will not cause an invalid value for
 `_DEPENDENCIES` to be generated.

 `_DEPENDENCIES` is more likely used to perform conditional
 compilation using an `AC_SUBST` variable that contains a list of
 objects.  *Note Conditional Sources::, and *note Conditional
 Libtool Sources::.

 The `EXTRA_*_DEPENDENCIES` variable may be useful for cases where
 you merely want to augment the `automake`-generated `_DEPENDENCIES`
 variable rather than replacing it.
</code></pre>
<p><code>maude_LINK</code><br>​     You can override the linker on a per-program basis.  By default the<br>​     linker is chosen according to the languages used by the program.<br>​     For instance, a program that includes C++ source code would use the<br>​     C++ compiler to link.  The <code>_LINK</code> variable must hold the name of a<br>​     command that can be passed all the <code>.o</code> file names and libraries to<br>​     link against as arguments.  Note that the name of the underlying<br>​     program is <em>not</em> passed to <code>_LINK</code>; typically one uses <code>$@</code>:</p>
<pre><code>      maude_LINK = $(CCLD) -magic -o $@

 If a `_LINK` variable is not supplied, it may still be generated
 and used by Automake due to the use of per-target link flags such
 as `_CFLAGS`, `_LDFLAGS` or `_LIBTOOLFLAGS`, in cases where they
 apply.
</code></pre>
<p><code>maude_CCASFLAGS</code><br><code>maude_CFLAGS</code><br><code>maude_CPPFLAGS</code><br><code>maude_CXXFLAGS</code><br><code>maude_FFLAGS</code><br><code>maude_GCJFLAGS</code><br><code>maude_LFLAGS</code><br><code>maude_OBJCFLAGS</code><br><code>maude_OBJCXXFLAGS</code><br><code>maude_RFLAGS</code><br><code>maude_UPCFLAGS</code><br><code>maude_YFLAGS</code><br>​     Automake allows you to set compilation flags on a per-program (or<br>​     per-library) basis.  A single source file can be included in<br>​     several programs, and it will potentially be compiled with<br>​     different flags for each program.  This works for any language<br>​     directly supported by Automake.  These “per-target compilation<br>​     flags” are <code>_CCASFLAGS</code>, <code>_CFLAGS</code>, <code>_CPPFLAGS</code>, <code>_CXXFLAGS</code>,<br>​     <code>_FFLAGS</code>, <code>_GCJFLAGS</code>, <code>_LFLAGS</code>, <code>_OBJCFLAGS</code>, <code>_OBJCXXFLAGS</code>,<br>​     <code>_RFLAGS</code>, <code>_UPCFLAGS</code>, and <code>_YFLAGS</code>.</p>
<pre><code> When using a per-target compilation flag, Automake will choose a
 different name for the intermediate object files.  Ordinarily a
 file like `sample.c` will be compiled to produce `sample.o`.
 However, if the program`s `_CFLAGS` variable is set, then the
 object file will be named, for instance, `maude-sample.o`.  (See
 also *note Renamed Objects::).

 In compilations with per-target flags, the ordinary `AM_` form of
 the flags variable is _not_ automatically included in the
 compilation (however, the user form of the variable _is_ included).
 So for instance, if you want the hypothetical `maude` compilations
 to also use the value of `AM_CFLAGS`, you would need to write:

      maude_CFLAGS = ... your flags ... $(AM_CFLAGS)

 *Note Flag Variables Ordering::, for more discussion about the
 interaction between user variables, `AM_` shadow variables, and
 per-target variables.
</code></pre>
<p><code>maude_SHORTNAME</code><br>​     On some platforms the allowable file names are very short.  In<br>​     order to support these systems and per-target compilation flags at<br>​     the same time, Automake allows you to set a “short name” that will<br>​     influence how intermediate object files are named.  For instance,<br>​     in the following example,</p>
<pre><code>      bin_PROGRAMS = maude
      maude_CPPFLAGS = -DSOMEFLAG
      maude_SHORTNAME = m
      maude_SOURCES = sample.c ...

 the object file would be named `m-sample.o` rather than
 `maude-sample.o`.

 This facility is rarely needed in practice, and we recommend
 avoiding it until you find it is required.
</code></pre>
<p>   (1) There are other, more obscure reasons for this limitation as<br>well.</p>
<h1 id="8-5-Default-SOURCES"><a href="#8-5-Default-SOURCES" class="headerlink" title="8.5 Default _SOURCES"></a>8.5 Default <code>_SOURCES</code></h1><p><code>_SOURCES</code> variables are used to specify source files of programs (*note<br>A Program::), libraries (*note A Library::), and Libtool libraries<br>(*note A Shared Library::).</p>
<p>   When no such variable is specified for a target, Automake will define<br>one itself.  The default is to compile a single C file whose base name<br>is the name of the target itself, with any extension replaced by<br><code>AM_DEFAULT_SOURCE_EXT</code>, which defaults to <code>.c</code>.</p>
<p>   For example if you have the following somewhere in your <code>Makefile.am</code><br>with no corresponding <code>libfoo_a_SOURCES</code>:</p>
<pre><code> lib_LIBRARIES = libfoo.a sub/libc++.a
</code></pre>
<p><code>libfoo.a</code> will be built using a default source file named <code>libfoo.c</code>,<br>and <code>sub/libc++.a</code> will be built from <code>sub/libc++.c</code>.  (In older<br>versions <code>sub/libc++.a</code> would be built from <code>sub_libc___a.c</code>, i.e., the<br>default source was the canonized name of the target, with <code>.c</code> appended.<br>We believe the new behavior is more sensible, but for backward<br>compatibility <code>automake</code> will use the old name if a file or a rule with<br>that name exists and <code>AM_DEFAULT_SOURCE_EXT</code> is not used.)</p>
<p>   Default sources are mainly useful in test suites, when building many<br>test programs each from a single source.  For instance, in</p>
<pre><code> check_PROGRAMS = test1 test2 test3
 AM_DEFAULT_SOURCE_EXT = .cpp
</code></pre>
<p><code>test1</code>, <code>test2</code>, and <code>test3</code> will be built from <code>test1.cpp</code>,<br><code>test2.cpp</code>, and <code>test3.cpp</code>.  Without the last line, they will be built<br>from <code>test1.c</code>, <code>test2.c</code>, and <code>test3.c</code>.</p>
<p>   Another case where this is convenient is building many Libtool<br>modules (<code>moduleN.la</code>), each defined in its own file (<code>moduleN.c</code>).</p>
<pre><code> AM_LDFLAGS = -module
 lib_LTLIBRARIES = module1.la module2.la module3.la
</code></pre>
<p>   Finally, there is one situation where this default source computation<br>needs to be avoided: when a target should not be built from sources.  We<br>already saw such an example in *note true::; this happens when all the<br>constituents of a target have already been compiled and just need to be<br>combined using a <code>_LDADD</code> variable.  Then it is necessary to define an<br>empty <code>_SOURCES</code> variable, so that <code>automake</code> does not compute a<br>default.</p>
<pre><code> bin_PROGRAMS = target
 target_SOURCES =
 target_LDADD = libmain.a libmisc.a
</code></pre>
<h1 id="8-6-Special-handling-for-LIBOBJS-and-ALLOCA"><a href="#8-6-Special-handling-for-LIBOBJS-and-ALLOCA" class="headerlink" title="8.6 Special handling for LIBOBJS and ALLOCA"></a>8.6 Special handling for <code>LIBOBJS</code> and <code>ALLOCA</code></h1><p>The <code>$(LIBOBJS)</code> and <code>$(ALLOCA)</code> variables list object files that should<br>be compiled into the project to provide an implementation for functions<br>that are missing or broken on the host system.  They are substituted by<br><code>configure</code>.</p>
<p>   These variables are defined by Autoconf macros such as <code>AC_LIBOBJ</code>,<br><code>AC_REPLACE_FUNCS</code> (*note Generic Function Checks: (autoconf)Generic<br>Functions.), or <code>AC_FUNC_ALLOCA</code> (*note Particular Function Checks:<br>(autoconf)Particular Functions.).  Many other Autoconf macros call<br><code>AC_LIBOBJ</code> or <code>AC_REPLACE_FUNCS</code> to populate <code>$(LIBOBJS)</code>.</p>
<p>   Using these variables is very similar to doing conditional<br>compilation using <code>AC_SUBST</code> variables, as described in *note<br>Conditional Sources::.  That is, when building a program, <code>$(LIBOBJS)</code><br>and <code>$(ALLOCA)</code> should be added to the associated <code>*_LDADD</code> variable, or<br>to the <code>*_LIBADD</code> variable when building a library.  However there is no<br>need to list the corresponding sources in <code>EXTRA_*_SOURCES</code> nor to<br>define <code>*_DEPENDENCIES</code>.  Automake automatically adds <code>$(LIBOBJS)</code> and<br><code>$(ALLOCA)</code> to the dependencies, and it will discover the list of<br>corresponding source files automatically (by tracing the invocations of<br>the <code>AC_LIBSOURCE</code> Autoconf macros).  If you have already defined<br><code>*_DEPENDENCIES</code> explicitly for an unrelated reason, then you either<br>need to add these variables manually, or use <code>EXTRA_*_DEPENDENCIES</code><br>instead of <code>*_DEPENDENCIES</code>.</p>
<p>   These variables are usually used to build a portability library that<br>is linked with all the programs of the project.  We now review a sample<br>setup.  First, <code>configure.ac</code> contains some checks that affect either<br><code>LIBOBJS</code> or <code>ALLOCA</code>.</p>
<pre><code> # configure.ac
 ...
 AC_CONFIG_LIBOBJ_DIR([lib])
 ...
 AC_FUNC_MALLOC             dnl May add malloc.$(OBJEXT) to LIBOBJS
 AC_FUNC_MEMCMP             dnl May add memcmp.$(OBJEXT) to LIBOBJS
 AC_REPLACE_FUNCS([strdup]) dnl May add strdup.$(OBJEXT) to LIBOBJS
 AC_FUNC_ALLOCA             dnl May add alloca.$(OBJEXT) to ALLOCA
 ...
 AC_CONFIG_FILES([
   lib/Makefile
   src/Makefile
 ])
 AC_OUTPUT
</code></pre>
<p>   The <code>AC_CONFIG_LIBOBJ_DIR</code> tells Autoconf that the source files of<br>these object files are to be found in the <code>lib/</code> directory.  Automake<br>can also use this information, otherwise it expects the source files are<br>to be in the directory where the <code>$(LIBOBJS)</code> and <code>$(ALLOCA)</code> variables<br>are used.</p>
<p>   The <code>lib/</code> directory should therefore contain <code>malloc.c</code>, <code>memcmp.c</code>,<br><code>strdup.c</code>, <code>alloca.c</code>.  Here is its <code>Makefile.am</code>:</p>
<pre><code> # lib/Makefile.am

 noinst_LIBRARIES = libcompat.a
 libcompat_a_SOURCES =
 libcompat_a_LIBADD = $(LIBOBJS) $(ALLOCA)
</code></pre>
<p>   The library can have any name, of course, and anyway it is not going<br>to be installed: it just holds the replacement versions of the missing<br>or broken functions so we can later link them in.  Many projects also<br>include extra functions, specific to the project, in that library: they<br>are simply added on the <code>_SOURCES</code> line.</p>
<p>   There is a small trap here, though: <code>$(LIBOBJS)</code> and <code>$(ALLOCA)</code><br>might be empty, and building an empty library is not portable.  You<br>should ensure that there is always something to put in <code>libcompat.a</code>.<br>Most projects will also add some utility functions in that directory,<br>and list them in <code>libcompat_a_SOURCES</code>, so in practice <code>libcompat.a</code><br>cannot be empty.</p>
<p>   Finally here is how this library could be used from the <code>src/</code><br>directory.</p>
<pre><code> # src/Makefile.am

 # Link all programs in this directory with libcompat.a
 LDADD = ../lib/libcompat.a

 bin_PROGRAMS = tool1 tool2 ...
 tool1_SOURCES = ...
 tool2_SOURCES = ...
</code></pre>
<p>   When option <code>subdir-objects</code> is not used, as in the above example,<br>the variables <code>$(LIBOBJS)</code> or <code>$(ALLOCA)</code> can only be used in the<br>directory where their sources lie.  E.g., here it would be wrong to use<br><code>$(LIBOBJS)</code> or <code>$(ALLOCA)</code> in <code>src/Makefile.am</code>.  However if both<br><code>subdir-objects</code> and <code>AC_CONFIG_LIBOBJ_DIR</code> are used, it is OK to use<br>these variables in other directories.  For instance <code>src/Makefile.am</code><br>could be changed as follows.</p>
<pre><code> # src/Makefile.am

 AUTOMAKE_OPTIONS = subdir-objects
 LDADD = $(LIBOBJS) $(ALLOCA)

 bin_PROGRAMS = tool1 tool2 ...
 tool1_SOURCES = ...
 tool2_SOURCES = ...
</code></pre>
<p>   Because <code>$(LIBOBJS)</code> and <code>$(ALLOCA)</code> contain object file names that<br>end with <code>.$(OBJEXT)</code>, they are not suitable for Libtool libraries<br>(where the expected object extension is <code>.lo</code>): <code>LTLIBOBJS</code> and<br><code>LTALLOCA</code> should be used instead.</p>
<p>   <code>LTLIBOBJS</code> is defined automatically by Autoconf and should not be<br>defined by hand (as in the past), however at the time of writing<br><code>LTALLOCA</code> still needs to be defined from <code>ALLOCA</code> manually.  *Note<br><code>AC_LIBOBJ</code> vs. <code>LIBOBJS</code>: (autoconf)AC_LIBOBJ vs LIBOBJS.</p>
<h1 id="8-7-Variables-used-when-building-a-program"><a href="#8-7-Variables-used-when-building-a-program" class="headerlink" title="8.7 Variables used when building a program"></a>8.7 Variables used when building a program</h1><p>Occasionally it is useful to know which <code>Makefile</code> variables Automake<br>uses for compilations, and in which order (*note Flag Variables<br>Ordering::); for instance, you might need to do your own compilation in<br>some special cases.</p>
<p>   Some variables are inherited from Autoconf; these are <code>CC</code>, <code>CFLAGS</code>,<br><code>CPPFLAGS</code>, <code>DEFS</code>, <code>LDFLAGS</code>, and <code>LIBS</code>.</p>
<p>   There are some additional variables that Automake defines on its own:</p>
<p><code>AM_CPPFLAGS</code><br>​     The contents of this variable are passed to every compilation that<br>​     invokes the C preprocessor; it is a list of arguments to the<br>​     preprocessor.  For instance, <code>-I</code> and <code>-D</code> options should be listed<br>​     here.</p>
<pre><code> Automake already provides some `-I` options automatically, in a
 separate variable that is also passed to every compilation that
 invokes the C preprocessor.  In particular it generates `-I.`,
 `-I$(srcdir)`, and a `-I` pointing to the directory holding
 `config.h` (if you`ve used `AC_CONFIG_HEADERS`).  You can disable
 the default `-I` options using the `nostdinc` option.

 When a file to be included is generated during the build and not
 part of a distribution tarball, its location is under
 `$(builddir)`, not under `$(srcdir)`.  This matters especially for
 packages that use header files placed in sub-directories and want
 to allow builds outside the source tree (*note VPATH Builds::).  In
 that case we recommend to use a pair of `-I` options, such as,
 e.g., `-Isome/subdir -I$(srcdir)/some/subdir` or
 `-I$(top_builddir)/some/subdir -I$(top_srcdir)/some/subdir`.  Note
 that the reference to the build tree should come before the
 reference to the source tree, so that accidentally leftover
 generated files in the source directory are ignored.

 `AM_CPPFLAGS` is ignored in preference to a per-executable (or
 per-library) `_CPPFLAGS` variable if it is defined.
</code></pre>
<p><code>INCLUDES</code><br>​     This does the same job as <code>AM_CPPFLAGS</code> (or any per-target<br>​     <code>_CPPFLAGS</code> variable if it is used).  It is an older name for the<br>​     same functionality.  This variable is deprecated; we suggest using<br>​     <code>AM_CPPFLAGS</code> and per-target <code>_CPPFLAGS</code> instead.</p>
<p><code>AM_CFLAGS</code><br>​     This is the variable the <code>Makefile.am</code> author can use to pass in<br>​     additional C compiler flags.  In some situations, this is not used,<br>​     in preference to the per-executable (or per-library) <code>_CFLAGS</code>.</p>
<p><code>COMPILE</code><br>​     This is the command used to actually compile a C source file.  The<br>​     file name is appended to form the complete command line.</p>
<p><code>AM_LDFLAGS</code><br>​     This is the variable the <code>Makefile.am</code> author can use to pass in<br>​     additional linker flags.  In some situations, this is not used, in<br>​     preference to the per-executable (or per-library) <code>_LDFLAGS</code>.</p>
<p><code>LINK</code><br>​     This is the command used to actually link a C program.  It already<br>​     includes <code>-o $@</code> and the usual variable references (for instance,<br>​     <code>CFLAGS</code>); it takes as “arguments” the names of the object files<br>​     and libraries to link in.  This variable is not used when the<br>​     linker is overridden with a per-target <code>_LINK</code> variable or<br>​     per-target flags cause Automake to define such a <code>_LINK</code> variable.</p>
<h1 id="8-8-Yacc-and-Lex-support"><a href="#8-8-Yacc-and-Lex-support" class="headerlink" title="8.8 Yacc and Lex support"></a>8.8 Yacc and Lex support</h1><p>Automake has somewhat idiosyncratic support for Yacc and Lex.</p>
<p>   Automake assumes that the <code>.c</code> file generated by <code>yacc</code> (or <code>lex</code>)<br>should be named using the basename of the input file.  That is, for a<br>yacc source file <code>foo.y</code>, Automake will cause the intermediate file to<br>be named <code>foo.c</code> (as opposed to <code>y.tab.c</code>, which is more traditional).</p>
<p>   The extension of a yacc source file is used to determine the<br>extension of the resulting C or C++ source and header files.  Note that<br>header files are generated only when the <code>-d</code> Yacc option is used; see<br>below for more information about this flag, and how to specify it.<br>Files with the extension <code>.y</code> will thus be turned into <code>.c</code> sources and<br><code>.h</code> headers; likewise, <code>.yy</code> will become <code>.cc</code> and <code>.hh</code>, <code>.y++</code> will<br>become <code>c++</code> and <code>h++</code>, <code>.yxx</code> will become <code>.cxx</code> and <code>.hxx</code>, and <code>.ypp</code><br>will become <code>.cpp</code> and <code>.hpp</code>.</p>
<p>   Similarly, lex source files can be used to generate C or C++; the<br>extensions <code>.l</code>, <code>.ll</code>, <code>.l++</code>, <code>.lxx</code>, and <code>.lpp</code> are recognized.</p>
<p>   You should never explicitly mention the intermediate (C or C++) file<br>in any <code>SOURCES</code> variable; only list the source file.</p>
<p>   The intermediate files generated by <code>yacc</code> (or <code>lex</code>) will be<br>included in any distribution that is made.  That way the user doesn<code>t need to have </code>yacc<code>or</code>lex`.</p>
<p>   If a <code>yacc</code> source file is seen, then your <code>configure.ac</code> must define<br>the variable <code>YACC</code>.  This is most easily done by invoking the macro<br><code>AC_PROG_YACC</code> (*note Particular Program Checks: (autoconf)Particular<br>Programs.).</p>
<p>   When <code>yacc</code> is invoked, it is passed <code>AM_YFLAGS</code> and <code>YFLAGS</code>.  The<br>latter is a user variable and the former is intended for the<br><code>Makefile.am</code> author.</p>
<p>   <code>AM_YFLAGS</code> is usually used to pass the <code>-d</code> option to <code>yacc</code>.<br>Automake knows what this means and will automatically adjust its rules<br>to update and distribute the header file built by <code>yacc -d</code>(1).  What<br>Automake cannot guess, though, is where this header will be used: it is<br>up to you to ensure the header gets built before it is first used.<br>Typically this is necessary in order for dependency tracking to work<br>when the header is included by another file.  The common solution is<br>listing the header file in <code>BUILT_SOURCES</code> (*note Sources::) as follows.</p>
<pre><code> BUILT_SOURCES = parser.h
 AM_YFLAGS = -d
 bin_PROGRAMS = foo
 foo_SOURCES = ... parser.y ...
</code></pre>
<p>   If a <code>lex</code> source file is seen, then your <code>configure.ac</code> must define<br>the variable <code>LEX</code>.  You can use <code>AC_PROG_LEX</code> to do this (*note<br>Particular Program Checks: (autoconf)Particular Programs.), but using<br><code>AM_PROG_LEX</code> macro (*note Macros::) is recommended.</p>
<p>   When <code>lex</code> is invoked, it is passed <code>AM_LFLAGS</code> and <code>LFLAGS</code>.  The<br>latter is a user variable and the former is intended for the<br><code>Makefile.am</code> author.</p>
<p>   When <code>AM_MAINTAINER_MODE</code> (*note maintainer-mode::) is used, the<br>rebuild rule for distributed Yacc and Lex sources are only used when<br><code>maintainer-mode</code> is enabled, or when the files have been erased.</p>
<p>   When <code>lex</code> or <code>yacc</code> sources are used, <code>automake -a</code> automatically<br>installs an auxiliary program called <code>ylwrap</code> in your package (*note<br>Auxiliary Programs::).  This program is used by the build rules to<br>rename the output of these tools, and makes it possible to include<br>multiple <code>yacc</code> (or <code>lex</code>) source files in a single directory.  (This is<br>necessary because yacc<code>s output file name is fixed, and a parallel make could conceivably invoke more than one instance of </code>yacc`<br>simultaneously.)</p>
<p>   For <code>yacc</code>, simply managing locking is insufficient.  The output of<br><code>yacc</code> always uses the same symbol names internally, so it isn<code>t possible to link two </code>yacc` parsers into the same executable.</p>
<p>   We recommend using the following renaming hack used in <code>gdb</code>:<br>​     #define yymaxdepth c_maxdepth<br>​     #define yyparse c_parse<br>​     #define yylex   c_lex<br>​     #define yyerror c_error<br>​     #define yylval  c_lval<br>​     #define yychar  c_char<br>​     #define yydebug c_debug<br>​     #define yypact  c_pact<br>​     #define yyr1    c_r1<br>​     #define yyr2    c_r2<br>​     #define yydef   c_def<br>​     #define yychk   c_chk<br>​     #define yypgo   c_pgo<br>​     #define yyact   c_act<br>​     #define yyexca  c_exca<br>​     #define yyerrflag c_errflag<br>​     #define yynerrs c_nerrs<br>​     #define yyps    c_ps<br>​     #define yypv    c_pv<br>​     #define yys     c_s<br>​     #define yy_yys  c_yys<br>​     #define yystate c_state<br>​     #define yytmp   c_tmp<br>​     #define yyv     c_v<br>​     #define yy_yyv  c_yyv<br>​     #define yyval   c_val<br>​     #define yylloc  c_lloc<br>​     #define yyreds  c_reds<br>​     #define yytoks  c_toks<br>​     #define yylhs   c_yylhs<br>​     #define yylen   c_yylen<br>​     #define yydefred c_yydefred<br>​     #define yydgoto  c_yydgoto<br>​     #define yysindex c_yysindex<br>​     #define yyrindex c_yyrindex<br>​     #define yygindex c_yygindex<br>​     #define yytable  c_yytable<br>​     #define yycheck  c_yycheck<br>​     #define yyname   c_yyname<br>​     #define yyrule   c_yyrule</p>
<p>   For each define, replace the <code>c_</code> prefix with whatever you like.<br>These defines work for <code>bison</code>, <code>byacc</code>, and traditional <code>yacc</code>s.  If<br>you find a parser generator that uses a symbol not covered here, please<br>report the new name so it can be added to the list.</p>
<p>   (1) Please note that <code>automake</code> recognizes <code>-d</code> in <code>AM_YFLAGS</code> only<br>if it is not clustered with other options; for example, it won<code>t be recognized if </code>AM_YFLAGS<code>is</code>-dt<code>, but it will be if </code>AM_YFLAGS<code>is</code>-d<br>-t<code>or</code>-t -d`.</p>
<h1 id="8-9-C-Support"><a href="#8-9-C-Support" class="headerlink" title="8.9 C++ Support"></a>8.9 C++ Support</h1><p>Automake includes full support for C++.</p>
<p>   Any package including C++ code must define the output variable <code>CXX</code><br>in <code>configure.ac</code>; the simplest way to do this is to use the<br><code>AC_PROG_CXX</code> macro (*note Particular Program Checks:<br>(autoconf)Particular Programs.).</p>
<p>   A few additional variables are defined when a C++ source file is<br>seen:</p>
<p><code>CXX</code><br>​     The name of the C++ compiler.</p>
<p><code>CXXFLAGS</code><br>​     Any flags to pass to the C++ compiler.</p>
<p><code>AM_CXXFLAGS</code><br>​     The maintainer<code>s variant of </code>CXXFLAGS`.</p>
<p><code>CXXCOMPILE</code><br>​     The command used to actually compile a C++ source file.  The file<br>​     name is appended to form the complete command line.</p>
<p><code>CXXLINK</code><br>​     The command used to actually link a C++ program.</p>
<h1 id="8-10-Objective-C-Support"><a href="#8-10-Objective-C-Support" class="headerlink" title="8.10 Objective C Support"></a>8.10 Objective C Support</h1><p>Automake includes some support for Objective C.</p>
<p>   Any package including Objective C code must define the output<br>variable <code>OBJC</code> in <code>configure.ac</code>; the simplest way to do this is to use<br>the <code>AC_PROG_OBJC</code> macro (*note Particular Program Checks:<br>(autoconf)Particular Programs.).</p>
<p>   A few additional variables are defined when an Objective C source<br>file is seen:</p>
<p><code>OBJC</code><br>​     The name of the Objective C compiler.</p>
<p><code>OBJCFLAGS</code><br>​     Any flags to pass to the Objective C compiler.</p>
<p><code>AM_OBJCFLAGS</code><br>​     The maintainer<code>s variant of </code>OBJCFLAGS`.</p>
<p><code>OBJCCOMPILE</code><br>​     The command used to actually compile an Objective C source file.<br>​     The file name is appended to form the complete command line.</p>
<p><code>OBJCLINK</code><br>​     The command used to actually link an Objective C program.</p>
<h1 id="8-11-Objective-C-Support"><a href="#8-11-Objective-C-Support" class="headerlink" title="8.11 Objective C++ Support"></a>8.11 Objective C++ Support</h1><p>Automake includes some support for Objective C++.</p>
<p>   Any package including Objective C++ code must define the output<br>variable <code>OBJCXX</code> in <code>configure.ac</code>; the simplest way to do this is to<br>use the <code>AC_PROG_OBJCXX</code> macro (*note Particular Program Checks:<br>(autoconf)Particular Programs.).</p>
<p>   A few additional variables are defined when an Objective C++ source<br>file is seen:</p>
<p><code>OBJCXX</code><br>​     The name of the Objective C++ compiler.</p>
<p><code>OBJCXXFLAGS</code><br>​     Any flags to pass to the Objective C++ compiler.</p>
<p><code>AM_OBJCXXFLAGS</code><br>​     The maintainer<code>s variant of </code>OBJCXXFLAGS`.</p>
<p><code>OBJCXXCOMPILE</code><br>​     The command used to actually compile an Objective C++ source file.<br>​     The file name is appended to form the complete command line.</p>
<p><code>OBJCXXLINK</code><br>​     The command used to actually link an Objective C++ program.</p>
<h1 id="8-12-Unified-Parallel-C-Support"><a href="#8-12-Unified-Parallel-C-Support" class="headerlink" title="8.12 Unified Parallel C Support"></a>8.12 Unified Parallel C Support</h1><p>Automake includes some support for Unified Parallel C.</p>
<p>   Any package including Unified Parallel C code must define the output<br>variable <code>UPC</code> in <code>configure.ac</code>; the simplest way to do this is to use<br>the <code>AM_PROG_UPC</code> macro (*note Public Macros::).</p>
<p>   A few additional variables are defined when a Unified Parallel C<br>source file is seen:</p>
<p><code>UPC</code><br>​     The name of the Unified Parallel C compiler.</p>
<p><code>UPCFLAGS</code><br>​     Any flags to pass to the Unified Parallel C compiler.</p>
<p><code>AM_UPCFLAGS</code><br>​     The maintainer<code>s variant of </code>UPCFLAGS`.</p>
<p><code>UPCCOMPILE</code><br>​     The command used to actually compile a Unified Parallel C source<br>​     file.  The file name is appended to form the complete command line.</p>
<p><code>UPCLINK</code><br>​     The command used to actually link a Unified Parallel C program.</p>
<h1 id="8-13-Assembly-Support"><a href="#8-13-Assembly-Support" class="headerlink" title="8.13 Assembly Support"></a>8.13 Assembly Support</h1><p>Automake includes some support for assembly code.  There are two forms<br>of assembler files: normal (<code>*.s</code>) and preprocessed by <code>CPP</code> (<code>*.S</code> or<br><code>*.sx</code>).</p>
<p>   The variable <code>CCAS</code> holds the name of the compiler used to build<br>assembly code.  This compiler must work a bit like a C compiler; in<br>particular it must accept <code>-c</code> and <code>-o</code>.  The values of <code>CCASFLAGS</code> and<br><code>AM_CCASFLAGS</code> (or its per-target definition) is passed to the<br>compilation.  For preprocessed files, <code>DEFS</code>, <code>DEFAULT_INCLUDES</code>,<br><code>INCLUDES</code>, <code>CPPFLAGS</code> and <code>AM_CPPFLAGS</code> are also used.</p>
<p>   The autoconf macro <code>AM_PROG_AS</code> will define <code>CCAS</code> and <code>CCASFLAGS</code><br>for you (unless they are already set, it simply sets <code>CCAS</code> to the C<br>compiler and <code>CCASFLAGS</code> to the C compiler flags), but you are free to<br>define these variables by other means.</p>
<p>   Only the suffixes <code>.s</code>, <code>.S</code>, and <code>.sx</code> are recognized by <code>automake</code><br>as being files containing assembly code.</p>
<h1 id="8-14-Fortran-77-Support"><a href="#8-14-Fortran-77-Support" class="headerlink" title="8.14 Fortran 77 Support"></a>8.14 Fortran 77 Support</h1><p>Automake includes full support for Fortran 77.</p>
<p>   Any package including Fortran 77 code must define the output variable<br><code>F77</code> in <code>configure.ac</code>; the simplest way to do this is to use the<br><code>AC_PROG_F77</code> macro (*note Particular Program Checks:<br>(autoconf)Particular Programs.).</p>
<p>   A few additional variables are defined when a Fortran 77 source file<br>is seen:</p>
<p><code>F77</code><br>​     The name of the Fortran 77 compiler.</p>
<p><code>FFLAGS</code><br>​     Any flags to pass to the Fortran 77 compiler.</p>
<p><code>AM_FFLAGS</code><br>​     The maintainer<code>s variant of </code>FFLAGS`.</p>
<p><code>RFLAGS</code><br>​     Any flags to pass to the Ratfor compiler.</p>
<p><code>AM_RFLAGS</code><br>​     The maintainer<code>s variant of </code>RFLAGS`.</p>
<p><code>F77COMPILE</code><br>​     The command used to actually compile a Fortran 77 source file.  The<br>​     file name is appended to form the complete command line.</p>
<p><code>FLINK</code><br>​     The command used to actually link a pure Fortran 77 program or<br>​     shared library.</p>
<p>   Automake can handle preprocessing Fortran 77 and Ratfor source files<br>in addition to compiling them(1).  Automake also contains some support<br>for creating programs and shared libraries that are a mixture of Fortran<br>77 and other languages (*note Mixing Fortran 77 With C and C++::).</p>
<p>   These issues are covered in the following sections.</p>
<p>   (1) Much, if not most, of the information in the following sections<br>pertaining to preprocessing Fortran 77 programs was taken almost<br>verbatim from *note Catalogue of Rules: (make)Catalogue of Rules.</p>
<h2 id="8-14-1-Preprocessing-Fortran-77"><a href="#8-14-1-Preprocessing-Fortran-77" class="headerlink" title="8.14.1 Preprocessing Fortran 77"></a>8.14.1 Preprocessing Fortran 77</h2><p><code>N.f</code> is made automatically from <code>N.F</code> or <code>N.r</code>.  This rule runs just<br>the preprocessor to convert a preprocessable Fortran 77 or Ratfor source<br>file into a strict Fortran 77 source file.  The precise command used is<br>as follows:</p>
<p><code>.F</code><br>​     <code>$(F77) -F $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) ​     $(AM_FFLAGS) $(FFLAGS)</code></p>
<p><code>.r</code><br>​     <code>$(F77) -F $(AM_FFLAGS) $(FFLAGS) $(AM_RFLAGS) $(RFLAGS)</code></p>
<h2 id="8-14-2-Compiling-Fortran-77-Files"><a href="#8-14-2-Compiling-Fortran-77-Files" class="headerlink" title="8.14.2 Compiling Fortran 77 Files"></a>8.14.2 Compiling Fortran 77 Files</h2><p><code>N.o</code> is made automatically from <code>N.f</code>, <code>N.F</code> or <code>N.r</code> by running the<br>Fortran 77 compiler.  The precise command used is as follows:</p>
<p><code>.f</code><br>​     <code>$(F77) -c $(AM_FFLAGS) $(FFLAGS)</code></p>
<p><code>.F</code><br>​     <code>$(F77) -c $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) ​     $(AM_FFLAGS) $(FFLAGS)</code></p>
<p><code>.r</code><br>​     <code>$(F77) -c $(AM_FFLAGS) $(FFLAGS) $(AM_RFLAGS) $(RFLAGS)</code></p>
<h2 id="8-14-3-Mixing-Fortran-77-With-C-and-C"><a href="#8-14-3-Mixing-Fortran-77-With-C-and-C" class="headerlink" title="8.14.3 Mixing Fortran 77 With C and C++"></a>8.14.3 Mixing Fortran 77 With C and C++</h2><p>Automake currently provides <em>limited</em> support for creating programs and<br>shared libraries that are a mixture of Fortran 77 and C and/or C++.<br>However, there are many other issues related to mixing Fortran 77 with<br>other languages that are <em>not</em> (currently) handled by Automake, but that<br>are handled by other packages(1).</p>
<p>   Automake can help in two ways:</p>
<ol>
<li><p>Automatic selection of the linker depending on which combinations<br>of source code.</p>
</li>
<li><p>Automatic selection of the appropriate linker flags (e.g., <code>-L</code> and<br><code>-l</code>) to pass to the automatically selected linker in order to link<br>in the appropriate Fortran 77 intrinsic and run-time libraries.</p>
<p>These extra Fortran 77 linker flags are supplied in the output<br>variable <code>FLIBS</code> by the <code>AC_F77_LIBRARY_LDFLAGS</code> Autoconf macro.<br>*Note Fortran Compiler Characteristics: (autoconf)Fortran Compiler.</p>
</li>
</ol>
<p>   If Automake detects that a program or shared library (as mentioned in<br>some <code>_PROGRAMS</code> or <code>_LTLIBRARIES</code> primary) contains source code that is<br>a mixture of Fortran 77 and C and/or C++, then it requires that the<br>macro <code>AC_F77_LIBRARY_LDFLAGS</code> be called in <code>configure.ac</code>, and that<br>either <code>$(FLIBS)</code> appear in the appropriate <code>_LDADD</code> (for programs) or<br><code>_LIBADD</code> (for shared libraries) variables.  It is the responsibility of<br>the person writing the <code>Makefile.am</code> to make sure that <code>$(FLIBS)</code><br>appears in the appropriate <code>_LDADD</code> or <code>_LIBADD</code> variable.</p>
<p>   For example, consider the following <code>Makefile.am</code>:</p>
<pre><code> bin_PROGRAMS = foo
 foo_SOURCES  = main.cc foo.f
 foo_LDADD    = libfoo.la $(FLIBS)

 pkglib_LTLIBRARIES = libfoo.la
 libfoo_la_SOURCES  = bar.f baz.c zardoz.cc
 libfoo_la_LIBADD   = $(FLIBS)
</code></pre>
<p>   In this case, Automake will insist that <code>AC_F77_LIBRARY_LDFLAGS</code> is<br>mentioned in <code>configure.ac</code>.  Also, if <code>$(FLIBS)</code> hadn<code>t been mentioned in </code>foo_LDADD<code>and</code>libfoo_la_LIBADD`, then Automake would have issued a<br>warning.</p>
<p>   (1) For example, the cfortran package<br>(<a href="http://www-zeus.desy.de/~burow/cfortran/">http://www-zeus.desy.de/~burow/cfortran/</a>) addresses all of these<br>inter-language issues, and runs under nearly all Fortran 77, C and C++<br>compilers on nearly all platforms.  However, <code>cfortran</code> is not yet Free<br>Software, but it will be in the next major release.</p>
<p>8.14.3.1 How the Linker is Chosen<br>……………………………</p>
<p>When a program or library mixes several languages, Automake choose the<br>linker according to the following priorities.  (The names in parentheses<br>are the variables containing the link command.)</p>
<ol>
<li>Native Java (<code>GCJLINK</code>)</li>
<li>Objective C++ (<code>OBJCXXLINK</code>)</li>
<li>C++ (<code>CXXLINK</code>)</li>
<li>Fortran 77 (<code>F77LINK</code>)</li>
<li>Fortran (<code>FCLINK</code>)</li>
<li>Objective C (<code>OBJCLINK</code>)</li>
<li>Unified Parallel C (<code>UPCLINK</code>)</li>
<li>C (<code>LINK</code>)</li>
</ol>
<p>   For example, if Fortran 77, C and C++ source code is compiled into a<br>program, then the C++ linker will be used.  In this case, if the C or<br>Fortran 77 linkers required any special libraries that weren<code>t included by the C++ linker, then they must be manually added to an </code>_LDADD<code>or</code>_LIBADD<code>variable by the user writing the</code>Makefile.am`.</p>
<p>   Automake only looks at the file names listed in <code>_SOURCES</code> variables<br>to choose the linker, and defaults to the C linker.  Sometimes this is<br>inconvenient because you are linking against a library written in<br>another language and would like to set the linker more appropriately.<br>*Note Libtool Convenience Libraries::, for a trick with<br><code>nodist_EXTRA_..._SOURCES</code>.</p>
<p>   A per-target <code>_LINK</code> variable will override the above selection.<br>Per-target link flags will cause Automake to write a per-target <code>_LINK</code><br>variable according to the language chosen as above.</p>
<h2 id="8-15-Fortran-9x-Support"><a href="#8-15-Fortran-9x-Support" class="headerlink" title="8.15 Fortran 9x Support"></a>8.15 Fortran 9x Support</h2><p>=======================</p>
<p>Automake includes support for Fortran 9x.</p>
<p>   Any package including Fortran 9x code must define the output variable<br><code>FC</code> in <code>configure.ac</code>; the simplest way to do this is to use the<br><code>AC_PROG_FC</code> macro (*note Particular Program Checks:<br>(autoconf)Particular Programs.).</p>
<p>   A few additional variables are defined when a Fortran 9x source file<br>is seen:</p>
<p><code>FC</code><br>​     The name of the Fortran 9x compiler.</p>
<p><code>FCFLAGS</code><br>​     Any flags to pass to the Fortran 9x compiler.</p>
<p><code>AM_FCFLAGS</code><br>​     The maintainer<code>s variant of </code>FCFLAGS`.</p>
<p><code>FCCOMPILE</code><br>​     The command used to actually compile a Fortran 9x source file.  The<br>​     file name is appended to form the complete command line.</p>
<p><code>FCLINK</code><br>​     The command used to actually link a pure Fortran 9x program or<br>​     shared library.</p>
<h3 id="8-15-1-Compiling-Fortran-9x-Files"><a href="#8-15-1-Compiling-Fortran-9x-Files" class="headerlink" title="8.15.1 Compiling Fortran 9x Files"></a>8.15.1 Compiling Fortran 9x Files</h3><hr>
<p><code>FILE.o</code> is made automatically from <code>FILE.f90</code>, <code>FILE.f95</code>, <code>FILE.f03</code>,<br>or <code>FILE.f08</code> by running the Fortran 9x compiler.  The precise command<br>used is as follows:</p>
<p><code>.f90</code><br>​     <code>$(FC) $(AM_FCFLAGS) $(FCFLAGS) -c $(FCFLAGS_f90) $&lt;</code></p>
<p><code>.f95</code><br>​     <code>$(FC) $(AM_FCFLAGS) $(FCFLAGS) -c $(FCFLAGS_f95) $&lt;</code></p>
<p><code>.f03</code><br>​     <code>$(FC) $(AM_FCFLAGS) $(FCFLAGS) -c $(FCFLAGS_f03) $&lt;</code></p>
<p><code>.f08</code><br>​     <code>$(FC) $(AM_FCFLAGS) $(FCFLAGS) -c $(FCFLAGS_f08) $&lt;</code></p>
<h1 id="8-16-Compiling-Java-sources-using-gcj"><a href="#8-16-Compiling-Java-sources-using-gcj" class="headerlink" title="8.16 Compiling Java sources using gcj"></a>8.16 Compiling Java sources using gcj</h1><p>Automake includes support for natively compiled Java, using <code>gcj</code>, the<br>Java front end to the GNU Compiler Collection (rudimentary support for<br>compiling Java to bytecode using the <code>javac</code> compiler is also present,<br><em>albeit deprecated</em>; *note Java::).</p>
<p>   Any package including Java code to be compiled must define the output<br>variable <code>GCJ</code> in <code>configure.ac</code>; the variable <code>GCJFLAGS</code> must also be<br>defined somehow (either in <code>configure.ac</code> or <code>Makefile.am</code>).  The<br>simplest way to do this is to use the <code>AM_PROG_GCJ</code> macro.</p>
<p>   By default, programs including Java source files are linked with<br><code>gcj</code>.</p>
<p>   As always, the contents of <code>AM_GCJFLAGS</code> are passed to every<br>compilation invoking <code>gcj</code> (in its role as an ahead-of-time compiler,<br>when invoking it to create <code>.class</code> files, <code>AM_JAVACFLAGS</code> is used<br>instead).  If it is necessary to pass options to <code>gcj</code> from<br><code>Makefile.am</code>, this variable, and not the user variable <code>GCJFLAGS</code>,<br>should be used.</p>
<p>   <code>gcj</code> can be used to compile <code>.java</code>, <code>.class</code>, <code>.zip</code>, or <code>.jar</code><br>files.</p>
<p>   When linking, <code>gcj</code> requires that the main class be specified using<br>the <code>--main=</code> option.  The easiest way to do this is to use the<br><code>_LDFLAGS</code> variable for the program.</p>
<h2 id="8-17-Vala-Support"><a href="#8-17-Vala-Support" class="headerlink" title="8.17 Vala Support"></a>8.17 Vala Support</h2><p>=================</p>
<p>Automake provides initial support for Vala<br>(<a href="http://www.vala-project.org/">http://www.vala-project.org/</a>).  This requires valac version 0.7.0 or<br>later, and currently requires the user to use GNU <code>make</code>.</p>
<pre><code> foo_SOURCES = foo.vala bar.vala zardoc.c
</code></pre>
<p>   Any <code>.vala</code> file listed in a <code>_SOURCES</code> variable will be compiled<br>into C code by the Vala compiler.  The generated <code>.c</code> files are<br>distributed.  The end user does not need to have a Vala compiler<br>installed.</p>
<p>   Automake ships with an Autoconf macro called <code>AM_PROG_VALAC</code> that<br>will locate the Vala compiler and optionally check its version number.</p>
<p> – Macro: AM_PROG_VALAC ([MINIMUM-VERSION], [ACTION-IF-FOUND],<br>​     [ACTION-IF-NOT-FOUND]) Search for a Vala compiler in <code>PATH</code>.  If it<br>​     is found, the variable <code>VALAC</code> is set to point to it (see below for<br>​     more details).  This macro takes three optional arguments.  The<br>​     first argument, if present, is the minimum version of the Vala<br>​     compiler required to compile this package.  If a compiler is found<br>​     and satisfies MINIMUM-VERSION, then ACTION-IF-FOUND is run (this<br>​     defaults to do nothing).  Otherwise, ACTION-IF-NOT-FOUND is run.<br>​     If ACTION-IF-NOT-FOUND is not specified, the default value is to<br>​     print a warning in case no compiler is found, or if a too-old<br>​     version of the compiler is found.</p>
<p>   There are a few variables that are used when compiling Vala sources:</p>
<p><code>VALAC</code><br>​     Absolute path to the Vala compiler, or simply <code>valac</code> if no<br>​     suitable compiler Vala could be found at configure runtime.</p>
<p><code>VALAFLAGS</code><br>​     Additional arguments for the Vala compiler.</p>
<p><code>AM_VALAFLAGS</code><br>​     The maintainer<code>s variant of </code>VALAFLAGS`.</p>
<pre><code>      lib_LTLIBRARIES = libfoo.la
      libfoo_la_SOURCES = foo.vala
</code></pre>
<p>   Note that currently, you cannot use per-target <code>*_VALAFLAGS</code> (*note<br>Renamed Objects::) to produce different C files from one Vala source<br>file.</p>
<h1 id="8-18-Support-for-Other-Languages"><a href="#8-18-Support-for-Other-Languages" class="headerlink" title="8.18 Support for Other Languages"></a>8.18 Support for Other Languages</h1><p>Automake currently only includes full support for C, C++ (*note C++<br>Support::), Objective C (*note Objective C Support::), Objective C++<br>(*note Objective C++ Support::), Fortran 77 (*note Fortran 77<br>Support::), Fortran 9x (*note Fortran 9x Support::), and Java (*note<br>Java Support with gcj::).  There is only rudimentary support for other<br>languages, support for which will be improved based on user demand.</p>
<p>   Some limited support for adding your own languages is available via<br>the suffix rule handling (*note Suffixes::).</p>
<h1 id="8-19-Automatic-dependency-tracking"><a href="#8-19-Automatic-dependency-tracking" class="headerlink" title="8.19 Automatic dependency tracking"></a>8.19 Automatic dependency tracking</h1><p>As a developer it is often painful to continually update the<br><code>Makefile.am</code> whenever the include-file dependencies change in a<br>project.  Automake supplies a way to automatically track dependency<br>changes (*note Dependency Tracking::).</p>
<p>   Automake always uses complete dependencies for a compilation,<br>including system headers.  Automake<code>s model is that dependency computation should be a side effect of the build.  To this end, dependencies are computed by running all compilations through a special wrapper program called </code>depcomp<code>.  </code>depcomp<code>understands how to coax many different C and C++ compilers into generating dependency information in the format it requires. </code>automake -a<code>will install</code>depcomp<code>into your source tree for you.  If</code>depcomp<code> can</code>t figure out<br>how to properly invoke your compiler, dependency tracking will simply be<br>disabled for your build.</p>
<p>   Experience with earlier versions of Automake (*note Dependency<br>Tracking Evolution: (automake-history)Dependency Tracking Evolution.)<br>taught us that it is not reliable to generate dependencies only on the<br>maintainer`s system, as configurations vary too much.  So instead<br>Automake implements dependency tracking at build time.</p>
<p>   Automatic dependency tracking can be suppressed by putting<br><code>no-dependencies</code> in the variable <code>AUTOMAKE_OPTIONS</code>, or passing<br><code>no-dependencies</code> as an argument to <code>AM_INIT_AUTOMAKE</code> (this should be<br>the preferred way).  Or, you can invoke <code>automake</code> with the <code>-i</code> option.<br>Dependency tracking is enabled by default.</p>
<p>   The person building your package also can choose to disable<br>dependency tracking by configuring with <code>--disable-dependency-tracking</code>.</p>
<h1 id="8-20-Support-for-executable-extensions"><a href="#8-20-Support-for-executable-extensions" class="headerlink" title="8.20 Support for executable extensions"></a>8.20 Support for executable extensions</h1><p>On some platforms, such as Windows, executables are expected to have an<br>extension such as <code>.exe</code>.  On these platforms, some compilers (GCC among<br>them) will automatically generate <code>foo.exe</code> when asked to generate<br><code>foo</code>.</p>
<p>   Automake provides mostly-transparent support for this.  Unfortunately<br><em>mostly</em> doesn`t yet mean <em>fully</em>.  Until the English dictionary is<br>revised, you will have to assist Automake if your package must support<br>those platforms.</p>
<p>   One thing you must be aware of is that, internally, Automake rewrites<br>something like this:</p>
<pre><code> bin_PROGRAMS = liver
</code></pre>
<p>   to this:</p>
<pre><code> bin_PROGRAMS = liver$(EXEEXT)
</code></pre>
<p>   The targets Automake generates are likewise given the <code>$(EXEEXT)</code><br>extension.</p>
<p>   The variables <code>TESTS</code> and <code>XFAIL_TESTS</code> (*note Simple Tests::) are<br>also rewritten if they contain filenames that have been declared as<br>programs in the same <code>Makefile</code>.  (This is mostly useful when some<br>programs from <code>check_PROGRAMS</code> are listed in <code>TESTS</code>.)</p>
<p>   However, Automake cannot apply this rewriting to <code>configure</code><br>substitutions.  This means that if you are conditionally building a<br>program using such a substitution, then your <code>configure.ac</code> must take<br>care to add <code>$(EXEEXT)</code> when constructing the output variable.</p>
<p>   Sometimes maintainers like to write an explicit link rule for their<br>program.  Without executable extension support, this is easy—you simply<br>write a rule whose target is the name of the program.  However, when<br>executable extension support is enabled, you must instead add the<br><code>$(EXEEXT)</code> suffix.</p>
<p>   This might be a nuisance for maintainers who know their package will<br>never run on a platform that has executable extensions.  For those<br>maintainers, the <code>no-exeext</code> option (*note Options::) will disable this<br>feature.  This works in a fairly ugly way; if <code>no-exeext</code> is seen, then<br>the presence of a rule for a target named <code>foo</code> in <code>Makefile.am</code> will<br>override an <code>automake</code>-generated rule for <code>foo$(EXEEXT)</code>.  Without the<br><code>no-exeext</code> option, this use will give a diagnostic.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2018/03/17/linux-automake-7-directories/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/17/linux-automake-7-directories/" class="post-title-link" itemprop="url">Linux Automake 7 目录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-17 22:28:00" itemprop="dateCreated datePublished" datetime="2018-03-17T22:28:00+08:00">2018-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/Automake/" itemprop="url" rel="index"><span itemprop="name">Automake</span></a>
                </span>
            </span>

          
            <span id="/2018/03/17/linux-automake-7-directories/" class="post-meta-item leancloud_visitors" data-flag-title="Linux Automake 7 目录" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/03/17/linux-automake-7-directories/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/03/17/linux-automake-7-directories/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/03/17/linux-automake-7-directories/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/03/17/linux-automake-7-directories/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>GNU Automake 版本(version 1.16.1, 26 February 2018)</p>
<p>Permission is granted to copy, distribute and/or modify this<br>document under the terms of the GNU Free Documentation License,<br>Version 1.3 or any later version published by the Free Software<br>Foundation; with no Invariant Sections, with no Front-Cover texts,<br>and with no Back-Cover Texts.  A copy of the license is included in<br>the section entitled “GNU Free Documentation License.”</p>
</blockquote>
<p>7 Directories</p>
<hr>
<p>For simple projects that distribute all files in the same directory it<br>is enough to have a single ‘Makefile.am’ that builds everything in<br>place.</p>
<p>   In larger projects, it is common to organize files in different<br>directories, in a tree.  For example, there could be a directory for the<br>program’s source, one for the testsuite, and one for the documentation;<br>or, for very large projects, there could be one directory per program,<br>per library or per module.</p>
<p>   The traditional approach is to build these subdirectories<br>recursively, employing <em>make recursion</em>: each directory contains its own<br>‘Makefile’, and when ‘make’ is run from the top-level directory, it<br>enters each subdirectory in turn, and invokes there a new ‘make’<br>instance to build the directory’s contents.</p>
<p>   Because this approach is very widespread, Automake offers built-in<br>support for it.  However, it is worth nothing that the use of make<br>recursion has its own serious issues and drawbacks, and that it’s well<br>possible to have packages with a multi directory layout that make little<br>or no use of such recursion (examples of such packages are GNU Bison and<br>GNU Automake itself); see also the</p>
<h1 id="7-1-Recursing-subdirectories"><a href="#7-1-Recursing-subdirectories" class="headerlink" title="7.1 Recursing subdirectories"></a>7.1 Recursing subdirectories</h1><p>In packages using make recursion, the top level ‘Makefile.am’ must tell<br>Automake which subdirectories are to be built.  This is done via the<br>‘SUBDIRS’ variable.</p>
<p>   The ‘SUBDIRS’ variable holds a list of subdirectories in which<br>building of various sorts can occur.  The rules for many targets (e.g.,<br>‘all’) in the generated ‘Makefile’ will run commands both locally and in<br>all specified subdirectories.  Note that the directories listed in<br>‘SUBDIRS’ are not required to contain ‘Makefile.am’s; only ‘Makefile’s<br>(after configuration).  This allows inclusion of libraries from packages<br>that do not use Automake (such as ‘gettext’; see also</p>
<p>   In packages that use subdirectories, the top-level ‘Makefile.am’ is<br>often very short.  For instance, here is the ‘Makefile.am’ from the GNU<br>Hello distribution:</p>
<pre><code> EXTRA_DIST = BUGS ChangeLog.O README-alpha
 SUBDIRS = doc intl po src tests
</code></pre>
<p>   When Automake invokes ‘make’ in a subdirectory, it uses the value of<br>the ‘MAKE’ variable.  It passes the value of the variable ‘AM_MAKEFLAGS’<br>to the ‘make’ invocation; this can be set in ‘Makefile.am’ if there are<br>flags you must always pass to ‘make’.</p>
<p>   The directories mentioned in ‘SUBDIRS’ are usually direct children of<br>the current directory, each subdirectory containing its own<br>‘Makefile.am’ with a ‘SUBDIRS’ pointing to deeper subdirectories.<br>Automake can be used to construct packages of arbitrary depth this way.</p>
<p>   By default, Automake generates ‘Makefiles’ that work depth-first in<br>postfix order: the subdirectories are built before the current<br>directory.  However, it is possible to change this ordering.  You can do<br>this by putting ‘.’ into ‘SUBDIRS’.  For instance, putting ‘.’ first<br>will cause a prefix ordering of directories.</p>
<p>   Using</p>
<pre><code> SUBDIRS = lib src . test
</code></pre>
<p>will cause ‘lib/’ to be built before ‘src/’, then the current directory<br>will be built, finally the ‘test/’ directory will be built.  It is<br>customary to arrange test directories to be built after everything else<br>since they are meant to test what has been constructed.</p>
<p>   In addition to the built-in recursive targets defined by Automake<br>(‘all’, ‘check’, etc.), the developer can also define his own recursive<br>targets.  That is done by passing the names of such targets as arguments<br>to the m4 macro ‘AM_EXTRA_RECURSIVE_TARGETS’ in ‘configure.ac’.<br>Automake generates rules to handle the recursion for such targets; and<br>the developer can define real actions for them by defining corresponding<br>‘-local’ targets.</p>
<pre><code> % cat configure.ac
 AC_INIT([pkg-name], [1.0]
 AM_INIT_AUTOMAKE
 AM_EXTRA_RECURSIVE_TARGETS([foo])
 AC_CONFIG_FILES([Makefile sub/Makefile sub/src/Makefile])
 AC_OUTPUT
 % cat Makefile.am
 SUBDIRS = sub
 foo-local:
         @echo This will be run by "make foo".
 % cat sub/Makefile.am
 SUBDIRS = src
 % cat sub/src/Makefile.am
 foo-local:
         @echo This too will be run by a "make foo" issued either in
         @echo the 'sub/src/' directory, the 'sub/' directory, or the
         @echo top-level directory.
</code></pre>
<h1 id="7-2-Conditional-Subdirectories"><a href="#7-2-Conditional-Subdirectories" class="headerlink" title="7.2 Conditional Subdirectories"></a>7.2 Conditional Subdirectories</h1><p>It is possible to define the ‘SUBDIRS’ variable conditionally if, like<br>in the case of GNU Inetutils, you want to only build a subset of the<br>entire package.</p>
<p>   To illustrate how this works, let’s assume we have two directories<br>‘src/’ and ‘opt/’.  ‘src/’ should always be built, but we want to decide<br>in ‘configure’ whether ‘opt/’ will be built or not.  (For this example<br>we will assume that ‘opt/’ should be built when the variable ‘$want_opt’<br>was set to ‘yes’.)</p>
<p>   Running ‘make’ should thus recurse into ‘src/’ always, and then maybe<br>in ‘opt/’.</p>
<p>   However ‘make dist’ should always recurse into both ‘src/’ and<br>‘opt/’.  Because ‘opt/’ should be distributed even if it is not needed<br>in the current configuration.  This means ‘opt/Makefile’ should be<br>created <em>unconditionally</em>.</p>
<p>   There are two ways to setup a project like this.  You can use<br>Automake conditionals () or use Autoconf ‘AC_SUBST’<br>variables  Using Automake conditionals is the preferred solution.<br>Before we illustrate these two possibilities, let’s introduce<br>‘DIST_SUBDIRS’.</p>
<h2 id="7-2-1-‘SUBDIRS’-vs-‘DIST-SUBDIRS’"><a href="#7-2-1-‘SUBDIRS’-vs-‘DIST-SUBDIRS’" class="headerlink" title="7.2.1 ‘SUBDIRS’ vs. ‘DIST_SUBDIRS’"></a>7.2.1 ‘SUBDIRS’ vs. ‘DIST_SUBDIRS’</h2><p>Automake considers two sets of directories, defined by the variables<br>‘SUBDIRS’ and ‘DIST_SUBDIRS’.</p>
<p>   ‘SUBDIRS’ contains the subdirectories of the current directory that<br>must be built .  It must be defined manually;<br>Automake will never guess a directory is to be built.  As we will see in<br>the next two sections, it is possible to define it conditionally so that<br>some directory will be omitted from the build.</p>
<p>   ‘DIST_SUBDIRS’ is used in rules that need to recurse in all<br>directories, even those that have been conditionally left out of the<br>build.  Recall our example where we may not want to build subdirectory<br>‘opt/’, but yet we want to distribute it?  This is where ‘DIST_SUBDIRS’<br>comes into play: ‘opt’ may not appear in ‘SUBDIRS’, but it must appear<br>in ‘DIST_SUBDIRS’.</p>
<p>   Precisely, ‘DIST_SUBDIRS’ is used by ‘make maintainer-clean’, ‘make<br>distclean’ and ‘make dist’.  All other recursive rules use ‘SUBDIRS’.</p>
<p>   If ‘SUBDIRS’ is defined conditionally using Automake conditionals,<br>Automake will define ‘DIST_SUBDIRS’ automatically from the possible<br>values of ‘SUBDIRS’ in all conditions.</p>
<p>   If ‘SUBDIRS’ contains ‘AC_SUBST’ variables, ‘DIST_SUBDIRS’ will not<br>be defined correctly because Automake does not know the possible values<br>of these variables.  In this case ‘DIST_SUBDIRS’ needs to be defined<br>manually.</p>
<h2 id="7-2-2-Subdirectories-with-‘AM-CONDITIONAL’"><a href="#7-2-2-Subdirectories-with-‘AM-CONDITIONAL’" class="headerlink" title="7.2.2 Subdirectories with ‘AM_CONDITIONAL’"></a>7.2.2 Subdirectories with ‘AM_CONDITIONAL’</h2><p>‘configure’ should output the ‘Makefile’ for each directory and define a<br>condition into which ‘opt/’ should be built.</p>
<pre><code> ...
 AM_CONDITIONAL([COND_OPT], [test "$want_opt" = yes])
 AC_CONFIG_FILES([Makefile src/Makefile opt/Makefile])
 ...
</code></pre>
<p>   Then ‘SUBDIRS’ can be defined in the top-level ‘Makefile.am’ as<br>follows.</p>
<pre><code> if COND_OPT
   MAYBE_OPT = opt
 endif
 SUBDIRS = src $(MAYBE_OPT)
</code></pre>
<p>   As you can see, running ‘make’ will rightly recurse into ‘src/’ and<br>maybe ‘opt/’.</p>
<p>   As you can’t see, running ‘make dist’ will recurse into both ‘src/’<br>and ‘opt/’ directories because ‘make dist’, unlike ‘make all’, doesn’t<br>use the ‘SUBDIRS’ variable.  It uses the ‘DIST_SUBDIRS’ variable.</p>
<p>   In this case Automake will define ‘DIST_SUBDIRS = src opt’<br>automatically because it knows that ‘MAYBE_OPT’ can contain ‘opt’ in<br>some condition.</p>
<h2 id="7-2-3-Subdirectories-with-‘AC-SUBST’"><a href="#7-2-3-Subdirectories-with-‘AC-SUBST’" class="headerlink" title="7.2.3 Subdirectories with ‘AC_SUBST’"></a>7.2.3 Subdirectories with ‘AC_SUBST’</h2><p>Another possibility is to define ‘MAYBE_OPT’ from ‘./configure’ using<br>‘AC_SUBST’:</p>
<pre><code> ...
 if test "$want_opt" = yes; then
   MAYBE_OPT=opt
 else
   MAYBE_OPT=
 fi
 AC_SUBST([MAYBE_OPT])
 AC_CONFIG_FILES([Makefile src/Makefile opt/Makefile])
 ...
</code></pre>
<p>   In this case the top-level ‘Makefile.am’ should look as follows.</p>
<pre><code> SUBDIRS = src $(MAYBE_OPT)
 DIST_SUBDIRS = src opt
</code></pre>
<p>   The drawback is that since Automake cannot guess what the possible<br>values of ‘MAYBE_OPT’ are, it is necessary to define ‘DIST_SUBDIRS’.</p>
<h2 id="7-2-4-Unconfigured-Subdirectories"><a href="#7-2-4-Unconfigured-Subdirectories" class="headerlink" title="7.2.4 Unconfigured Subdirectories"></a>7.2.4 Unconfigured Subdirectories</h2><p>The semantics of ‘DIST_SUBDIRS’ are often misunderstood by some users<br>that try to <em>configure and build</em> subdirectories conditionally.  Here by<br>configuring we mean creating the ‘Makefile’ (it might also involve<br>running a nested ‘configure’ script: this is a costly operation that<br>explains why people want to do it conditionally, but only the ‘Makefile’<br>is relevant to the discussion).</p>
<p>   The above examples all assume that every ‘Makefile’ is created, even<br>in directories that are not going to be built.  The simple reason is<br>that we want ‘make dist’ to distribute even the directories that are not<br>being built (e.g., platform-dependent code), hence ‘make dist’ must<br>recurse into the subdirectory, hence this directory must be configured<br>and appear in ‘DIST_SUBDIRS’.</p>
<p>   Building packages that do not configure every subdirectory is a<br>tricky business, and we do not recommend it to the novice as it is easy<br>to produce an incomplete tarball by mistake.  We will not discuss this<br>topic in depth here, yet for the adventurous here are a few rules to<br>remember.</p>
<p>   • ‘SUBDIRS’ should always be a subset of ‘DIST_SUBDIRS’.</p>
<pre><code> It makes little sense to have a directory in ‘SUBDIRS’ that is not
 in ‘DIST_SUBDIRS’.  Think of the former as a way to tell which
 directories listed in the latter should be built.
</code></pre>
<p>   • Any directory listed in ‘DIST_SUBDIRS’ and ‘SUBDIRS’ must be<br>     configured.</p>
<pre><code> I.e., the ‘Makefile’ must exists or the recursive ‘make’ rules will
 not be able to process the directory.
</code></pre>
<p>   • Any configured directory must be listed in ‘DIST_SUBDIRS’.</p>
<pre><code> So that the cleaning rules remove the generated ‘Makefile’s.  It
 would be correct to see ‘DIST_SUBDIRS’ as a variable that lists all
 the directories that have been configured.
</code></pre>
<p>   In order to prevent recursion in some unconfigured directory you must<br>therefore ensure that this directory does not appear in ‘DIST_SUBDIRS’<br>(and ‘SUBDIRS’).  For instance, if you define ‘SUBDIRS’ conditionally<br>using ‘AC_SUBST’ and do not define ‘DIST_SUBDIRS’ explicitly, it will be<br>default to ‘$(SUBDIRS)’; another possibility is to force ‘DIST_SUBDIRS =<br>$(SUBDIRS)’.</p>
<p>   Of course, directories that are omitted from ‘DIST_SUBDIRS’ will not<br>be distributed unless you make other arrangements for this to happen<br>(for instance, always running ‘make dist’ in a configuration where all<br>directories are known to appear in ‘DIST_SUBDIRS’; or writing a<br>‘dist-hook’ target to distribute these directories).</p>
<p>   In few packages, unconfigured directories are not even expected to be<br>distributed.  Although these packages do not require the aforementioned<br>extra arrangements, there is another pitfall.  If the name of a<br>directory appears in ‘SUBDIRS’ or ‘DIST_SUBDIRS’, ‘automake’ will make<br>sure the directory exists.  Consequently ‘automake’ cannot be run on<br>such a distribution when one directory has been omitted.  One way to<br>avoid this check is to use the ‘AC_SUBST’ method to declare conditional<br>directories; since ‘automake’ does not know the values of ‘AC_SUBST’<br>variables it cannot ensure the corresponding directory exists.</p>
<h1 id="7-3-An-Alternative-Approach-to-Subdirectories"><a href="#7-3-An-Alternative-Approach-to-Subdirectories" class="headerlink" title="7.3 An Alternative Approach to Subdirectories"></a>7.3 An Alternative Approach to Subdirectories</h1><p>If you’ve ever read Peter Miller’s excellent paper, Recursive Make<br>Considered Harmful (<a href="http://miller.emu.id.au/pmiller/books/rmch/">http://miller.emu.id.au/pmiller/books/rmch/</a>), the<br>preceding sections on the use of make recursion will probably come as<br>unwelcome advice.  For those who haven’t read the paper, Miller’s main<br>thesis is that recursive ‘make’ invocations are both slow and<br>error-prone.</p>
<p>   Automake provides sufficient cross-directory support (1) to enable<br>you to write a single ‘Makefile.am’ for a complex multi-directory<br>package.</p>
<p>   By default an installable file specified in a subdirectory will have<br>its directory name stripped before installation.  For instance, in this<br>example, the header file will be installed as ‘$(includedir)/stdio.h’:</p>
<pre><code> include_HEADERS = inc/stdio.h
</code></pre>
<p>   However, the ‘nobase_’ prefix can be used to circumvent this path<br>stripping.  In this example, the header file will be installed as<br>‘$(includedir)/sys/types.h’:</p>
<pre><code> nobase_include_HEADERS = sys/types.h
</code></pre>
<p>   ‘nobase_’ should be specified first when used in conjunction with<br>either ‘dist_’ or ‘nodist_’ (.<br>For instance:</p>
<pre><code> nobase_dist_pkgdata_DATA = images/vortex.pgm sounds/whirl.ogg
</code></pre>
<p>   Finally, note that a variable using the ‘nobase_’ prefix can often be<br>replaced by several variables, one for each destination directory (.  For instance, the last example could be rewritten as<br>follows:</p>
<pre><code> imagesdir = $(pkgdatadir)/images
 soundsdir = $(pkgdatadir)/sounds
 dist_images_DATA = images/vortex.pgm
 dist_sounds_DATA = sounds/whirl.ogg
</code></pre>
<p>This latter syntax makes it possible to change one destination directory<br>without changing the layout of the source tree.</p>
<p>   Currently, ‘nobase_*_LTLIBRARIES’ are the only exception to this<br>rule, in that there is no particular installation order guarantee for an<br>otherwise equivalent set of variables without ‘nobase_’ prefix.</p>
<p>   ———- Footnotes ———-</p>
<p>   (1) We believe.  This work is new and there are probably warts.</p>
<h1 id="7-4-Nesting-Packages"><a href="#7-4-Nesting-Packages" class="headerlink" title="7.4 Nesting Packages"></a>7.4 Nesting Packages</h1><p>In the GNU Build System, packages can be nested to arbitrary depth.<br>This means that a package can embed other packages with their own<br>‘configure’, ‘Makefile’s, etc.</p>
<p>   These other packages should just appear as subdirectories of their<br>parent package.  They must be listed in ‘SUBDIRS’ like other ordinary<br>directories.  However the subpackage’s ‘Makefile’s should be output by<br>its own ‘configure’ script, not by the parent’s ‘configure’.  This is<br>achieved using the ‘AC_CONFIG_SUBDIRS’ Autoconf macro (</p>
<p>   Here is an example package for an ‘arm’ program that links with a<br>‘hand’ library that is a nested package in subdirectory ‘hand/’.</p>
<p>   ‘arm’’s ‘configure.ac’:</p>
<pre><code> AC_INIT([arm], [1.0])
 AC_CONFIG_AUX_DIR([.])
 AM_INIT_AUTOMAKE
 AC_PROG_CC
 AC_CONFIG_FILES([Makefile])
 # Call hand's ./configure script recursively.
 AC_CONFIG_SUBDIRS([hand])
 AC_OUTPUT
</code></pre>
<p>   ‘arm’’s ‘Makefile.am’:</p>
<pre><code> # Build the library in the hand subdirectory first.
 SUBDIRS = hand

 # Include hand's header when compiling this directory.
 AM_CPPFLAGS = -I$(srcdir)/hand

 bin_PROGRAMS = arm
 arm_SOURCES = arm.c
 # link with the hand library.
 arm_LDADD = hand/libhand.a
</code></pre>
<p>   Now here is ‘hand’’s ‘hand/configure.ac’:</p>
<pre><code> AC_INIT([hand], [1.2])
 AC_CONFIG_AUX_DIR([.])
 AM_INIT_AUTOMAKE
 AC_PROG_CC
 AM_PROG_AR
 AC_PROG_RANLIB
 AC_CONFIG_FILES([Makefile])
 AC_OUTPUT
</code></pre>
<p>and its ‘hand/Makefile.am’:</p>
<pre><code> lib_LIBRARIES = libhand.a
 libhand_a_SOURCES = hand.c
</code></pre>
<p>   When ‘make dist’ is run from the top-level directory it will create<br>an archive ‘arm-1.0.tar.gz’ that contains the ‘arm’ code as well as the<br>‘hand’ subdirectory.  This package can be built and installed like any<br>ordinary package, with the usual ‘./configure &amp;&amp; make &amp;&amp; make install’<br>sequence (the ‘hand’ subpackage will be built and installed by the<br>process).</p>
<p>   When ‘make dist’ is run from the hand directory, it will create a<br>self-contained ‘hand-1.2.tar.gz’ archive.  So although it appears to be<br>embedded in another package, it can still be used separately.</p>
<p>   The purpose of the ‘AC_CONFIG_AUX_DIR([.])’ instruction is to force<br>Automake and Autoconf to search for auxiliary scripts in the current<br>directory.  For instance, this means that there will be two copies of<br>‘install-sh’: one in the top-level of the ‘arm’ package, and another one<br>in the ‘hand/’ subdirectory for the ‘hand’ package.</p>
<p>   The historical default is to search for these auxiliary scripts in<br>the parent directory and the grandparent directory.  So if the<br>‘AC_CONFIG_AUX_DIR([.])’ line was removed from ‘hand/configure.ac’, that<br>subpackage would share the auxiliary script of the ‘arm’ package.  This<br>may looks like a gain in size (a few kilobytes), but it is actually a<br>loss of modularity as the ‘hand’ subpackage is no longer self-contained<br>(‘make dist’ in the subdirectory will not work anymore).</p>
<p>   Packages that do not use Automake need more work to be integrated<br>this way.  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://shaoguangleo.github.io/2018/03/16/linux-automake-6-scanning-configure-ac/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="郭大侠">
      <meta itemprop="description" content="郭大侠的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="浩瀚宇宙 灿烂星空">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/03/16/linux-automake-6-scanning-configure-ac/" class="post-title-link" itemprop="url">Linux Automake 6  解析`configure.ac`</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-16 22:28:00" itemprop="dateCreated datePublished" datetime="2018-03-16T22:28:00+08:00">2018-03-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-06-19 21:19:18" itemprop="dateModified" datetime="2025-06-19T21:19:18+08:00">2025-06-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/Automake/" itemprop="url" rel="index"><span itemprop="name">Automake</span></a>
                </span>
            </span>

          
            <span id="/2018/03/16/linux-automake-6-scanning-configure-ac/" class="post-meta-item leancloud_visitors" data-flag-title="Linux Automake 6  解析`configure.ac`" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2018/03/16/linux-automake-6-scanning-configure-ac/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/03/16/linux-automake-6-scanning-configure-ac/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2018/03/16/linux-automake-6-scanning-configure-ac/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2018/03/16/linux-automake-6-scanning-configure-ac/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>GNU Automake 版本(version 1.16.1, 26 February 2018)</p>
<p>Permission is granted to copy, distribute and/or modify this<br>document under the terms of the GNU Free Documentation License,<br>Version 1.3 or any later version published by the Free Software<br>Foundation; with no Invariant Sections, with no Front-Cover texts,<br>and with no Back-Cover Texts.  A copy of the license is included in<br>the section entitled “GNU Free Documentation License.”</p>
</blockquote>
<h1 id="6-使用aclocal解析configure-ac"><a href="#6-使用aclocal解析configure-ac" class="headerlink" title="6 使用aclocal解析configure.ac"></a>6 使用aclocal解析configure.ac</h1><hr>
<p>Automake通过解析文件 <code>configure.ac</code> 来决定软件包的信息。一些 <code>autoconf</code> 宏需要定义在该文件中。</p>
<h2 id="6-1-Configuration-requirements"><a href="#6-1-Configuration-requirements" class="headerlink" title="6.1 Configuration requirements"></a>6.1 Configuration requirements</h2><hr>
<p>Automake需要的一个必须的参数是<code>AM_INIT_AUTOMAKE</code>。</p>
<p>初次之外还有一些其他的宏，如下所示：</p>
<p><code>AC_CONFIG_FILES</code><br><code>AC_OUTPUT</code><br>​     这个两个宏一般位于文件的最末尾。</p>
<pre><code>      AC_CONFIG_FILES([
        Makefile
        doc/Makefile
        src/Makefile
        src/lib/Makefile
        ...
      ])
      AC_OUTPUT
</code></pre>
<p>Automake使用这些信息来确定哪些文件需要被创建，上面的内容就是如果在目录中存在 <code>Makefile.am</code>的文件，那么将生成<code>Makefile</code>文件。<br>When using <code>AC_CONFIG_FILES</code> with multiple input files, as in<br>AC_CONFIG_FILES([Makefile:top.in:Makefile.in:bot.in])<br>​<br><code>automake</code> will generate the first <code>.in</code> input file for which a<br><code>.am</code> file exists.  If no such file exists the output file is not<br>considered to be generated by Automake.<br>​<br> 通过 <code>AC_CONFIG_FILES</code>创建的文件在使用 <code>make distclean</code>的时候都会被清除。  Their inputs are<br>automatically distributed, unless they are the output of prior<br><code>AC_CONFIG_FILES</code> commands.  Finally, rebuild rules are generated<br>in the Automake <code>Makefile</code> existing in the subdirectory of the<br>output file, if there is one, or in the top-level <code>Makefile</code><br>otherwise.</p>
<p>The above machinery (cleaning, distributing, and rebuilding) works<br>fine if the <code>AC_CONFIG_FILES</code> specifications contain only literals.<br>If part of the specification uses shell variables, <code>automake</code> will<br>not be able to fulfill this setup, and you will have to complete<br>the missing bits by hand.  For instance, on</p>
<pre><code>      file=input
      ...
      AC_CONFIG_FILES([output:$file],, [file=$file])
</code></pre>
<p><code>automake</code> will output rules to clean <code>output</code>, and rebuild it.<br>However the rebuild rule will not depend on <code>input</code>, and this file<br>will not be distributed either.  (You must add <code>EXTRA_DIST = input</code><br>to your <code>Makefile.am</code> if <code>input</code> is a source file.)</p>
<p>Similarly<br>​<br>​     file=output<br>​     file2=out:in<br>​     …<br>​     AC_CONFIG_FILES([$file:input],, [file=$file])<br>​     AC_CONFIG_FILES([$file2],, [file2=$file2])</p>
<p>will only cause <code>input</code> to be distributed.  No file will be cleaned<br>automatically (add <code>DISTCLEANFILES = output out</code> yourself), and no<br>rebuild rule will be output.</p>
<p>Obviously <code>automake</code> cannot guess what value <code>$file</code> is going to<br>hold later when <code>configure</code> is run, and it cannot use the shell<br>variable <code>$file</code> in a <code>Makefile</code>.  However, if you make reference<br>to <code>$file</code> as <code>${file}</code> (i.e., in a way that is compatible with<br><code>make``s syntax) and furthermore use </code>AC_SUBST<code>to ensure that</code>${file}<code>is meaningful in a</code>Makefile<code>, then </code>automake<code>will be able to use</code>${file}` to generate all of these rules.  For<br>instance, here is how the Automake package itself generates<br>versioned scripts for its test suite:</p>
<pre><code> AC_SUBST([APIVERSION], ...)
 ...
 AC_CONFIG_FILES(
   [tests/aclocal-${APIVERSION}:tests/aclocal.in],
   [chmod +x tests/aclocal-${APIVERSION}],
   [APIVERSION=$APIVERSION])
 AC_CONFIG_FILES(
   [tests/automake-${APIVERSION}:tests/automake.in],
   [chmod +x tests/automake-${APIVERSION}])
</code></pre>
<p>Here cleaning, distributing, and rebuilding are done automatically,<br>because <code>${APIVERSION}</code> is known at <code>make</code>-time.</p>
<p>Note that you should not use shell variables to declare <code>Makefile</code><br>files for which <code>automake</code> must create <code>Makefile.in</code>.  Even<br><code>AC_SUBST</code> does not help here, because <code>automake</code> needs to know the<br>file name when it runs in order to check whether <code>Makefile.am</code><br>exists.  (In the very hairy case that your setup requires such use<br>of variables, you will have to tell Automake which <code>Makefile.in</code>s<br>to generate on the command-line.)</p>
<p>It is possible to let <code>automake</code> emit conditional rules for<br><code>AC_CONFIG_FILES</code> with the help of <code>AM_COND_IF</code> .</p>
<p>To summarize:<br>   • Use literals for <code>Makefile</code>s, and for other files whenever<br>​     possible.<br>   • Use <code>$file</code> (or <code>${file}</code> without <code>AC_SUBST([file])</code>) for<br>​     files that <code>automake</code> should ignore.<br>   • Use <code>${file}</code> and <code>AC_SUBST([file])</code> for files that <code>automake</code><br>​     should not ignore.</p>
<h2 id="6-2-Other-things-Automake-recognizes"><a href="#6-2-Other-things-Automake-recognizes" class="headerlink" title="6.2 Other things Automake recognizes"></a>6.2 Other things Automake recognizes</h2><hr>
<p>Every time Automake is run it calls Autoconf to trace <code>configure.ac</code>.<br>This way it can recognize the use of certain macros and tailor the<br>generated <code>Makefile.in</code> appropriately.  Currently recognized macros and<br>their effects are:</p>
<p><code>AC_CANONICAL_BUILD</code><br><code>AC_CANONICAL_HOST</code><br><code>AC_CANONICAL_TARGET</code><br>​     Automake will ensure that <code>config.guess</code> and <code>config.sub</code> exist.<br>​     Also, the <code>Makefile</code> variables <code>build_triplet</code>, <code>host_triplet</code> and<br>​     <code>target_triplet</code> are introduced.</p>
<p><code>AC_CONFIG_AUX_DIR</code><br>​     Automake will look for various helper scripts, such as<br>​     <code>install-sh</code>, in the directory named in this macro invocation.<br>​     (The full list of scripts is: <code>ar-lib</code>, <code>config.guess</code>,<br>​     <code>config.sub</code>, <code>depcomp</code>, <code>compile</code>, <code>install-sh</code>, <code>ltmain.sh</code>,<br>​     <code>mdate-sh</code>, <code>missing</code>, <code>mkinstalldirs</code>, <code>py-compile</code>,<br>​     <code>test-driver</code>, <code>texinfo.tex</code>, <code>ylwrap</code>.)  Not all scripts are<br>​     always searched for; some scripts will only be sought if the<br>​     generated <code>Makefile.in</code> requires them.</p>
<pre><code> If `AC_CONFIG_AUX_DIR` is not given, the scripts are looked for in
 their standard locations.  For `mdate-sh`, `texinfo.tex`, and
 `ylwrap`, the standard location is the source directory
 corresponding to the current `Makefile.am`.  For the rest, the
 standard location is the first one of `.`, `..`, or `../..`
 (relative to the top source directory) that provides any one of the
 helper scripts.  

 Required files from `AC_CONFIG_AUX_DIR` are automatically
 distributed, even if there is no `Makefile.am` in this directory.
</code></pre>
<p><code>AC_CONFIG_LIBOBJ_DIR</code><br>​     Automake will require the sources file declared with <code>AC_LIBSOURCE</code><br>​     (see below) in the directory specified by this macro.</p>
<p><code>AC_CONFIG_HEADERS</code><br>​     Automake will generate rules to rebuild these headers from the<br>​     corresponding templates (usually, the template for a <code>foo.h</code> header<br>​     being <code>foo.h.in</code>).  Older versions of Automake required the use of<br>​     <code>AM_CONFIG_HEADER</code>; this is no longer the case, and that macro has<br>​     indeed been removed.</p>
<pre><code> As with `AC_CONFIG_FILES` , parts of the
 specification using shell variables will be ignored as far as
 cleaning, distributing, and rebuilding is concerned.
</code></pre>
<p><code>AC_CONFIG_LINKS</code><br>​     Automake will generate rules to remove <code>configure</code> generated links<br>​     on <code>make distclean</code> and to distribute named source files as part of<br>​     <code>make dist</code>.</p>
<pre><code> As for `AC_CONFIG_FILES` parts of the
 specification using shell variables will be ignored as far as
 cleaning and distributing is concerned.  (There are no rebuild
 rules for links.)
</code></pre>
<p><code>AC_LIBOBJ</code><br><code>AC_LIBSOURCE</code><br><code>AC_LIBSOURCES</code><br>​     Automake will automatically distribute any file listed in<br>​     <code>AC_LIBSOURCE</code> or <code>AC_LIBSOURCES</code>.</p>
<pre><code> Note that the `AC_LIBOBJ` macro calls `AC_LIBSOURCE`.  So if an
 Autoconf macro is documented to call `AC_LIBOBJ([file])`, then
 `file.c` will be distributed automatically by Automake.  This
 encompasses many macros like `AC_FUNC_ALLOCA`, `AC_FUNC_MEMCMP`,
 `AC_REPLACE_FUNCS`, and others.

 By the way, direct assignments to `LIBOBJS` are no longer
 supported.  You should always use `AC_LIBOBJ` for this purpose.
 Note `AC_LIBOBJ` vs. `LIBOBJS`: (autoconf)AC_LIBOBJ vs LIBOBJS.
</code></pre>
<p><code>AC_PROG_RANLIB</code><br>​     This is required if any libraries are built in the package.  Note<br>​     Particular Program Checks: (autoconf)Particular Programs.</p>
<p><code>AC_PROG_CXX</code><br>​     This is required if any C++ source is included.  Note Particular<br>​     Program Checks: (autoconf)Particular Programs.</p>
<p><code>AC_PROG_OBJC</code><br>​     This is required if any Objective C source is included.  Note<br>​     Particular Program Checks: (autoconf)Particular Programs.</p>
<p><code>AC_PROG_OBJCXX</code><br>​     This is required if any Objective C++ source is included.  Note<br>​     Particular Program Checks: (autoconf)Particular Programs.</p>
<p><code>AC_PROG_F77</code><br>​     This is required if any Fortran 77 source is included.  Note<br>​     Particular Program Checks: (autoconf)Particular Programs.</p>
<p><code>AC_F77_LIBRARY_LDFLAGS</code><br>​     This is required for programs and shared libraries that are a<br>​     mixture of languages that include Fortran 77 .  </p>
<p><code>AC_FC_SRCEXT</code><br>​     Automake will add the flags computed by <code>AC_FC_SRCEXT</code> to<br>​     compilation of files with the respective source extension</p>
<p><code>AC_PROG_FC</code><br>​     This is required if any Fortran 90/95 source is included.  This<br>​     macro is distributed with Autoconf version 2.58 and later.  Note<br>​     Particular Program Checks: (autoconf)Particular Programs.</p>
<p><code>AC_PROG_LIBTOOL</code><br>​     Automake will turn on processing for <code>libtool</code></p>
<p><code>AC_PROG_YACC</code><br>​     If a Yacc source file is seen, then you must either use this macro<br>​     or define the variable <code>YACC</code> in <code>configure.ac</code>.  The former is<br>​     preferred</p>
<p><code>AC_PROG_LEX</code><br>​     If a Lex source file is seen, then this macro must be used.  Note<br>​     Particular Program Checks: (autoconf)Particular Programs.</p>
<p><code>AC_REQUIRE_AUX_FILE</code><br>​     For each <code>AC_REQUIRE_AUX_FILE([FILE])</code>, <code>automake</code> will ensure that<br>​     <code>FILE</code> exists in the aux directory, and will complain otherwise.<br>​     It will also automatically distribute the file.  This macro should<br>​     be used by third-party Autoconf macros that require some supporting<br>​     files in the aux directory specified with <code>AC_CONFIG_AUX_DIR</code><br>​     above.  Note Finding <code>configure</code> Input: (autoconf)Input.</p>
<p><code>AC_SUBST</code><br>​     The first argument is automatically defined as a variable in each<br>​     generated <code>Makefile.in</code>, unless <code>AM_SUBST_NOTMAKE</code> is also used for<br>​     this variable.  Note Setting Output Variables: (autoconf)Setting<br>​     Output Variables.</p>
<pre><code> For every substituted variable VAR, `automake` will add a line `VAR
 = VALUE` to each `Makefile.in` file.  Many Autoconf macros invoke
 `AC_SUBST` to set output variables this way, e.g., `AC_PATH_XTRA`
 defines `X_CFLAGS` and `X_LIBS`.  Thus, you can access these
 variables as `$(X_CFLAGS)` and `$(X_LIBS)` in any `Makefile.am` if
 `AC_PATH_XTRA` is called.
</code></pre>
<p><code>AM_CONDITIONAL</code><br>​     This introduces an Automake conditional</p>
<p><code>AM_COND_IF</code><br>​     This macro allows <code>automake</code> to detect subsequent access within<br>​     <code>configure.ac</code> to a conditional previously introduced with<br>​     <code>AM_CONDITIONAL</code>, thus enabling conditional <code>AC_CONFIG_FILES</code></p>
<p><code>AM_GNU_GETTEXT</code><br>​     This macro is required for packages that use GNU gettext .  It is distributed with gettext.  If Automake sees this<br>​     macro it ensures that the package meets some of gettext`s<br>​     requirements.</p>
<p><code>AM_GNU_GETTEXT_INTL_SUBDIR</code><br>​     This macro specifies that the <code>intl/</code> subdirectory is to be built,<br>​     even if the <code>AM_GNU_GETTEXT</code> macro was invoked with a first<br>​     argument of <code>external</code>.</p>
<p><code>AM_MAINTAINER_MODE([DEFAULT-MODE])</code><br>​     This macro adds an <code>--enable-maintainer-mode</code> option to<br>​     <code>configure</code>.  If this is used, <code>automake</code> will cause<br>​     “maintainer-only” rules to be turned off by default in the<br>​     generated <code>Makefile.in</code>s, unless DEFAULT-MODE is <code>enable</code>.  This<br>​     macro defines the <code>MAINTAINER_MODE</code> conditional, which you can use<br>​     in your own <code>Makefile.am</code>.  Note maintainer-mode::.</p>
<p><code>AM_SUBST_NOTMAKE(VAR)</code><br>​     Prevent Automake from defining a variable VAR, even if it is<br>​     substituted by <code>config.status</code>.  Normally, Automake defines a<br>​     <code>make</code> variable for each <code>configure</code> substitution, i.e., for each<br>​     <code>AC_SUBST([VAR])</code>.  This macro prevents that definition from<br>​     Automake.  If <code>AC_SUBST</code> has not been called for this variable,<br>​     then <code>AM_SUBST_NOTMAKE</code> has no effects.  Preventing variable<br>​     definitions may be useful for substitution of multi-line values,<br>​     where <code>VAR = @VALUE@</code> might yield unintended results.</p>
<p><code>m4_include</code><br>​     Files included by <code>configure.ac</code> using this macro will be detected<br>​     by Automake and automatically distributed.  They will also appear<br>​     as dependencies in <code>Makefile</code> rules.</p>
<pre><code> `m4_include` is seldom used by `configure.ac` authors, but can
 appear in `aclocal.m4` when `aclocal` detects that some required
 macros come from files local to your package (as opposed to macros
 installed in a system-wide directory, note aclocal Invocation::).
</code></pre>
<h2 id="6-3-Auto-generating-aclocal-m4"><a href="#6-3-Auto-generating-aclocal-m4" class="headerlink" title="6.3 Auto-generating aclocal.m4"></a>6.3 Auto-generating aclocal.m4</h2><hr>
<p>Automake includes a number of Autoconf macros that can be used in your<br>package (Macros::); some of them are actually required by Automake<br>in certain situations.  These macros must be defined in your<br><code>aclocal.m4</code>; otherwise they will not be seen by <code>autoconf</code>.</p>
<p>程序 <code>aclocal</code> 将根据 <code>configure.ac</code>自动生成文件 <code>aclocal.m4</code> 。  This provides a convenient way<br>to get Automake-provided macros, without having to search around.  The<br><code>aclocal</code> mechanism allows other packages to supply their own macros<br>(Extending aclocal::).  You can also use it to maintain your own<br>set of custom macros (Local Macros::).</p>
<p>   At startup, <code>aclocal</code> scans all the <code>.m4</code> files it can find, looking<br>for macro definitions (Macro Search Path::).  Then it scans<br><code>configure.ac</code>.  Any mention of one of the macros found in the first<br>step causes that macro, and any macros it in turn requires, to be put<br>into <code>aclocal.m4</code>.</p>
<p>   <em>Putting</em> the file that contains the macro definition into<br><code>aclocal.m4</code> is usually done by copying the entire text of this file,<br>including unused macro definitions as well as both <code>#</code> and <code>dnl</code><br>comments.  If you want to make a comment that will be completely ignored<br>by <code>aclocal</code>, use <code>##</code> as the comment leader.</p>
<p>   When a file selected by <code>aclocal</code> is located in a subdirectory<br>specified as a relative search path with <code>aclocal``s </code>-I<code>argument,</code>aclocal<code>assumes the file belongs to the package and uses</code>m4_include<code>instead of copying it into</code>aclocal.m4<code>.  This makes the package smaller, eases dependency tracking, and cause the file to be distributed automatically.  (Note Local Macros::, for an example.)  Any macro that is found in a system-wide directory, or via an absolute search path will be copied.  So use </code>-I <code>pwd</code>/reldir<code>instead of</code>-I reldir` whenever<br>some relative directory should be considered outside the package.</p>
<p>   The contents of <code>acinclude.m4</code>, if this file exists, are also<br>automatically included in <code>aclocal.m4</code>.  We recommend against using<br><code>acinclude.m4</code> in new packages (note Local Macros::).</p>
<p>   While computing <code>aclocal.m4</code>, <code>aclocal</code> runs <code>autom4te</code> (note Using<br><code>Autom4te</code>: (autoconf)Using autom4te.) in order to trace the macros that<br>are really used, and omit from <code>aclocal.m4</code> all macros that are<br>mentioned but otherwise unexpanded (this can happen when a macro is<br>called conditionally).  <code>autom4te</code> is expected to be in the <code>PATH</code>, just<br>as <code>autoconf</code>.  Its location can be overridden using the <code>AUTOM4TE</code><br>environment variable.</p>
<h3 id="6-3-1-aclocal-Options"><a href="#6-3-1-aclocal-Options" class="headerlink" title="6.3.1 aclocal Options"></a>6.3.1 aclocal Options</h3><hr>
<hr>
<p><code>aclocal</code> accepts the following options:</p>
<p><code>--automake-acdir=DIR</code><br>​     Look for the automake-provided macro files in DIR instead of in the<br>​     installation directory.  This is typically used for debugging.</p>
<pre><code> The environment variable `ACLOCAL_AUTOMAKE_DIR` provides another
 way to set the directory containing automake-provided macro files.
 However `--automake-acdir` takes precedence over it.
</code></pre>
<p><code>--system-acdir=DIR</code><br>​     Look for the system-wide third-party macro files (and the special<br>​     <code>dirlist</code> file) in DIR instead of in the installation directory.<br>​     This is typically used for debugging.</p>
<p><code>--diff[=COMMAND]</code><br>​     Run COMMAND on M4 file that would be installed or overwritten by<br>​     <code>--install</code>.  The default COMMAND is <code>diff -u</code>.  This option<br>​     implies <code>--install</code> and <code>--dry-run</code>.</p>
<p><code>--dry-run</code><br>​     Do not actually overwrite (or create) <code>aclocal.m4</code> and M4 files<br>​     installed by <code>--install</code>.</p>
<p><code>--help</code><br>​     Print a summary of the command line options and exit.</p>
<p><code>-I DIR</code><br>​     Add the directory DIR to the list of directories searched for <code>.m4</code><br>​     files.</p>
<p><code>--install</code><br>​     Install system-wide third-party macros into the first directory<br>​     specified with <code>-I DIR</code> instead of copying them in the output file.<br>​     Note that this will happen also if DIR is an absolute path.</p>
<pre><code> When this option is used, and only when this option is used,
 `aclocal` will also honor `#serial NUMBER` lines that appear in
 macros: an M4 file is ignored if there exists another M4 file with
 the same basename and a greater serial number in the search path
 (note Serials::).
</code></pre>
<p><code>--force</code><br>​     Always overwrite the output file.  The default is to overwrite the<br>​     output file only when really needed, i.e., when its contents<br>​     changes or if one of its dependencies is younger.</p>
<pre><code> This option forces the update of `aclocal.m4` (or the file
 specified with `--output` below) and only this file, it has
 absolutely no influence on files that may need to be installed by
 `--install`.
</code></pre>
<p><code>--output=FILE</code><br>​     Cause the output to be put into FILE instead of <code>aclocal.m4</code>.</p>
<p><code>--print-ac-dir</code><br>​     Prints the name of the directory that <code>aclocal</code> will search to find<br>​     third-party <code>.m4</code> files.  When this option is given, normal<br>​     processing is suppressed.  This option was used <em>in the past</em> by<br>​     third-party packages to determine where to install <code>.m4</code> macro<br>​     files, but <em>this usage is today discouraged</em>, since it causes<br>​     <code>$(prefix)</code> not to be thoroughly honored (which violates the GNU<br>​     Coding Standards), and a similar semantics can be better obtained<br>​     with the <code>ACLOCAL_PATH</code> environment variable; note Extending<br>​     aclocal::.</p>
<p><code>--verbose</code><br>​     Print the names of the files it examines.</p>
<p><code>--version</code><br>​     Print the version number of Automake and exit.</p>
<p><code>-W CATEGORY</code><br><code>--warnings=CATEGORY</code><br>​     Output warnings falling in CATEGORY.  CATEGORY can be one of:<br>​     <code>syntax</code><br>​          dubious syntactic constructs, underquoted macros, unused<br>​          macros, etc.<br>​     <code>unsupported</code><br>​          unknown macros<br>​     <code>all</code><br>​          all the warnings, this is the default<br>​     <code>none</code><br>​          turn off all the warnings<br>​     <code>error</code><br>​          treat warnings as errors</p>
<pre><code> All warnings are output by default.

 The environment variable `WARNINGS` is honored in the same way as
 it is for `automake` (note automake Invocation::).
</code></pre>
<h3 id="6-3-2-Macro-Search-Path"><a href="#6-3-2-Macro-Search-Path" class="headerlink" title="6.3.2 Macro Search Path"></a>6.3.2 Macro Search Path</h3><hr>
<hr>
<p>默认情况下 <code>aclocal</code> 按照下面的目录顺序来搜索 <code>.m4</code> 文件：</p>
<p><code>ACDIR-APIVERSION</code><br>​     This is where the <code>.m4</code> macros distributed with Automake itself are<br>​     stored.  APIVERSION depends on the Automake release used; for<br>​     example, for Automake 1.11.x, APIVERSION = <code>1.11</code>.</p>
<p><code>ACDIR</code><br>​     This directory is intended for third party <code>.m4</code> files, and is<br>​     configured when <code>automake</code> itself is built.  This is<br>​     <code>@datadir@/aclocal/</code>, which typically expands to<br>​     <code>${prefix}/share/aclocal/</code>.  To find the compiled-in value of<br>​     ACDIR, use the <code>--print-ac-dir</code> option (note aclocal Options::).</p>
<p>   As an example, suppose that <code>automake-1.11.2</code> was configured with<br><code>--prefix=/usr/local</code>.  Then, the search path would be:</p>
<ol>
<li><code>/usr/local/share/aclocal-1.11.2/</code></li>
<li><code>/usr/local/share/aclocal/</code></li>
</ol>
<p>   The paths for the ACDIR and ACDIR-APIVERSION directories can be<br>changed respectively through aclocal options <code>--system-acdir</code> and<br><code>--automake-acdir</code> (note aclocal Options::).  Note however that these<br>options are only intended for use by the internal Automake test suite,<br>or for debugging under highly unusual situations; they are not<br>ordinarily needed by end-users.</p>
<p>   As explained in (note aclocal Options::), there are several options<br>that can be used to change or extend this search path.</p>
<p>Modifying the Macro Search Path: <code>-I DIR</code><br>…………………………………..</p>
<p>Any extra directories specified using <code>-I</code> options (note aclocal<br>Options::) are <em>prepended</em> to this search list.  Thus, <code>aclocal -I /foo -I /bar</code> results in the following search path:</p>
<ol>
<li><code>/foo</code></li>
<li><code>/bar</code></li>
<li>ACDIR-APIVERSION</li>
<li>ACDIR</li>
</ol>
<p>Modifying the Macro Search Path: <code>dirlist</code><br>……………………………………</p>
<p>There is a third mechanism for customizing the search path.  If a<br><code>dirlist</code> file exists in ACDIR, then that file is assumed to contain a<br>list of directory patterns, one per line.  <code>aclocal</code> expands these<br>patterns to directory names, and adds them to the search list <em>after</em><br>all other directories.  <code>dirlist</code> entries may use shell wildcards such<br>as <code>*</code>, <code>?</code>, or <code>[...]</code>.</p>
<p>   For example, suppose <code>ACDIR/dirlist</code> contains the following:</p>
<pre><code> /test1
 /test2
 /test3*
</code></pre>
<p>and that <code>aclocal</code> was called with the <code>-I /foo -I /bar</code> options.  Then,<br>the search path would be</p>
<ol>
<li><code>/foo</code></li>
<li><code>/bar</code></li>
<li>ACDIR-APIVERSION</li>
<li>ACDIR</li>
<li><code>/test1</code></li>
<li><code>/test2</code></li>
</ol>
<p>and all directories with path names starting with <code>/test3</code>.</p>
<p>   If the <code>--system-acdir=DIR</code> option is used, then <code>aclocal</code> will<br>search for the <code>dirlist</code> file in DIR; but remember the warnings above<br>against the use of <code>--system-acdir</code>.</p>
<p>   <code>dirlist</code> is useful in the following situation: suppose that<br><code>automake</code> version <code>1.11.2</code> is installed with <code>--prefix=/usr</code> by the<br>system vendor.  Thus, the default search directories are</p>
<ol>
<li><code>/usr/share/aclocal-1.11/</code></li>
<li><code>/usr/share/aclocal/</code></li>
</ol>
<p>   However, suppose further that many packages have been manually<br>installed on the system, with $prefix=/usr/local, as is typical.  In<br>that case, many of these “extra” <code>.m4</code> files are in<br><code>/usr/local/share/aclocal</code>.  The only way to force <code>/usr/bin/aclocal</code> to<br>find these “extra” <code>.m4</code> files is to always call <code>aclocal -I /usr/local/share/aclocal</code>.  This is inconvenient.  With <code>dirlist</code>, one<br>may create a file <code>/usr/share/aclocal/dirlist</code> containing only the<br>single line</p>
<pre><code> /usr/local/share/aclocal
</code></pre>
<p>   Now, the “default” search path on the affected system is</p>
<ol>
<li><code>/usr/share/aclocal-1.11/</code></li>
<li><code>/usr/share/aclocal/</code></li>
<li><code>/usr/local/share/aclocal/</code></li>
</ol>
<p>   without the need for <code>-I</code> options; <code>-I</code> options can be reserved for<br>project-specific needs (<code>my-source-dir/m4/</code>), rather than using it to<br>work around local system-dependent tool installation directories.</p>
<p>   Similarly, <code>dirlist</code> can be handy if you have installed a local copy<br>of Automake in your account and want <code>aclocal</code> to look for macros<br>installed at other places on the system.</p>
<p>Modifying the Macro Search Path: <code>ACLOCAL_PATH</code><br>………………………………………..</p>
<p>The fourth and last mechanism to customize the macro search path is also<br>the simplest.  Any directory included in the colon-separated environment<br>variable <code>ACLOCAL_PATH</code> is added to the search path and takes precedence<br>over system directories (including those found via <code>dirlist</code>), with the<br>exception of the versioned directory ACDIR-APIVERSION (note Macro<br>Search Path::).  However, directories passed via <code>-I</code> will take<br>precedence over directories in <code>ACLOCAL_PATH</code>.</p>
<p>   Also note that, if the <code>--install</code> option is used, any <code>.m4</code> file<br>containing a required macro that is found in a directory listed in<br><code>ACLOCAL_PATH</code> will be installed locally.  In this case, serial numbers<br>in <code>.m4</code> are honored too, note Serials::.</p>
<p>   Conversely to <code>dirlist</code>, <code>ACLOCAL_PATH</code> is useful if you are using a<br>global copy of Automake and want <code>aclocal</code> to look for macros somewhere<br>under your home directory.</p>
<p>Planned future incompatibilities<br>…………………………..</p>
<p>The order in which the directories in the macro search path are<br>currently looked up is confusing and/or suboptimal in various aspects,<br>and is probably going to be changed in the future Automake release.  In<br>particular, directories in <code>ACLOCAL_PATH</code> and <code>ACDIR</code> might end up<br>taking precedence over <code>ACDIR-APIVERSION</code>, and directories in<br><code>ACDIR/dirlist</code> might end up taking precedence over <code>ACDIR</code>.  <em>This is a<br>possible future incompatibility!</em></p>
<h3 id="6-3-3-Writing-your-own-aclocal-macros"><a href="#6-3-3-Writing-your-own-aclocal-macros" class="headerlink" title="6.3.3 Writing your own aclocal macros"></a>6.3.3 Writing your own aclocal macros</h3><hr>
<hr>
<p>The <code>aclocal</code> program doesn`t have any built-in knowledge of any macros,<br>so it is easy to extend it with your own macros.</p>
<p>   This can be used by libraries that want to supply their own Autoconf<br>macros for use by other programs.  For instance, the <code>gettext</code> library<br>supplies a macro <code>AM_GNU_GETTEXT</code> that should be used by any package<br>using <code>gettext</code>.  When the library is installed, it installs this macro<br>so that <code>aclocal</code> will find it.</p>
<p>   A macro file<code>s name should end in </code>.m4<code>.  Such files should be installed in </code>$(datadir)/aclocal`.  This is as simple as writing:</p>
<pre><code> aclocaldir = $(datadir)/aclocal
 aclocal_DATA = mymacro.m4 myothermacro.m4
</code></pre>
<p>Please do use <code>$(datadir)/aclocal</code>, and not something based on the<br>result of <code>aclocal --print-ac-dir</code> (note Hard-Coded Install Paths::,<br>for arguments).  It might also be helpful to suggest to the user to add<br>the <code>$(datadir)/aclocal</code> directory to his <code>ACLOCAL_PATH</code> variable (note<br>ACLOCAL_PATH::) so that <code>aclocal</code> will find the <code>.m4</code> files installed by<br>your package automatically.</p>
<p>   A file of macros should be a series of properly quoted <code>AC_DEFUN``s (note (autoconf)Macro Definitions::).  The </code>aclocal<code>programs also understands</code>AC_REQUIRE<code>(note (autoconf)Prerequisite Macros::), so it is safe to put each macro in a separate file.  Each file should have no side effects but macro definitions.  Especially, any call to</code>AC_PREREQ`<br>should be done inside the defined macro, not at the beginning of the<br>file.</p>
<p>   Starting with Automake 1.8, <code>aclocal</code> will warn about all underquoted<br>calls to <code>AC_DEFUN</code>.  We realize this will annoy a lot of people,<br>because <code>aclocal</code> was not so strict in the past and many third party<br>macros are underquoted; and we have to apologize for this temporary<br>inconvenience.  The reason we have to be stricter is that a future<br>implementation of <code>aclocal</code> (note Future of aclocal::) will have to<br>temporarily include all of these third party <code>.m4</code> files, maybe several<br>times, including even files that are not actually needed.  Doing so<br>should alleviate many problems of the current implementation, however it<br>requires a stricter style from the macro authors.  Hopefully it is easy<br>to revise the existing macros.  For instance,</p>
<pre><code> # bad style
 AC_PREREQ(2.68)
 AC_DEFUN(AX_FOOBAR,
 [AC_REQUIRE([AX_SOMETHING])dnl
 AX_FOO
 AX_BAR
 ])
</code></pre>
<p>should be rewritten as</p>
<pre><code> AC_DEFUN([AX_FOOBAR],
 [AC_PREREQ([2.68])dnl
 AC_REQUIRE([AX_SOMETHING])dnl
 AX_FOO
 AX_BAR
 ])
</code></pre>
<p>   Wrapping the <code>AC_PREREQ</code> call inside the macro ensures that Autoconf<br>2.68 will not be required if <code>AX_FOOBAR</code> is not actually used.  Most<br>importantly, quoting the first argument of <code>AC_DEFUN</code> allows the macro<br>to be redefined or included twice (otherwise this first argument would<br>be expanded during the second definition).  For consistency we like to<br>quote even arguments such as <code>2.68</code> that do not require it.</p>
<p>   If you have been directed here by the <code>aclocal</code> diagnostic but are<br>not the maintainer of the implicated macro, you will want to contact the<br>maintainer of that macro.  Please make sure you have the latest version<br>of the macro and that the problem hasn<code>t already been reported before doing so: people tend to work faster when they aren</code>t flooded by mails.</p>
<p>   Another situation where <code>aclocal</code> is commonly used is to manage<br>macros that are used locally by the package, note Local Macros::.</p>
<h3 id="6-3-4-Handling-Local-Macros"><a href="#6-3-4-Handling-Local-Macros" class="headerlink" title="6.3.4 Handling Local Macros"></a>6.3.4 Handling Local Macros</h3><hr>
<hr>
<p>Feature tests offered by Autoconf do not cover all needs.  People often<br>have to supplement existing tests with their own macros, or with<br>third-party macros.</p>
<p>   There are two ways to organize custom macros in a package.</p>
<p>   The first possibility (the historical practice) is to list all your<br>macros in <code>acinclude.m4</code>.  This file will be included in <code>aclocal.m4</code><br>when you run <code>aclocal</code>, and its macro(s) will henceforth be visible to<br><code>autoconf</code>.  However if it contains numerous macros, it will rapidly<br>become difficult to maintain, and it will be almost impossible to share<br>macros between packages.</p>
<p>   The second possibility, which we do recommend, is to write each macro<br>in its own file and gather all these files in a directory.  This<br>directory is usually called <code>m4/</code>.  Then it<code>s enough to update </code>configure.ac<code>by adding a proper call to</code>AC_CONFIG_MACRO_DIRS`:</p>
<pre><code> AC_CONFIG_MACRO_DIRS([m4])
</code></pre>
<p>   <code>aclocal</code> will then take care of automatically adding <code>m4/</code> to its<br>search path for m4 files.</p>
<p>   When <code>aclocal</code> is run, it will build an <code>aclocal.m4</code> that<br><code>m4_include</code>s any file from <code>m4/</code> that defines a required macro.  Macros<br>not found locally will still be searched in system-wide directories, as<br>explained in note Macro Search Path::.</p>
<p>   Custom macros should be distributed for the same reason that<br><code>configure.ac</code> is: so that other people have all the sources of your<br>package if they want to work on it.  Actually, this distribution happens<br>automatically because all <code>m4_include</code>d files are distributed.</p>
<p>   However there is no consensus on the distribution of third-party<br>macros that your package may use.  Many libraries install their own<br>macro in the system-wide <code>aclocal</code> directory (note Extending<br>aclocal::).  For instance, Guile ships with a file called <code>guile.m4</code><br>that contains the macro <code>GUILE_FLAGS</code> that can be used to define setup<br>compiler and linker flags appropriate for using Guile.  Using<br><code>GUILE_FLAGS</code> in <code>configure.ac</code> will cause <code>aclocal</code> to copy <code>guile.m4</code><br>into <code>aclocal.m4</code>, but as <code>guile.m4</code> is not part of the project, it will<br>not be distributed.  Technically, that means a user who needs to rebuild<br><code>aclocal.m4</code> will have to install Guile first.  This is probably OK, if<br>Guile already is a requirement to build the package.  However, if Guile<br>is only an optional feature, or if your package might run on<br>architectures where Guile cannot be installed, this requirement will<br>hinder development.  An easy solution is to copy such third-party macros<br>in your local <code>m4/</code> directory so they get distributed.</p>
<p>   Since Automake 1.10, <code>aclocal</code> offers the option <code>--install</code> to copy<br>these system-wide third-party macros in your local macro directory,<br>helping to solve the above problem.</p>
<p>   With this setup, system-wide macros will be copied to <code>m4/</code> the first<br>time you run <code>aclocal</code>.  Then the locally installed macros will have<br>precedence over the system-wide installed macros each time <code>aclocal</code> is<br>run again.</p>
<p>   One reason why you should keep <code>--install</code> in the flags even after<br>the first run is that when you later edit <code>configure.ac</code> and depend on a<br>new macro, this macro will be installed in your <code>m4/</code> automatically.<br>Another one is that serial numbers (note Serials::) can be used to<br>update the macros in your source tree automatically when new system-wide<br>versions are installed.  A serial number should be a single line of the<br>form</p>
<pre><code> #serial NNN
</code></pre>
<p>where NNN contains only digits and dots.  It should appear in the M4<br>file before any macro definition.  It is a good practice to maintain a<br>serial number for each macro you distribute, even if you do not use the<br><code>--install</code> option of <code>aclocal</code>: this allows other people to use it.</p>
<h3 id="6-3-5-Serial-Numbers"><a href="#6-3-5-Serial-Numbers" class="headerlink" title="6.3.5 Serial Numbers"></a>6.3.5 Serial Numbers</h3><hr>
<hr>
<p>Because third-party macros defined in <code>*.m4</code> files are naturally shared<br>between multiple projects, some people like to version them.  This makes<br>it easier to tell which of two M4 files is newer.  Since at least 1996,<br>the tradition is to use a <code>#serial</code> line for this.</p>
<p>   A serial number should be a single line of the form</p>
<pre><code> # serial VERSION
</code></pre>
<p>where VERSION is a version number containing only digits and dots.<br>Usually people use a single integer, and they increment it each time<br>they change the macro (hence the name of “serial”).  Such a line should<br>appear in the M4 file before any macro definition.</p>
<p>   The <code>#</code> must be the first character on the line, and it is OK to have<br>extra words after the version, as in</p>
<pre><code> #serial VERSION GARBAGE
</code></pre>
<p>   Normally these serial numbers are completely ignored by <code>aclocal</code> and<br><code>autoconf</code>, like any genuine comment.  However when using <code>aclocal``s </code>–install<code>feature, these serial numbers will modify the way</code>aclocal<code>selects the macros to install in the package: if two files with the same basename exist in your search path, and if at least one of them uses a</code>#serial<code>line,</code>aclocal<code>will ignore the file that has the older</code>#serial` line (or the file that has none).</p>
<p>   Note that a serial number applies to a whole M4 file, not to any<br>macro it contains.  A file can contains multiple macros, but only one<br>serial.</p>
<p>   Here is a use case that illustrates the use of <code>--install</code> and its<br>interaction with serial numbers.  Let<code>s assume we maintain a package called MyPackage, the </code>configure.ac<code>of which requires a third-party macro</code>AX_THIRD_PARTY<code>defined in</code>/usr/share/aclocal/thirdparty.m4` as<br>follows:</p>
<pre><code> # serial 1
 AC_DEFUN([AX_THIRD_PARTY], [...])
</code></pre>
<p>   MyPackage uses an <code>m4/</code> directory to store local macros as explained<br>in note Local Macros::, and has</p>
<pre><code> AC_CONFIG_MACRO_DIRS([m4])
</code></pre>
<p>in its <code>configure.ac</code>.</p>
<p>   Initially the <code>m4/</code> directory is empty.  The first time we run<br><code>aclocal --install</code>, it will notice that</p>
<p>   • <code>configure.ac</code> uses <code>AX_THIRD_PARTY</code><br>   • No local macros define <code>AX_THIRD_PARTY</code><br>   • <code>/usr/share/aclocal/thirdparty.m4</code> defines <code>AX_THIRD_PARTY</code> with<br>​     serial 1.</p>
<p>Because <code>/usr/share/aclocal/thirdparty.m4</code> is a system-wide macro and<br><code>aclocal</code> was given the <code>--install</code> option, it will copy this file in<br><code>m4/thirdparty.m4</code>, and output an <code>aclocal.m4</code> that contains<br><code>m4_include([m4/thirdparty.m4])</code>.</p>
<p>   The next time <code>aclocal --install</code> is run, something different<br>happens.  <code>aclocal</code> notices that</p>
<p>   • <code>configure.ac</code> uses <code>AX_THIRD_PARTY</code><br>   • <code>m4/thirdparty.m4</code> defines <code>AX_THIRD_PARTY</code> with serial 1.<br>   • <code>/usr/share/aclocal/thirdparty.m4</code> defines <code>AX_THIRD_PARTY</code> with<br>​     serial 1.</p>
<p>Because both files have the same serial number, <code>aclocal</code> uses the first<br>it found in its search path order (note Macro Search Path::).<br><code>aclocal</code> therefore ignores <code>/usr/share/aclocal/thirdparty.m4</code> and<br>outputs an <code>aclocal.m4</code> that contains <code>m4_include([m4/thirdparty.m4])</code>.</p>
<p>   Local directories specified with <code>-I</code> are always searched before<br>system-wide directories, so a local file will always be preferred to the<br>system-wide file in case of equal serial numbers.</p>
<p>   Now suppose the system-wide third-party macro is changed.  This can<br>happen if the package installing this macro is updated.  Let<code>s suppose the new macro has serial number 2.  The next time </code>aclocal –install` is<br>run the situation is the following:</p>
<p>   • <code>configure.ac</code> uses <code>AX_THIRD_PARTY</code><br>   • <code>m4/thirdparty.m4</code> defines <code>AX_THIRD_PARTY</code> with serial 1.<br>   • <code>/usr/share/aclocal/thirdparty.m4</code> defines <code>AX_THIRD_PARTY</code> with<br>​     serial 2.</p>
<p>When <code>aclocal</code> sees a greater serial number, it immediately forgets<br>anything it knows from files that have the same basename and a smaller<br>serial number.  So after it has found <code>/usr/share/aclocal/thirdparty.m4</code><br>with serial 2, <code>aclocal</code> will proceed as if it had never seen<br><code>m4/thirdparty.m4</code>.  This brings us back to a situation similar to that<br>at the beginning of our example, where no local file defined the macro.<br><code>aclocal</code> will install the new version of the macro in<br><code>m4/thirdparty.m4</code>, in this case overriding the old version.  MyPackage<br>just had its macro updated as a side effect of running <code>aclocal</code>.</p>
<p>   If you are leery of letting <code>aclocal</code> update your local macro, you<br>can run <code>aclocal --diff</code> to review the changes <code>aclocal --install</code> would<br>perform on these macros.</p>
<p>   Finally,note that the <code>--force</code> option of <code>aclocal</code> has absolutely<br>no effect on the files installed by <code>--install</code>.  For instance, if you<br>have modified your local macros, do not expect <code>--install --force</code> to<br>replace the local macros by their system-wide versions.  If you want to<br>do so, simply erase the local macros you want to revert, and run<br><code>aclocal --install</code>.</p>
<h3 id="6-3-6-The-Future-of-aclocal"><a href="#6-3-6-The-Future-of-aclocal" class="headerlink" title="6.3.6 The Future of aclocal"></a>6.3.6 The Future of <code>aclocal</code></h3><hr>
<hr>
<p><code>aclocal</code> is expected to disappear.  This feature really should not be<br>offered by Automake.  Automake should focus on generating <code>Makefile</code>s;<br>dealing with M4 macros really is Autoconf<code>s job.  The fact that some people install Automake just to use </code>aclocal<code>, but do not use </code>automake`<br>otherwise is an indication of how that feature is misplaced.</p>
<p>   The new implementation will probably be done slightly differently.<br>For instance, it could enforce the <code>m4/</code>-style layout discussed in note<br>Local Macros::.</p>
<p>   We have no idea when and how this will happen.  This has been<br>discussed several times in the past, but someone still has to commit to<br>that non-trivial task.</p>
<p>   From the user point of view, <code>aclocal``s removal might turn out to be painful.  There is a simple precaution that you may take to make that switch more seamless: never call </code>aclocal<code>yourself.  Keep this guy under the exclusive control of</code>autoreconf<code> and Automake</code>s rebuild<br>rules.  Hopefully you won<code>t need to worry about things breaking, when </code>aclocal<code>disappears, because everything will have been taken care of. If otherwise you used to call</code>aclocal` directly yourself or from some<br>script, you will quickly notice the change.</p>
<p>   Many packages come with a script called <code>bootstrap</code> or <code>autogen.sh</code>,<br>that will just call <code>aclocal</code>, <code>libtoolize</code>, <code>gettextize</code> or<br><code>autopoint</code>, <code>autoconf</code>, <code>autoheader</code>, and <code>automake</code> in the right<br>order.  Actually this is precisely what <code>autoreconf</code> can do for you.  If<br>your package has such a <code>bootstrap</code> or <code>autogen.sh</code> script, consider<br>using <code>autoreconf</code>.  That should simplify its logic a lot (less things<br>to maintain, yum!), it<code>s even likely you will not need the script anymore, and more to the point you will not call </code>aclocal` directly<br>anymore.</p>
<p>   For the time being, third-party packages should continue to install<br>public macros into <code>/usr/share/aclocal/</code>.  If <code>aclocal</code> is replaced by<br>another tool it might make sense to rename the directory, but supporting<br><code>/usr/share/aclocal/</code> for backward compatibility should be really easy<br>provided all macros are properly written (note Extending aclocal::).</p>
<h2 id="6-4-Autoconf-macros-supplied-with-Automake"><a href="#6-4-Autoconf-macros-supplied-with-Automake" class="headerlink" title="6.4 Autoconf macros supplied with Automake"></a>6.4 Autoconf macros supplied with Automake</h2><hr>
<p>Automake ships with several Autoconf macros that you can use from your<br><code>configure.ac</code>.  When you use one of them it will be included by<br><code>aclocal</code> in <code>aclocal.m4</code>.</p>
<h3 id="6-4-1-Public-Macros"><a href="#6-4-1-Public-Macros" class="headerlink" title="6.4.1 Public Macros"></a>6.4.1 Public Macros</h3><hr>
<hr>
<p><code>AM_INIT_AUTOMAKE([OPTIONS])</code><br>​     Runs many macros required for proper operation of the generated<br>​     Makefiles.</p>
<pre><code> Today, `AM_INIT_AUTOMAKE` is called with a single argument: a
 space-separated list of Automake options that should be applied to
 every `Makefile.am` in the tree.  The effect is as if each option
 were listed in `AUTOMAKE_OPTIONS` (note Options::).

 This macro can also be called in another, _deprecated_ form:
 `AM_INIT_AUTOMAKE(PACKAGE, VERSION, [NO-DEFINE])`.  In this form,
 there are two required arguments: the package and the version
 number.  This usage is mostly obsolete because the PACKAGE and
 VERSION can be obtained from Autoconf`s `AC_INIT` macro.  However,
 differently from what happens for `AC_INIT` invocations, this
 `AM_INIT_AUTOMAKE` invocation supports shell variables` expansions
 in the `PACKAGE` and `VERSION` arguments (which otherwise defaults,
 respectively, to the `PACKAGE_TARNAME` and `PACKAGE_VERSION`
 defined via the `AC_INIT` invocation; note The `AC_INIT` macro:
 (autoconf)AC_INIT.); and this can be still be useful in some
 selected situations.  Our hope is that future Autoconf versions
 will improve their support for package versions defined dynamically
 at configure runtime; when (and if) this happens, support for the
 two-args `AM_INIT_AUTOMAKE` invocation will likely be removed from
 Automake.

 If your `configure.ac` has:

      AC_INIT([src/foo.c])
      AM_INIT_AUTOMAKE([mumble], [1.5])

 you should modernize it as follows:

      AC_INIT([mumble], [1.5])
      AC_CONFIG_SRCDIR([src/foo.c])
      AM_INIT_AUTOMAKE

 Note that if you`re upgrading your `configure.ac` from an earlier
 version of Automake, it is not always correct to simply move the
 package and version arguments from `AM_INIT_AUTOMAKE` directly to
 `AC_INIT`, as in the example above.  The first argument to
 `AC_INIT` should be the name of your package (e.g., `GNU
 Automake`), not the tarball name (e.g., `automake`) that you used
 to pass to `AM_INIT_AUTOMAKE`.  Autoconf tries to derive a tarball
 name from the package name, which should work for most but not all
 package names.  (If it doesn`t work for yours, you can use the
 four-argument form of `AC_INIT` to provide the tarball name
 explicitly).

 By default this macro `AC_DEFINE``s `PACKAGE` and `VERSION`.  This
 can be avoided by passing the `no-define` option (note List of
 Automake options::):
      AM_INIT_AUTOMAKE([no-define ...])
</code></pre>
<p><code>AM_PATH_LISPDIR</code><br>​     Searches for the program <code>emacs</code>, and, if found, sets the output<br>​     variable <code>lispdir</code> to the full path to Emacs` site-lisp directory.</p>
<pre><code> Note that this test assumes the `emacs` found to be a version that
 supports Emacs Lisp (such as GNU Emacs or XEmacs).  Other emacsen
 can cause this test to hang (some, like old versions of MicroEmacs,
 start up in interactive mode, requiring `C-x C-c` to exit, which is
 hardly obvious for a non-emacs user).  In most cases, however, you
 should be able to use `C-c` to kill the test.  In order to avoid
 problems, you can set `EMACS` to “no” in the environment, or use
 the `--with-lispdir` option to `configure` to explicitly set the
 correct path (if you`re sure you have an `emacs` that supports
 Emacs Lisp).
</code></pre>
<p><code>AM_PROG_AR([ACT-IF-FAIL])</code><br>​     You must use this macro when you use the archiver in your project,<br>​     if you want support for unusual archivers such as Microsoft <code>lib</code>.<br>​     The content of the optional argument is executed if the archiver<br>​     interface is not recognized; the default action is to abort<br>​     configure with an error message.</p>
<p><code>AM_PROG_AS</code><br>​     Use this macro when you have assembly code in your project.  This<br>​     will choose the assembler for you (by default the C compiler) and<br>​     set <code>CCAS</code>, and will also set <code>CCASFLAGS</code> if required.</p>
<p><code>AM_PROG_CC_C_O</code><br>​     This is an obsolescent macro that checks that the C compiler<br>​     supports the <code>-c</code> and <code>-o</code> options together.  Note that, since<br>​     Automake 1.14, the <code>AC_PROG_CC</code> is rewritten to implement such<br>​     checks itself, and thus the explicit use of <code>AM_PROG_CC_C_O</code> should<br>​     no longer be required.</p>
<p><code>AM_PROG_LEX</code><br>​     Like <code>AC_PROG_LEX</code> (note Particular Program Checks:<br>​     (autoconf)Particular Programs.), but uses the <code>missing</code> script on<br>​     systems that do not have <code>lex</code>.  HP-UX 10 is one such system.</p>
<p><code>AM_PROG_GCJ</code><br>​     This macro finds the <code>gcj</code> program or causes an error.  It sets<br>​     <code>GCJ</code> and <code>GCJFLAGS</code>.  <code>gcj</code> is the Java front-end to the GNU<br>​     Compiler Collection.</p>
<p><code>AM_PROG_UPC([COMPILER-SEARCH-LIST])</code><br>​     Find a compiler for Unified Parallel C and define the <code>UPC</code><br>​     variable.  The default COMPILER-SEARCH-LIST is <code>upcc upc</code>.  This<br>​     macro will abort <code>configure</code> if no Unified Parallel C compiler is<br>​     found.</p>
<p><code>AM_MISSING_PROG(NAME, PROGRAM)</code><br>​     Find a maintainer tool PROGRAM and define the NAME environment<br>​     variable with its location.  If PROGRAM is not detected, then NAME<br>​     will instead invoke the <code>missing</code> script, in order to give useful<br>​     advice to the user about the missing maintainer tool.   for more information on when the <code>missing</code><br>​     script is appropriate.</p>
<p><code>AM_SILENT_RULES</code><br>​     Control the machinery for less verbose build output (note Automake<br>​     Silent Rules::).</p>
<p><code>AM_WITH_DMALLOC</code><br>​     Add support for the Dmalloc package (<a href="http://dmalloc.com/">http://dmalloc.com/</a>).  If the<br>​     user runs <code>configure</code> with <code>--with-dmalloc</code>, then define<br>​     <code>WITH_DMALLOC</code> and add <code>-ldmalloc</code> to <code>LIBS</code>.</p>
<h3 id="6-4-2-Obsolete-Macros"><a href="#6-4-2-Obsolete-Macros" class="headerlink" title="6.4.2 Obsolete Macros"></a>6.4.2 Obsolete Macros</h3><hr>
<hr>
<p>Although using some of the following macros was required in past<br>releases, you should not use any of them in new code.  <em>All these macros<br>will be removed in the next major Automake version</em>; if you are still<br>using them, running <code>autoupdate</code> should adjust your <code>configure.ac</code><br>automatically (note Using <code>autoupdate</code> to Modernize <code>configure.ac</code>:<br>(autoconf)autoupdate Invocation.).  <em>Do it NOW!</em></p>
<p><code>AM_PROG_MKDIR_P</code></p>
<pre><code> From Automake 1.8 to 1.9.6 this macro used to define the output
 variable `mkdir_p` to one of `mkdir -p`, `install-sh -d`, or
 `mkinstalldirs`.

 Nowadays Autoconf provides a similar functionality with
 `AC_PROG_MKDIR_P` (note Particular Program Checks:
 (autoconf)Particular Programs.), however this defines the output
 variable `MKDIR_P` instead.  In case you are still using the
 `AM_PROG_MKDIR_P` macro in your `configure.ac`, or its provided
 variable `$(mkdir_p)` in your `Makefile.am`, you are advised to
 switch ASAP to the more modern Autoconf-provided interface instead;
 both the macro and the variable might be removed in a future major
 Automake release.
</code></pre>
<h2 id="6-4-3-Private-Macros"><a href="#6-4-3-Private-Macros" class="headerlink" title="6.4.3 Private Macros***********************"></a>6.4.3 Private Macros<br>***********************</h2><p>The following macros are private macros you should not call directly.<br>They are called by the other public macros when appropriate.  Do not<br>rely on them, as they might be changed in a future version.  Consider<br>them as implementation details; or better, do not consider them at all:<br>skip this section!</p>
<p><code>_AM_DEPENDENCIES</code><br><code>AM_SET_DEPDIR</code><br><code>AM_DEP_TRACK</code><br><code>AM_OUTPUT_DEPENDENCY_COMMANDS</code><br>​     These macros are used to implement Automake`s automatic dependency<br>​     tracking scheme.  They are called automatically by Automake when<br>​     required, and there should be no need to invoke them manually.</p>
<p><code>AM_MAKE_INCLUDE</code><br>​     This macro is used to discover how the user<code>s </code>make<code>handles ​    </code>include` statements.  This macro is automatically invoked when<br>​     needed; there should be no need to invoke it manually.</p>
<p><code>AM_PROG_INSTALL_STRIP</code><br>​     This is used to find a version of <code>install</code> that can be used to<br>​     strip a program at installation time.  This macro is automatically<br>​     included when required.</p>
<p><code>AM_SANITY_CHECK</code><br>​     This checks to make sure that a file created in the build directory<br>​     is newer than a file in the source directory.  This can fail on<br>​     systems where the clock is set incorrectly.  This macro is<br>​     automatically run from <code>AM_INIT_AUTOMAKE</code>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/100/">100</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">郭大侠</p>
  <div class="site-description" itemprop="description">郭大侠的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">998</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">181</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1450</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://macshuo.com/" title="http:&#x2F;&#x2F;macshuo.com&#x2F;" rel="noopener" target="_blank">MacTalk</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://huhuidong.wordpress.com/" title="https:&#x2F;&#x2F;huhuidong.wordpress.com&#x2F;" rel="noopener" target="_blank">小胡</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2007 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">郭大侠</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"vIjrLnlboDVaaseO2yYcVSQF-gzGzoHsz","app_key":"NTHrGJp71GzEGvNUEUFumVcR","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://shaoguangleo.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'vIjrLnlboDVaaseO2yYcVSQF-gzGzoHsz',
      appKey     : 'NTHrGJp71GzEGvNUEUFumVcR',
      placeholder: "路过，即是缘分...",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
